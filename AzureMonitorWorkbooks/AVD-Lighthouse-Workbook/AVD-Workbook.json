{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Subscription}"
        ],
        "parameters": [
          {
            "id": "b859a03f-2283-43dd-8536-42714bbfced6",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 6,
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "includeAll": true,
              "showDefault": false
            },
            "value": "/subscriptions/c694b35d-0b59-41aa-89ff-8fb250f0e498"
          },
          {
            "id": "015ef26a-4d74-4839-8f9f-0244d8d70a02",
            "version": "KqlParameterItem/1.0",
            "name": "LogAnalytics",
            "type": 5,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "where type =~ 'Microsoft.OperationalInsights/workspaces'\r\n| project id, name\r\n| order by name desc",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ]
            },
            "defaultValue": "value::all",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "04a8ead2-1fb2-4666-a7b0-6d92e3c29b46",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "type": 4,
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2592000000
                }
              ],
              "allowCustom": true
            },
            "timeContextFromParameter": "TimeRange",
            "value": {
              "durationMs": 14400000
            }
          },
          {
            "id": "2e3dfd9b-2d0f-4feb-94e8-107f220c4e28",
            "version": "KqlParameterItem/1.0",
            "name": "ResourceGroup",
            "label": "Resource Group",
            "type": 5,
            "isRequired": true,
            "query": "resources\r\n| where type contains  \"desktopvirtualization\"\r\n| summarize Count = count() by resourceGroup\r\n| project Label = resourceGroup, Id = resourceGroup, Selected = Count >= 0",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": null
          },
          {
            "id": "951b5870-e216-45c6-b159-34150868a46e",
            "version": "KqlParameterItem/1.0",
            "name": "HostPool",
            "label": "Host Pool",
            "type": 5,
            "isRequired": true,
            "query": "resources\r\n| where type == \"microsoft.desktopvirtualization/hostpools\" and resourceGroup == \"{ResourceGroup}\"\r\n",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "966a75f4-f4a4-4404-b649-67da45ddf636",
            "version": "KqlParameterItem/1.0",
            "name": "WVDHosts",
            "type": 7,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "WVDAgentHealthStatus\r\n| distinct SessionHostName",
            "crossComponentResources": [
              "{LogAnalytics}"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "defaultValue": "value::all",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "42ed3fcf-029c-49d5-b29e-655ecf674c1d",
            "version": "KqlParameterItem/1.0",
            "name": "pooldiag",
            "type": 2,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/{HostPool}/providers/microsoft.insights/diagnosticSettings?api-version=2021-05-01-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[*].properties\",\"columns\":[{\"path\":\"$.workspaceId\",\"columnid\":\"value\"},{\"path\":\"$.workspaceId\",\"columnid\":\"disp\"},{\"path\":\"$.workspaceId\",\"columnid\":\"selected\"}]}}]}",
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 12
          },
          {
            "id": "ff8c2838-aaf0-40f6-a604-d4bfe72fc92f",
            "version": "KqlParameterItem/1.0",
            "name": "poolla",
            "type": 5,
            "query": "resources\r\n| take 1\r\n| project diag=dynamic([{pooldiag}])\r\n| mv-expand diag\r\n| project tostring(diag)\r\n| where diag != 'null'\r\n| project diag, disp=diag, selected=1",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 172800000
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": null
          },
          {
            "id": "f9689a3a-7490-4d0f-9a7f-94590ac0b760",
            "version": "KqlParameterItem/1.0",
            "name": "WVDHostsId",
            "type": 5,
            "isRequired": true,
            "multiSelect": true,
            "quote": "\"",
            "delimiter": ",",
            "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GETARRAY\",\"path\":\"/subscriptions/{Subscription:id}/resourcegroups/{ResourceGroup}/providers/Microsoft.DesktopVirtualization/hostpools/{HostPool:label}/sessionhosts?api-version=2019-01-23-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"columns\":[{\"path\":\"$.properties.resourceId\",\"columnid\":\"Id\"},{\"path\":\"$.properties.resourceId\",\"columnid\":\"Disp\"},{\"path\":\"$.properties.resourceId\",\"columnid\":\"selected\"}]}}]}",
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 12
          },
          {
            "id": "08f46c2a-f080-40c5-b36f-acd0e80c6259",
            "version": "KqlParameterItem/1.0",
            "name": "WorkspaceId",
            "type": 1,
            "query": "resources\r\n| where type =~ \"Microsoft.Compute/virtualMachines/extensions\"and properties.type == \"MicrosoftMonitoringAgent\"\r\n| extend vmname = extract(\"(.*?)/extensions\",1, id)\r\n| where vmname in~ ({WVDHostsId})\r\n| project Value = parse_json(properties.settings).workspaceId, selected=true\r\n| limit 1",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "29c8282b-4c11-409c-b4e9-1049edbaf67a",
            "version": "KqlParameterItem/1.0",
            "name": "Workspace",
            "type": 5,
            "query": "resources\r\n| where type == \"microsoft.operationalinsights/workspaces\"\r\n| where properties.customerId == \"{WorkspaceId}\"",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": null
          },
          {
            "id": "875c91e3-2744-4509-9656-68bdce082076",
            "version": "KqlParameterItem/1.0",
            "name": "wvdworkspace",
            "type": 5,
            "isRequired": true,
            "query": "resources\r\n| where type == \"microsoft.desktopvirtualization/applicationgroups\"\r\n| project id, workspace= properties.workspaceArmPath, hp=properties.hostPoolArmPath\r\n| where isnotnull(workspace)\r\n| where hp =~ \"{HostPool}\"\r\n| project workspace, label=workspace,selected=1",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "35dd7c51-8356-4247-930c-0b6e2172c353",
            "version": "KqlParameterItem/1.0",
            "name": "HostPoolOld",
            "label": "Host Pool From Logs",
            "type": 2,
            "description": "Select a host pool to show only data of this specific one",
            "isRequired": true,
            "query": "WVDConnections \r\n| extend HostPool=split(_ResourceId,\"/\")[8] \r\n| where TimeGenerated {TimeRange} \r\n| distinct tostring(HostPool) \r\n| where HostPool =~ \"{HostPool:name}\"\r\n| distinct HostPool\r\n\r\n",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::1"
              ],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "defaultValue": "value::1",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "d608dc0d-9527-4725-82dd-8c168a87fdfb",
            "version": "KqlParameterItem/1.0",
            "name": "SessionHostSelector",
            "label": "Opt: Session Host",
            "type": 2,
            "description": "Select a session host to drill down into the data. Don't select a session host to disable this filter.",
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "WVDConnections | extend HostPool=split(_ResourceId,\"/\")[8] | where TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\" |distinct SessionHostName | order by SessionHostName",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "66dfb97f-56ef-4261-bb70-930be537fca5",
            "version": "KqlParameterItem/1.0",
            "name": "UserSelector",
            "label": "Opt: User",
            "type": 2,
            "description": "Select a user to drill down into the data. Don't select a user to disable this filter.",
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "WVDConnections | extend HostPool=split(_ResourceId,\"/\")[8] | where TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\" | distinct UserName | order by UserName",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "value": []
          },
          {
            "id": "47d45195-4ea2-447a-bfc7-13d8e0eac2fe",
            "version": "KqlParameterItem/1.0",
            "name": "ErrorSelector",
            "label": "Error Selector",
            "type": 2,
            "description": "Select an error to drill down into the data. Don't select an item to disable this filter.",
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "WVDErrors | extend HostPool=split(_ResourceId,\"/\")[8] | where TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\" \r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Unspecified error\",\"Unspecified error\",CodeSymbolic)\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The system cannot open the file.\",\"The system cannot open the file.\",CodeSymbolic)\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The RPC server is unavailable.\",\"The RPC server is unavailable.\",CodeSymbolic)\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No such interface supported\",\"No such interface supported\",CodeSymbolic)\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No process is on the other end of the pipe.\",\"No process is on the other end of the pipe.\",CodeSymbolic)\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Operation aborted\",\"\tOperation aborted\",CodeSymbolic)\r\n| distinct tostring(CodeSymbolic) | order by CodeSymbolic",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "pills",
        "queryType": 1,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters_general"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "tabStyle": "bigger",
        "links": [
          {
            "id": "3ee32b75-5909-4290-a81b-8dfc31ef6c6f",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Overview",
            "subTarget": "Overview",
            "style": "link"
          },
          {
            "id": "e06d9d10-8ca7-41d5-8cd4-5535a1352c29",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Users",
            "subTarget": "UserReport",
            "style": "link"
          },
          {
            "id": "65012900-63c5-4ba3-9192-1fa22a42ee03",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Clients",
            "subTarget": "ClientReport",
            "style": "link"
          },
          {
            "id": "b1d4968c-b8a4-431b-b7b3-b55a50742348",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Connection Diagnostics",
            "subTarget": "ConnectionDiagnostics",
            "style": "link"
          },
          {
            "id": "61401b62-682c-4161-a0a7-a0471dae40fd",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "AVD Errors and Connections",
            "subTarget": "Logins",
            "style": "link"
          },
          {
            "id": "4ab20313-a9f7-41d7-9e54-bd57486daa43",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Session Bandwidths & Latencies",
            "subTarget": "Latencies",
            "style": "link"
          },
          {
            "id": "6fca6244-763c-4f84-b3d4-09f426e24585",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Logon Timing",
            "subTarget": "LogonTiming",
            "style": "link"
          },
          {
            "id": "b9abd545-c89a-4e73-8423-acf5c7343aef",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Host  Diagnostics",
            "subTarget": "HostDiagnostics",
            "style": "link"
          },
          {
            "id": "1602a8e9-3206-43ea-95c5-7a9bf509a423",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Host Availability",
            "subTarget": "HostAvailability",
            "style": "link"
          },
          {
            "id": "428b15c6-9f2f-4b33-96b2-87c1a17e9604",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Graphical Data",
            "subTarget": "GraphicalData",
            "style": "link"
          }
        ]
      },
      "name": "links - 3",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "parameters": [
                      {
                        "id": "6c8ec0d1-d1e2-4324-8b1d-e01e3c53d789",
                        "version": "KqlParameterItem/1.0",
                        "name": "hostnames",
                        "type": 5,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\ndatatable (hosts:dynamic)[dynamic([{WVDHosts}])]\r\n| mv-expand hosts\r\n| project hosts=split(hosts,\"/\")[1]\r\n| project hosts=split(hosts,\".\")[0], selected=1\r\n",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "isHiddenWhenLocked": true,
                        "typeSettings": {
                          "additionalResourceOptions": []
                        },
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 0,
                        "resourceType": "microsoft.insights/components"
                      },
                      {
                        "id": "15273375-7fdf-42da-b1b5-762b435ba89c",
                        "version": "KqlParameterItem/1.0",
                        "name": "SearchSessionHost",
                        "label": "Search for Session Host",
                        "type": 10,
                        "isRequired": true,
                        "typeSettings": {
                          "additionalResourceOptions": []
                        },
                        "jsonData": "[\r\n {\"value\": \"Yes\", \"label\": \"Yes\"},\r\n {\"value\": \"No\", \"label\": \"No\", \"selected\":true }\r\n]"
                      }
                    ],
                    "style": "above",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters_general"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "### Session Host Search Tool\r\nUse the search box below to find which Host Pool a Virtual Machine belongs to. "
                        },
                        "name": "text - 4"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "65221144-0b14-48ce-9d71-d720524326c0",
                              "version": "KqlParameterItem/1.0",
                              "name": "HostNameSearch",
                              "label": "Host Name Search Field",
                              "type": 1,
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": "vm"
                            }
                          ],
                          "style": "above",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters - 3"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "desktopvirtualizationresources\r\n| where type == \"microsoft.desktopvirtualization/hostpools/sessionhosts\"\r\n| extend SplitAll=split(name,'/')\r\n| extend HostPool = SplitAll[0]\r\n| extend SessionHostNameSplit = tostring(SplitAll[1])\r\n| extend SplitAll2=split(SessionHostNameSplit,'.')\r\n| extend SessionHostName = tostring(SplitAll2[0])\r\n| where SessionHostName contains \"{HostNameSearch}\"\r\n| project id, SessionHostName, Status=properties.status, HostPool, Sessions=properties.sessions, AllowSessions=properties.allowNewSession, AssignedUser=properties.assignedUser, OS=properties.osVersion, UpdateStatus=properties.updateStatus, UpdateState=properties.updateState, SxSVersion=properties.sxSStackVersion, ImageType=properties.imageType\r\n\t| join kind=leftouter(\r\nResources\r\n| where type =~ 'microsoft.compute/virtualmachines'\r\n| extend SplitAll=split(name, '.')\r\n| extend SessionHostName=tostring(SplitAll[0])\r\n| project SessionHostName, VMStatus=properties.extended.instanceView.powerState.displayStatus) on SessionHostName\r\n| project SessionHostName, HostPool, VMStatus, Status, Sessions, AllowSessions, AssignedUser, OS, UpdateStatus, UpdateState, SxSVersion, ImageType\r\n| sort by SessionHostName",
                          "size": 0,
                          "title": "Find Session Host and Host Pool",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "HostPool",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "VMStatus",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "!=",
                                      "thresholdValue": "VM running",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Status",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "!=",
                                      "thresholdValue": "Available",
                                      "representation": "redBright",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "green",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Sessions",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 10,
                                  "palette": "redBright"
                                }
                              },
                              {
                                "columnMatch": "AllowSessions",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "false",
                                      "representation": "redBright",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "true",
                                      "representation": "green",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "green",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "AssignedUser",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "!=",
                                      "thresholdValue": "null",
                                      "representation": "lightBlue",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "OS",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "UpdateStatus",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "!=",
                                      "thresholdValue": "NotInProgress",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "UpdateState",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "!=",
                                      "thresholdValue": "Succeeded",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "SxSVersion",
                                "formatter": 1
                              }
                            ],
                            "filter": true
                          }
                        },
                        "name": "query - 2"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "SearchSessionHost",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "group - SearchForSessionHost"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "b25ad595-1722-4ed6-ab15-17d45003785d",
                              "version": "KqlParameterItem/1.0",
                              "name": "showall",
                              "label": "Show All Computers",
                              "type": 10,
                              "isRequired": true,
                              "isHiddenWhenLocked": true,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[{\"value\":\" | where 1==1 \", \"label\":\"yes\", \"selected\":false },\r\n{\"value\":\"| extend Computername = strcat(hostPool, '/', Computer)| where Computername in~ (WVDHosts)\", \"label\":\"no\" , \"selected\":true }]",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters_allcomputers"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "parameters": [
                            {
                              "id": "a7ee9b2b-2d75-46ec-b1c4-579396d2305b",
                              "version": "KqlParameterItem/1.0",
                              "name": "EventsToInclude",
                              "label": "Events to include",
                              "type": 2,
                              "description": "Option to allow for testing the agent message, if no agent messages exist in the data set",
                              "isRequired": true,
                              "isHiddenWhenLocked": true,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\r\n        \"value\": \"and Source == \\\"WVD-Agent\\\"\",\r\n        \"label\": \"WVD Agent events only\",\r\n        \"selected\": \"true\"\r\n    },\r\n    {\r\n        \"value\": \"and 1==1\",\r\n        \"label\": \"All events (DEBUG)\"\r\n    }\r\n]",
                              "timeContext": {
                                "durationMs": 0
                              },
                              "timeContextFromParameter": "TimeRange"
                            },
                            {
                              "id": "4c0874af-922a-463b-8a4f-ad008e5a7259",
                              "version": "KqlParameterItem/1.0",
                              "name": "EventLevelName",
                              "type": 10,
                              "description": "This allows for more natural phrasing in the message. If all agent events are only error or only warning, it will print the corresponding level. Otherwise, it will say \"Error and/or Warning\"",
                              "isRequired": true,
                              "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nEvent\r\n| where WVDHosts contains Computer and EventLog == \"Application\" and EventLevel in (1,2) {EventsToInclude}\r\n| distinct EventLevelName\r\n| summarize value=coalesce(strcat_array(array_sort_asc(make_set(EventLevelName)), \", \"), \"N/A\")\r\n| extend label=value, selected=1",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "isHiddenWhenLocked": true,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 0
                              },
                              "timeContextFromParameter": "TimeRange",
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            },
                            {
                              "id": "2c92bb79-c53d-46d4-85bb-a92bb32c9994",
                              "version": "KqlParameterItem/1.0",
                              "name": "MessageFormatting",
                              "type": 10,
                              "description": "Find the highest agent message level, to format the warning text accordingly. Error formatting takes precedence over warnings.",
                              "isRequired": true,
                              "query": "// Find the highest agent message level, to format the warning text accordingly. Error formatting takes precedence over warnings.\r\nprint value=case(\"{EventLevelName}\" contains \"Error\", 5, \"{EventLevelName}\" contains \"Warning\", 4, 0)\r\n| extend label=value, selected=1",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "isHiddenWhenLocked": true,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 0
                              },
                              "timeContextFromParameter": "TimeRange",
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            },
                            {
                              "id": "eb4901b0-bd91-4722-83a3-895a4e72b4c0",
                              "version": "KqlParameterItem/1.0",
                              "name": "HostsWithAgentEvents",
                              "type": 10,
                              "description": "The count of hosts with agents that are writing messages to the event log",
                              "isRequired": true,
                              "query": "// The count of hosts with agents that are writing messages to the event log\r\nlet WVDHosts = dynamic([{WVDHosts}]);\r\nEvent\r\n| where WVDHosts contains Computer and EventLog == \"Application\" and EventLevel in (1,2) {EventsToInclude}\r\n| summarize value=dcount(_ResourceId)+0\r\n| extend label=value, selected=1",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "isHiddenWhenLocked": true,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 0
                              },
                              "timeContextFromParameter": "TimeRange",
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            },
                            {
                              "id": "fe2e42fd-4029-4231-b90d-6b3ccf3bc24e",
                              "version": "KqlParameterItem/1.0",
                              "name": "TotalEventInstances",
                              "type": 10,
                              "description": "The count of messages written to the event log",
                              "isRequired": true,
                              "query": "// The count of messages written to the event log\r\nlet WVDHosts = dynamic([{WVDHosts}]);\r\nEvent\r\n| where WVDHosts contains Computer and EventLog == \"Application\" and EventLevel in (1,2) {EventsToInclude}\r\n| summarize value=count()\r\n| extend label=value, selected=1",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "isHiddenWhenLocked": true,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 0
                              },
                              "timeContextFromParameter": "TimeRange",
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            },
                            {
                              "id": "6daa5288-82ec-43d3-b9df-bc8485c314f4",
                              "version": "KqlParameterItem/1.0",
                              "name": "DistinctEventCount",
                              "type": 10,
                              "description": "The count of distinct messages written to the event log",
                              "isRequired": true,
                              "query": "// The count of distinct messages written to the event log\r\nlet WVDHosts = dynamic([{WVDHosts}]);\r\nEvent\r\n| where WVDHosts contains Computer and EventLog == \"Application\" and EventLevel in (1,2) {EventsToInclude}\r\n| summarize value=dcount(RenderedDescription)+0\r\n| extend label=value, selected=1",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "isHiddenWhenLocked": true,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 0
                              },
                              "timeContextFromParameter": "TimeRange",
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "WvdAgentParameters"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "title": "Host pool details",
                          "items": [
                            {
                              "type": 12,
                              "content": {
                                "version": "NotebookGroup/1.0",
                                "groupType": "editable",
                                "items": [
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{HostPool}?api-version=2022-02-10-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"columns\":[{\"path\":\"$.properties.loadBalancerType\",\"columnid\":\" LoadBalanceType\"},{\"path\":\"$.properties.hostPoolType\",\"columnid\":\"HostPoolType\"},{\"path\":\"$.properties.maxSessionLimit\",\"columnid\":\"MaxSessionLimit\"},{\"path\":\"$.name\",\"columnid\":\"HostPool\"}]}}]}",
                                      "size": 4,
                                      "title": "Hostpool specifics",
                                      "queryType": 12
                                    },
                                    "customWidth": "50",
                                    "conditionalVisibility": {
                                      "parameterName": "TEST",
                                      "comparison": "isEqualTo",
                                      "value": "true"
                                    },
                                    "name": "hostpoolspecifics"
                                  },
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GETARRAY\",\"path\":\"/subscriptions/{Subscription:id}/resourcegroups/{ResourceGroup}/providers/Microsoft.DesktopVirtualization/hostpools/{HostPool:label}/sessionhosts?api-version=2019-01-23-preview\",\"urlParams\":[{\"key\":\"\",\"value\":\"\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"columns\":[{\"path\":\"$.name\",\"columnid\":\"Name\"},{\"path\":\"$.properties.resourceId\",\"columnid\":\"ResoourceId\"},{\"path\":\"$.properties.status\",\"columnid\":\"Status\"},{\"path\":\"$.properties.allowNewSession\",\"columnid\":\"AllowNewSessions\"},{\"path\":\"$.properties.lastHeartBeat\",\"columnid\":\"LastHeartBeat\"},{\"path\":\"$.properties.sxSStackVersion\",\"columnid\":\"StackVersion\"},{\"path\":\"$.properties.lastUpdateTime\",\"columnid\":\"LastUpdateTime\"},{\"path\":\"$.name\",\"columnid\":\"HostPool\",\"substringRegexMatch\":\"(.*)/.*\",\"substringReplace\":\"$1\"},{\"path\":\"$.properties.sessions\",\"columnid\":\"Sessions\"},{\"path\":\"$.id\",\"columnid\":\"URI\"}]}}]}",
                                      "size": 0,
                                      "queryType": 12,
                                      "gridSettings": {
                                        "sortBy": [
                                          {
                                            "itemKey": "Name",
                                            "sortOrder": 1
                                          }
                                        ]
                                      },
                                      "sortBy": [
                                        {
                                          "itemKey": "Name",
                                          "sortOrder": 1
                                        }
                                      ]
                                    },
                                    "conditionalVisibility": {
                                      "parameterName": "NotVisible",
                                      "comparison": "isNotEqualTo"
                                    },
                                    "name": "HostPools"
                                  },
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "WVDConnections\r\n| where State == \"Started\" and TimeGenerated > ago(1d)\r\n| where _ResourceId =~ '{HostPool}'\r\n| summarize Users = dcount(UserName) by SessionHostName\r\n| extend HostPool = '{HostPool}', Computername = strcat(\"{HostPool:label}\",\"/\", SessionHostName)\r\n//| extend ShortName = trim_end(@'\\..*', SessionHostName)\r\n",
                                      "size": 1,
                                      "title": "Host users in 24h",
                                      "queryType": 0,
                                      "resourceType": "microsoft.operationalinsights/workspaces",
                                      "crossComponentResources": [
                                        "{poolla}"
                                      ],
                                      "visualization": "table"
                                    },
                                    "conditionalVisibility": {
                                      "parameterName": "TEST",
                                      "comparison": "isEqualTo",
                                      "value": "true"
                                    },
                                    "name": "HostUsers"
                                  },
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"e0297506-948a-4021-b236-175107e751db\",\"mergeType\":\"leftouter\",\"leftTable\":\"HostPools\",\"rightTable\":\"hostpoolspecifics\",\"leftColumn\":\"HostPool\",\"rightColumn\":\"HostPool\"},{\"id\":\"e0297506-948a-4021-b236-175107e751dc\",\"mergeType\":\"leftouter\",\"leftTable\":\"HostPools\",\"rightTable\":\"HostUsers\",\"leftColumn\":\"Name\",\"rightColumn\":\"Computername\"}],\"projectRename\":[{\"originalName\":\"[HostPools].ResoourceId\",\"mergedName\":\"Host Name\",\"fromId\":\"e0297506-948a-4021-b236-175107e751db\"},{\"originalName\":\"[HostPools].Status\",\"mergedName\":\"Status\",\"fromId\":\"e0297506-948a-4021-b236-175107e751db\"},{\"originalName\":\"[HostPools].LastHeartBeat\",\"mergedName\":\"LastUpdateStatus\",\"fromId\":\"unknown\"},{\"originalName\":\"[HostPools].AllowNewSessions\",\"mergedName\":\"AllowNewSessions\",\"fromId\":\"e0297506-948a-4021-b236-175107e751db\"},{\"originalName\":\"[HostPools].StackVersion\",\"mergedName\":\"StackVersion\",\"fromId\":\"e0297506-948a-4021-b236-175107e751db\"},{\"originalName\":\"[HostPools].HostPool\",\"mergedName\":\"HostPool\",\"fromId\":\"e0297506-948a-4021-b236-175107e751db\"},{\"originalName\":\"[HostPools].Sessions\",\"mergedName\":\"Sessions\",\"fromId\":\"e0297506-948a-4021-b236-175107e751db\"},{\"originalName\":\"[hostpoolspecifics].MaxSessionLimit\",\"mergedName\":\"MaxSessionLimit\",\"fromId\":\"e0297506-948a-4021-b236-175107e751db\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"AvailableSessions\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"Sessions\",\"operator\":\"<=\",\"rightValType\":\"column\",\"rightVal\":\"MaxSessionLimit\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"MaxSessionLimit\\\"] -[\\\"Sessions\\\"]\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"static\",\"resultVal\":\"0\"}}]},{\"originalName\":\"[HostUsers].Users\",\"mergedName\":\"Users\",\"fromId\":\"e0297506-948a-4021-b236-175107e751dc\"},{\"originalName\":\"[HostPools].URI\",\"mergedName\":\"URI\",\"fromId\":\"unknown\"},{\"originalName\":\"[hostpoolspecifics]. LoadBalanceType\",\"mergedName\":\" LoadBalanceType\",\"fromId\":\"unknown\"},{\"originalName\":\"[HostPools].Name\"},{\"originalName\":\"[hostpoolspecifics].resourceGroup\"},{\"originalName\":\"[hostpoolspecifics].HostPool\"},{\"originalName\":\"[hostpoolspecifics].location\"},{\"originalName\":\"[hostpoolspecifics].LoadBalanceType\"},{\"originalName\":\"[hostpoolspecifics].HostPoolType\"},{\"originalName\":\"[HostUsers].Computername\"},{\"originalName\":\"[HostUsers].SessionHostName\"},{\"originalName\":\"[HostUsers].HostPool\"},{\"originalName\":\"[HostPools].LastUpdateStatus\"},{\"originalName\":\"[HostPools].LastUpdateTime\"}]}",
                                      "size": 0,
                                      "exportedParameters": [
                                        {
                                          "fieldName": "URI",
                                          "parameterName": "SelectedComputer"
                                        },
                                        {
                                          "fieldName": "Sessions",
                                          "parameterName": "SelectedSessions",
                                          "parameterType": 1,
                                          "defaultValue": "0"
                                        },
                                        {
                                          "fieldName": "Host Name",
                                          "parameterName": "Computer",
                                          "parameterType": 5
                                        }
                                      ],
                                      "queryType": 7,
                                      "visualization": "table",
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "Status",
                                            "formatter": 18,
                                            "formatOptions": {
                                              "thresholdsOptions": "icons",
                                              "thresholdsGrid": [
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "Unavailable",
                                                  "representation": "Unavailable",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "Available",
                                                  "representation": "success",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "Shutdown",
                                                  "representation": "stopped",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "Default",
                                                  "thresholdValue": null,
                                                  "representation": "unknown",
                                                  "text": "{0}{1}"
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "columnMatch": "LastUpdateStatus",
                                            "formatter": 6,
                                            "formatOptions": {
                                              "customColumnWidthSetting": "27ch"
                                            }
                                          },
                                          {
                                            "columnMatch": "AllowNewSession",
                                            "formatter": 18,
                                            "formatOptions": {
                                              "thresholdsOptions": "icons",
                                              "thresholdsGrid": [
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "true",
                                                  "representation": "Available",
                                                  "text": "Allowed"
                                                },
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "false",
                                                  "representation": "disabled",
                                                  "text": "Drain"
                                                },
                                                {
                                                  "operator": "Default",
                                                  "thresholdValue": null,
                                                  "representation": "Blank",
                                                  "text": "{0}{1}"
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "columnMatch": "HostPool",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "Sessions",
                                            "formatter": 0,
                                            "formatOptions": {
                                              "aggregation": "Sum"
                                            }
                                          },
                                          {
                                            "columnMatch": "MaxSessionLimit",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "AvailableSessions",
                                            "formatter": 4,
                                            "formatOptions": {
                                              "min": 0,
                                              "palette": "blue",
                                              "customColumnWidthSetting": "50fr"
                                            }
                                          },
                                          {
                                            "columnMatch": "Users",
                                            "formatter": 4,
                                            "formatOptions": {
                                              "min": 0,
                                              "palette": "blue",
                                              "customColumnWidthSetting": "50fr"
                                            },
                                            "numberFormat": {
                                              "unit": 0,
                                              "options": {
                                                "style": "decimal",
                                                "useGrouping": false
                                              },
                                              "emptyValCustomText": "0"
                                            }
                                          },
                                          {
                                            "columnMatch": "URI",
                                            "formatter": 5
                                          }
                                        ],
                                        "rowLimit": 5000,
                                        "hierarchySettings": {
                                          "treeType": 1,
                                          "groupBy": [
                                            "HostPool"
                                          ],
                                          "expandTopLevel": true
                                        },
                                        "labelSettings": [
                                          {
                                            "columnId": "LastUpdateStatus",
                                            "label": "Status changed"
                                          },
                                          {
                                            "columnId": "AllowNewSessions",
                                            "label": "New sessions"
                                          },
                                          {
                                            "columnId": "StackVersion",
                                            "label": "Stack version"
                                          },
                                          {
                                            "columnId": "HostPool",
                                            "label": "Host pool"
                                          },
                                          {
                                            "columnId": "AvailableSessions",
                                            "label": "Available sessions"
                                          },
                                          {
                                            "columnId": "Users",
                                            "label": "24h users"
                                          }
                                        ]
                                      },
                                      "sortBy": []
                                    },
                                    "showPin": false,
                                    "name": "hostandperfmerge"
                                  },
                                  {
                                    "type": 12,
                                    "content": {
                                      "version": "NotebookGroup/1.0",
                                      "groupType": "editable",
                                      "items": [
                                        {
                                          "type": 3,
                                          "content": {
                                            "version": "KqlItem/1.0",
                                            "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{HostPool}?api-version=2022-02-10-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"columns\":[{\"path\":\"$.properties.loadBalancerType\",\"columnid\":\"LoadBalanceType\"},{\"path\":\"$.properties.hostPoolType\",\"columnid\":\"HostPoolType\"},{\"path\":\"$.properties.maxSessionLimit\",\"columnid\":\"MaxSessionLimit\"},{\"path\":\"$.name\",\"columnid\":\"HostPool\"}]}}]}",
                                            "size": 4,
                                            "title": "Hostpool specifics",
                                            "queryType": 12
                                          },
                                          "customWidth": "50",
                                          "conditionalVisibility": {
                                            "parameterName": "TEST",
                                            "comparison": "isEqualTo",
                                            "value": "true"
                                          },
                                          "name": "hostpoolspecifics_4tiles"
                                        },
                                        {
                                          "type": 3,
                                          "content": {
                                            "version": "KqlItem/1.0",
                                            "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"72b9c23e-c819-44bb-b2cb-46975a80b339\",\"mergeType\":\"table\",\"leftTable\":\"hostpoolspecifics_4tiles\"}],\"projectRename\":[{\"originalName\":\"[Added column]\",\"mergedName\":\"Title\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"static\",\"resultVal\":\"Host pool type\"}}]},{\"originalName\":\"[hostpoolspecifics_4tiles].HostPoolType\",\"mergedName\":\"HostPoolType\",\"fromId\":\"unknown\"},{\"originalName\":\"[hostpoolspecifics_4tiles].resourceGroup\"},{\"originalName\":\"[hostpoolspecifics_4tiles].location\"},{\"originalName\":\"[hostpoolspecifics_4tiles].LoadBalanceType\"},{\"originalName\":\"[hostpoolspecifics_4tiles].MaxSessionLimit\"},{\"originalName\":\"[hostpoolspecifics_4tiles].HostPool\"},{\"originalName\":\"[hostpoolspecifics_4tiles]. LoadBalanceType\"}]}",
                                            "size": 4,
                                            "queryType": 7,
                                            "visualization": "tiles",
                                            "tileSettings": {
                                              "titleContent": {
                                                "columnMatch": "Title",
                                                "formatter": 1
                                              },
                                              "leftContent": {
                                                "columnMatch": "HostPoolType",
                                                "formatter": 18,
                                                "formatOptions": {
                                                  "thresholdsOptions": "icons",
                                                  "thresholdsGrid": [
                                                    {
                                                      "operator": "Default",
                                                      "thresholdValue": null,
                                                      "representation": "1",
                                                      "text": "{0}{1}"
                                                    }
                                                  ]
                                                }
                                              },
                                              "showBorder": false,
                                              "size": "auto"
                                            }
                                          },
                                          "customWidth": "0",
                                          "showPin": false,
                                          "name": "HostPool-PoolType-Card",
                                          "styleSettings": {
                                            "maxWidth": "50%"
                                          }
                                        },
                                        {
                                          "type": 3,
                                          "content": {
                                            "version": "KqlItem/1.0",
                                            "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"72b9c23e-c819-44bb-b2cb-46975a80b339\",\"mergeType\":\"table\",\"leftTable\":\"hostpoolspecifics_4tiles\"}],\"projectRename\":[{\"originalName\":\"[Added column]\",\"mergedName\":\"Title\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"static\",\"resultVal\":\"Load balancer type\"}}]},{\"originalName\":\"[hostpoolspecifics_4tiles].LoadBalanceType\",\"mergedName\":\"LoadBalanceType\",\"fromId\":\"72b9c23e-c819-44bb-b2cb-46975a80b339\"},{\"originalName\":\"[hostpoolspecifics_4tiles].HostPool\",\"mergedName\":\"HostPool\",\"fromId\":\"72b9c23e-c819-44bb-b2cb-46975a80b339\"},{\"originalName\":\"[hostpoolspecifics_4tiles]. LoadBalanceType\"},{\"originalName\":\"[hostpoolspecifics_4tiles].HostPoolType\"},{\"originalName\":\"[hostpoolspecifics_4tiles].MaxSessionLimit\"}]}",
                                            "size": 4,
                                            "queryType": 7,
                                            "visualization": "tiles",
                                            "tileSettings": {
                                              "titleContent": {
                                                "columnMatch": "Title",
                                                "formatter": 1
                                              },
                                              "leftContent": {
                                                "columnMatch": "LoadBalanceType",
                                                "formatter": 18,
                                                "formatOptions": {
                                                  "thresholdsOptions": "icons",
                                                  "thresholdsGrid": [
                                                    {
                                                      "operator": "Default",
                                                      "thresholdValue": null,
                                                      "representation": "1",
                                                      "text": "{0}{1}"
                                                    }
                                                  ]
                                                }
                                              },
                                              "showBorder": false,
                                              "size": "auto"
                                            }
                                          },
                                          "customWidth": "0",
                                          "showPin": false,
                                          "name": "HostPool-LoadBalanceType-Card",
                                          "styleSettings": {
                                            "maxWidth": "50%"
                                          }
                                        },
                                        {
                                          "type": 3,
                                          "content": {
                                            "version": "KqlItem/1.0",
                                            "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"72b9c23e-c819-44bb-b2cb-46975a80b339\",\"mergeType\":\"table\",\"leftTable\":\"hostpoolspecifics_4tiles\"}],\"projectRename\":[{\"originalName\":\"[Added column]\",\"mergedName\":\"Title\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"static\",\"resultVal\":\"Max sessions\"}}]},{\"originalName\":\"[hostpoolspecifics_4tiles].MaxSessionLimit\",\"mergedName\":\"MaxSessionLimit\",\"fromId\":\"72b9c23e-c819-44bb-b2cb-46975a80b339\"},{\"originalName\":\"[hostpoolspecifics].LoadBalancerType\"},{\"originalName\":\"[hostpoolspecifics].HostPoolType\"},{\"originalName\":\"[hostpoolspecifics].PreferredAppGroupType\"},{\"originalName\":\"[hostpoolspecifics].resourceGroup\"},{\"originalName\":\"[hostpoolspecifics].HostPool\"},{\"originalName\":\"[hostpoolspecifics].location\"},{\"originalName\":\"[hostpoolspecifics].LoadBalanceType\"},{\"originalName\":\"[hostpoolspecifics_4tiles].resourceGroup\"},{\"originalName\":\"[hostpoolspecifics_4tiles].HostPool\"},{\"originalName\":\"[hostpoolspecifics_4tiles].location\"},{\"originalName\":\"[hostpoolspecifics_4tiles].LoadBalanceType\"},{\"originalName\":\"[hostpoolspecifics_4tiles].HostPoolType\"},{\"originalName\":\"[hostpoolspecifics_4tiles]. LoadBalanceType\"}]}",
                                            "size": 4,
                                            "queryType": 7,
                                            "visualization": "tiles",
                                            "tileSettings": {
                                              "titleContent": {
                                                "columnMatch": "Title",
                                                "formatter": 1
                                              },
                                              "leftContent": {
                                                "columnMatch": "MaxSessionLimit",
                                                "formatter": 18,
                                                "formatOptions": {
                                                  "thresholdsOptions": "icons",
                                                  "thresholdsGrid": [
                                                    {
                                                      "operator": "Default",
                                                      "thresholdValue": null,
                                                      "representation": "1",
                                                      "text": "{0}{1}"
                                                    }
                                                  ]
                                                },
                                                "numberFormat": {
                                                  "unit": 0,
                                                  "options": {
                                                    "style": "decimal",
                                                    "useGrouping": true
                                                  }
                                                }
                                              },
                                              "showBorder": false,
                                              "size": "auto"
                                            }
                                          },
                                          "customWidth": "0",
                                          "showPin": false,
                                          "name": "HostPool-MaxSessions-Card",
                                          "styleSettings": {
                                            "maxWidth": "50%"
                                          }
                                        }
                                      ]
                                    },
                                    "customWidth": "50",
                                    "name": "PoolSettings"
                                  },
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{SelectedComputer}/usersessions?api-version=2019-01-23-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"$.properties.userPrincipalName\",\"columnid\":\"User\"},{\"path\":\"$.properties.sessionState\",\"columnid\":\"State\"},{\"path\":\"$.properties.createTime\",\"columnid\":\"Started\"}]}}]}",
                                      "size": 1,
                                      "title": "{SelectedSessions} Session(s) on {Computer:name}",
                                      "noDataMessage": "There are no sessions on the selected host.",
                                      "queryType": 12,
                                      "visualization": "table",
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "User",
                                            "formatter": 1,
                                            "formatOptions": {
                                              "linkTarget": "Url"
                                            }
                                          },
                                          {
                                            "columnMatch": "State",
                                            "formatter": 18,
                                            "formatOptions": {
                                              "thresholdsOptions": "icons",
                                              "thresholdsGrid": [
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "Disconnected",
                                                  "representation": "more",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "Active",
                                                  "representation": "Available",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "Default",
                                                  "thresholdValue": null,
                                                  "representation": "Blank",
                                                  "text": "{0}{1}"
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "columnMatch": "Started",
                                            "formatter": 6,
                                            "formatOptions": {
                                              "customColumnWidthSetting": "21ch"
                                            }
                                          }
                                        ]
                                      },
                                      "tileSettings": {
                                        "titleContent": {
                                          "columnMatch": "Name",
                                          "formatter": 1
                                        },
                                        "subtitleContent": {
                                          "columnMatch": "Status"
                                        },
                                        "leftContent": {
                                          "columnMatch": "Sessions",
                                          "formatter": 12,
                                          "formatOptions": {
                                            "palette": "auto"
                                          },
                                          "numberFormat": {
                                            "unit": 17,
                                            "options": {
                                              "style": "decimal",
                                              "useGrouping": false,
                                              "maximumFractionDigits": 2,
                                              "maximumSignificantDigits": 3
                                            }
                                          }
                                        },
                                        "showBorder": false,
                                        "size": "auto"
                                      }
                                    },
                                    "customWidth": "45",
                                    "conditionalVisibilities": [
                                      {
                                        "parameterName": "SelectedComputer",
                                        "comparison": "isNotEqualTo",
                                        "value": ""
                                      },
                                      {
                                        "parameterName": "SelectedSessions",
                                        "comparison": "isNotEqualTo",
                                        "value": "0"
                                      }
                                    ],
                                    "name": "hostsessions",
                                    "styleSettings": {
                                      "margin": "0px",
                                      "padding": "0px"
                                    }
                                  },
                                  {
                                    "type": 1,
                                    "content": {
                                      "json": "#### Please select a host to display current sessions here.",
                                      "style": "info"
                                    },
                                    "customWidth": "45",
                                    "conditionalVisibility": {
                                      "parameterName": "SelectedComputer",
                                      "comparison": "isEqualTo"
                                    },
                                    "name": "hostsessions_direction_SelectHost"
                                  },
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "resources\r\n| where type == \"microsoft.desktopvirtualization/hostpools\"\r\n| project Customer=subscriptionId, [\"Host Pool Name\"]=id, Description=properties.description, location, resourceGroup, LBType=properties.loadBalancerType, SessionLimit=properties.maxSessionLimit, HostPoolType=properties.hostPoolType, name",
                                      "size": 1,
                                      "title": "Host Pools",
                                      "exportedParameters": [
                                        {
                                          "fieldName": "name",
                                          "parameterName": "HostPoolName"
                                        },
                                        {
                                          "fieldName": "resourceGroup",
                                          "parameterName": "rgparamater",
                                          "parameterType": 1
                                        },
                                        {
                                          "fieldName": "SessionLimit",
                                          "parameterName": "SessionLimit",
                                          "parameterType": 1
                                        }
                                      ],
                                      "queryType": 1,
                                      "resourceType": "microsoft.resourcegraph/resources",
                                      "crossComponentResources": [
                                        "{Subscription}"
                                      ],
                                      "visualization": "table",
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "$gen_group",
                                            "formatter": 13,
                                            "formatOptions": {
                                              "linkTarget": "Resource",
                                              "showIcon": true,
                                              "customColumnWidthSetting": "50ch"
                                            }
                                          },
                                          {
                                            "columnMatch": "Customer",
                                            "formatter": 5,
                                            "formatOptions": {
                                              "linkTarget": "Resource"
                                            }
                                          },
                                          {
                                            "columnMatch": "LBType",
                                            "formatter": 1
                                          },
                                          {
                                            "columnMatch": "SessionLimit",
                                            "formatter": 1
                                          },
                                          {
                                            "columnMatch": "HostPoolType",
                                            "formatter": 18,
                                            "formatOptions": {
                                              "thresholdsOptions": "colors",
                                              "thresholdsGrid": [
                                                {
                                                  "operator": "!=",
                                                  "thresholdValue": "Pooled",
                                                  "representation": "lightBlue",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "Default",
                                                  "thresholdValue": null,
                                                  "text": "{0}{1}"
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "columnMatch": "name",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "SeesionLimit",
                                            "formatter": 1
                                          }
                                        ],
                                        "hierarchySettings": {
                                          "treeType": 1,
                                          "groupBy": [
                                            "Customer"
                                          ],
                                          "expandTopLevel": true
                                        }
                                      },
                                      "sortBy": []
                                    },
                                    "name": "query - 106"
                                  },
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "desktopvirtualizationresources\r\n| where type == \"microsoft.desktopvirtualization/hostpools/sessionhosts\"\r\n| extend SplitAll=split(name,'/')\r\n| extend HostPool = SplitAll[0]\r\n| extend SessionHostNameSplit = tostring(SplitAll[1])\r\n| extend SplitAll2=split(SessionHostNameSplit,'.')\r\n| extend SessionHostName = tostring(SplitAll2[0])\r\n| extend SessionLimit={SessionLimit}\r\n| where HostPool == \"{HostPoolName}\"\r\n| where resourceGroup == \"{rgparamater}\"\r\n| project id, SessionHostName, Status=properties.status, Sessions=properties.sessions, SessionLimit, AllowSessions=properties.allowNewSession, AssignedUser=properties.assignedUser, OS=properties.osVersion, UpdateStatus=properties.updateStatus, UpdateState=properties.updateState, SxSVersion=properties.sxSStackVersion, ImageType=properties.imageType\r\n\t| join kind=leftouter(\r\nResources\r\n| where type =~ 'microsoft.compute/virtualmachines'\r\n| extend SplitAll=split(name, '.')\r\n| extend SessionHostName=tostring(SplitAll[0])\r\n| project SessionHostName, VMStatus=properties.extended.instanceView.powerState.displayStatus) on SessionHostName\r\n| project SessionHostName, VMStatus, Status, Sessions, SessionLimit, AllowSessions, AssignedUser, OS, UpdateStatus, UpdateState, SxSVersion, ImageType\r\n| sort by SessionHostName",
                                      "size": 3,
                                      "title": "Select Host Pool Above To Display Session Host Details",
                                      "noDataMessageStyle": 2,
                                      "exportFieldName": "SessionHostName",
                                      "exportParameterName": "SessionHostName2",
                                      "showExportToExcel": true,
                                      "queryType": 1,
                                      "resourceType": "microsoft.resourcegraph/resources",
                                      "crossComponentResources": [
                                        "{Subscription}"
                                      ],
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "VMStatus",
                                            "formatter": 18,
                                            "formatOptions": {
                                              "thresholdsOptions": "icons",
                                              "thresholdsGrid": [
                                                {
                                                  "operator": "!=",
                                                  "thresholdValue": "VM running",
                                                  "representation": "2",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "Default",
                                                  "thresholdValue": null,
                                                  "representation": "success",
                                                  "text": "{0}{1}"
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "columnMatch": "Status",
                                            "formatter": 18,
                                            "formatOptions": {
                                              "thresholdsOptions": "colors",
                                              "thresholdsGrid": [
                                                {
                                                  "operator": "!=",
                                                  "thresholdValue": "Available",
                                                  "representation": "redBright",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "Default",
                                                  "thresholdValue": null,
                                                  "representation": "green",
                                                  "text": "{0}{1}"
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "columnMatch": "Sessions",
                                            "formatter": 8,
                                            "formatOptions": {
                                              "min": 0,
                                              "max": 10,
                                              "palette": "redBright"
                                            }
                                          },
                                          {
                                            "columnMatch": "AllowSessions",
                                            "formatter": 18,
                                            "formatOptions": {
                                              "thresholdsOptions": "colors",
                                              "thresholdsGrid": [
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "false",
                                                  "representation": "redBright",
                                                  "text": "Not Allowed"
                                                },
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "true",
                                                  "representation": "green",
                                                  "text": "Allowed"
                                                },
                                                {
                                                  "operator": "Default",
                                                  "thresholdValue": null,
                                                  "representation": "green",
                                                  "text": "{0}{1}"
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "columnMatch": "AssignedUser",
                                            "formatter": 18,
                                            "formatOptions": {
                                              "thresholdsOptions": "colors",
                                              "thresholdsGrid": [
                                                {
                                                  "operator": "!=",
                                                  "thresholdValue": "null",
                                                  "representation": "lightBlue",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "Default",
                                                  "thresholdValue": null,
                                                  "text": "{0}{1}"
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "columnMatch": "OS",
                                            "formatter": 1
                                          },
                                          {
                                            "columnMatch": "UpdateStatus",
                                            "formatter": 18,
                                            "formatOptions": {
                                              "thresholdsOptions": "icons",
                                              "thresholdsGrid": [
                                                {
                                                  "operator": "!=",
                                                  "thresholdValue": "NotInProgress",
                                                  "representation": "2",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "Default",
                                                  "thresholdValue": null,
                                                  "representation": "success",
                                                  "text": "{0}{1}"
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "columnMatch": "UpdateState",
                                            "formatter": 18,
                                            "formatOptions": {
                                              "thresholdsOptions": "icons",
                                              "thresholdsGrid": [
                                                {
                                                  "operator": "!=",
                                                  "thresholdValue": "Succeeded",
                                                  "representation": "2",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "Default",
                                                  "thresholdValue": null,
                                                  "representation": "success",
                                                  "text": "{0}{1}"
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "columnMatch": "SxSVersion",
                                            "formatter": 1
                                          }
                                        ],
                                        "filter": true
                                      }
                                    },
                                    "name": "query - 24"
                                  },
                                  {
                                    "type": 1,
                                    "content": {
                                      "json": "### [Research Health API Codes - Microsoft Link](https://learn.microsoft.com/en-us/rest/api/desktopvirtualization/session-hosts/list?tabs=HTTP#healthcheckname)\r\n\r\n### [Research Health Check Type - Microsoft Link](https://learn.microsoft.com/en-us/azure/virtual-desktop/troubleshoot-statuses-checks#health-check)"
                                    },
                                    "name": "text - 10"
                                  },
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "desktopvirtualizationresources\r\n| where type == \"microsoft.desktopvirtualization/hostpools/sessionhosts\"\r\n| extend SplitAll=split(name,'/')\r\n| extend HostPool = SplitAll[0]\r\n| extend SessionHostNameSplit = tostring(SplitAll[1])\r\n| extend SplitAll2=split(SessionHostNameSplit,'.')\r\n| extend SessionHostName = tostring(SplitAll2[0])\r\n| extend SessionLimit={SessionLimit}\r\n| where HostPool == \"{HostPoolName}\"\r\n| where SessionHostName == \"{SessionHostName2}\"\r\n| mvexpand HealthCheckExpand = properties['sessionHostHealthCheckResults']\r\n| project SessionHostNameSplit, HealthCheckResult=HealthCheckExpand.healthCheckResult, HealthCheckName=HealthCheckExpand.healthCheckName, Message=HealthCheckExpand.additionalFailureDetails.message, HealthCheckExpand\r\n",
                                      "size": 0,
                                      "queryType": 1,
                                      "resourceType": "microsoft.resourcegraph/resources",
                                      "crossComponentResources": [
                                        "{Subscription}"
                                      ],
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "HealthCheckResult",
                                            "formatter": 18,
                                            "formatOptions": {
                                              "thresholdsOptions": "colors",
                                              "thresholdsGrid": [
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "HealthCheckFailed",
                                                  "representation": "redBright",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "Default",
                                                  "thresholdValue": null,
                                                  "representation": "green",
                                                  "text": "{0}{1}"
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "columnMatch": "HealthCheckName",
                                            "formatter": 1
                                          },
                                          {
                                            "columnMatch": "Message",
                                            "formatter": 1,
                                            "formatOptions": {
                                              "customColumnWidthSetting": "100ch"
                                            }
                                          },
                                          {
                                            "columnMatch": "HealthCheckExpand",
                                            "formatter": 7,
                                            "formatOptions": {
                                              "linkTarget": "CellDetails",
                                              "linkLabel": "🔍 View Details",
                                              "linkIsContextBlade": true
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    "name": "query - 9"
                                  }
                                ]
                              },
                              "name": "HostPoolGroup"
                            }
                          ]
                        },
                        "name": "SessionHostDetailsGroup",
                        "styleSettings": {
                          "showBorder": true
                        }
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "Overview"
                  },
                  "name": "Overview"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Overview"
            },
            "name": "Overview Group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDConnections | summarize arg_max(TimeGenerated, *) by CorrelationId\r\n| summarize arg_max(TimeGenerated, *) by CorrelationId  // workaround to filter \"double-entries\"\r\n| join kind=leftouter (\r\n    WVDErrors | summarize arg_max(TimeGenerated, *) by CorrelationId\r\n) on CorrelationId\r\n| extend HostPool=split(_ResourceId,\"/\")[8] \r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Unspecified error\",\"Unspecified error\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The system cannot open the file.\",\"The system cannot open the file.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The RPC server is unavailable.\",\"The RPC server is unavailable.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No such interface supported\",\"No such interface supported\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No process is on the other end of the pipe.\",\"No process is on the other end of the pipe.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Operation aborted\",\"\tOperation aborted\",CodeSymbolic) // workaround\r\n| where  TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\" and UserName !=\"\" and (\"{UserSelector}\"==\"\" or UserName in ('' {UserSelector})) and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})) and (column_ifexists(\"CodeSymbolic\",\"*\")==\"*\" or \"{ErrorSelector}\"==\"\" or column_ifexists(\"CodeSymbolic\",\"\") in ('' {ErrorSelector}) or CodeSymbolic==\"\")\r\n| summarize Success=countif(CodeSymbolic==\"\"), Errors=countif(CodeSymbolic!=\"\") \r\n| extend Temp = pack(\"Success\",Success,\"Errors\",Errors )\r\n| mv-expand kind=array Temp\r\n| project Action=tostring(Temp[0]), Count=toint(Temp[1])",
                    "size": 0,
                    "title": "Brokered sessions",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "piechart",
                    "gridSettings": {
                      "rowLimit": 1000,
                      "filter": true
                    },
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "HostPool",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "Failed",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "rightContent": {
                        "columnMatch": "Failed"
                      },
                      "showBorder": true
                    },
                    "graphSettings": {
                      "type": 0
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "Logins"
                  },
                  "showPin": true,
                  "name": "query - 20"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Duration for the login process from the WVD ARM backend. This includes all steps between clicking the application icon to get notified by the RD agent that the session is established (not for reconnected sessions). \r\n// This includes entering the credentials for the session hosts (if not saved). Note: This inculdes re-connected sessions and no failed connections\r\nWVDConnections \r\n| extend HostPool=split(_ResourceId,\"/\")[8] \r\n| join kind=leftouter (WVDErrors) on CorrelationId\r\n| where  TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\" and UserName !=\"\" and (\"{UserSelector}\"==\"\" or UserName in ('' {UserSelector})) and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})) and (column_ifexists(\"CodeSymbolic\",\"*\")==\"*\" or \"{ErrorSelector}\"==\"\" or column_ifexists(\"CodeSymbolic\",\"\") in ('' {ErrorSelector})) and (State ==\"Connected\" or State == \"Started\")\r\n| extend Multi=split(_ResourceId, \"/\")\r\n| project ResourceAlias, HostPool=toupper(HP=Multi[8]), SessionHost=SessionHostName , UserName , CorrelationId, TimeGenerated, ResourceGroup=Multi[4], DesktopGroup_s=toupper(strcat(RG=Multi[4],\".\", HP=Multi[8])) \r\n| order by TimeGenerated desc \r\n| summarize StartTime=min(TimeGenerated), max(TimeGenerated) by CorrelationId, User=UserName, HostPool, SessionHost\r\n| extend Duration=max_TimeGenerated-StartTime | where Duration !=0 \r\n| project StartTime, User, HostPool, SessionHost, Duration, CorrelationId\r\n| summarize [\"Duration in seconds\"]=avg(Duration/1s) by HostPool",
                    "size": 0,
                    "title": "Session login time (s)",
                    "timeContext": {
                      "durationMs": 259200000
                    },
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "barchart",
                    "gridSettings": {
                      "filter": true
                    },
                    "chartSettings": {
                      "showLegend": true,
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 24,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "Logins"
                  },
                  "showPin": true,
                  "name": "query - 20 - Copy"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "This chart shows the number of successful and un-successful brokered sessions by host pools."
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "Logins"
                  },
                  "name": "text - 20"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "This chart shows the average login time for users to the host pools. The duration covers all steps between clicking the application icon up to notification of the RD agent that the session is ready. This includes all successful logins and reconnections to sessions."
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "Logins"
                  },
                  "name": "text - 20 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDErrors \r\n| summarize arg_max(TimeGenerated, *) by CorrelationId  // workaround to filter \"double-entries\"\r\n| join kind=leftouter (\r\n    WVDConnections | summarize arg_max(TimeGenerated, *) by CorrelationId\r\n) on CorrelationId  // join the latest WVDConnection\r\n| extend HostPool=split(_ResourceId,\"/\")[8]\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Unspecified error\",\"Unspecified error\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The system cannot open the file.\",\"The system cannot open the file.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The RPC server is unavailable.\",\"The RPC server is unavailable.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No such interface supported\",\"No such interface supported\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No process is on the other end of the pipe.\",\"No process is on the other end of the pipe.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Operation aborted\",\"\tOperation aborted\",CodeSymbolic) // workaround\r\n| where  TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\" and UserName !=\"\" and (\"{UserSelector}\"==\"\" or UserName in ('' {UserSelector})) and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})) and (column_ifexists(\"CodeSymbolic\",\"*\")==\"*\" or \"{ErrorSelector}\"==\"\" or column_ifexists(\"CodeSymbolic\",\"\") in ('' {ErrorSelector}))\r\n| extend IPSegmentC=strcat(split(ClientSideIPAddress,\".\")[0],\".\",split(ClientSideIPAddress,\".\")[1],\".\",split(ClientSideIPAddress,\".\")[2])\r\n| summarize Count=count() by CodeSymbolic",
                    "size": 1,
                    "title": "Errors by reason",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "series",
                    "exportParameterName": "Select_ErrorSourceSignature",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "piechart",
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "Logins"
                  },
                  "name": "query - 12"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDErrors \r\n| summarize arg_max(TimeGenerated, *) by CorrelationId  // workaround to filter \"double-entries\"\r\n| join kind=leftouter (\r\n    WVDConnections | summarize arg_max(TimeGenerated, *) by CorrelationId\r\n) on CorrelationId  // join the latest WVDConnection\r\n| extend HostPool=split(_ResourceId,\"/\")[8]\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Unspecified error\",\"Unspecified error\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The system cannot open the file.\",\"The system cannot open the file.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The RPC server is unavailable.\",\"The RPC server is unavailable.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No such interface supported\",\"No such interface supported\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No process is on the other end of the pipe.\",\"No process is on the other end of the pipe.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Operation aborted\",\"\tOperation aborted\",CodeSymbolic) // workaround\r\n| where  TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\" and UserName !=\"\" and (\"{UserSelector}\"==\"\" or UserName in ('' {UserSelector})) and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})) and (column_ifexists(\"CodeSymbolic\",\"*\")==\"*\" or \"{ErrorSelector}\"==\"\" or column_ifexists(\"CodeSymbolic\",\"\") in ('' {ErrorSelector}))\r\n| extend IPSegmentC=strcat(split(ClientSideIPAddress,\".\")[0],\".\",split(ClientSideIPAddress,\".\")[1],\".\",split(ClientSideIPAddress,\".\")[2])\r\n| summarize Count=count() by Source",
                    "size": 1,
                    "title": "Errors by source",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "series",
                    "exportParameterName": "Select_ErrorSourceSignature",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "piechart",
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "Logins"
                  },
                  "name": "query - 13"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDCheckpoints\r\n| where  TimeGenerated {Brush_OverviewDetail} and CorrelationId==\"{Select_DetailBrushCorrelationId}\"\r\n| project CorrelationId, TimeStamp=TimeGenerated, User=UserName, Activity=ActivityType, Source, Details=Parameters\r\n| order by TimeStamp asc\r\n\r\n\r\n",
                    "size": 1,
                    "title": "Trace by selected event",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "exportToExcelOptions": "all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "CorrelationId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Signature",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Success",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "Errors",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "Error rate",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "percent",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "customWidth": "100",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Logins"
                    },
                    {
                      "parameterName": "Select_DetailBrushCorrelationId",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "name": "query - 13 - Copy - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDCheckpoints\r\n| where  TimeGenerated {TimeRange} and CorrelationId==\"{Select_AverUserUserDetail}\"\r\n| project CorrelationId, TimeStamp=TimeGenerated, User=UserName, Activity=ActivityType, Source, Details=Parameters\r\n| order by TimeStamp asc\r\n\r\n\r\n",
                    "size": 1,
                    "title": "Trace by selected event from {Select_AverUserUser}",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "exportToExcelOptions": "all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "CorrelationId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Signature",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Success",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "Errors",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "Error rate",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "percent",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "customWidth": "100",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Logins"
                    },
                    {
                      "parameterName": "Select_AverUserUserDetail",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "name": "query - 13 - Copy - Copy - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDErrors | summarize arg_max(TimeGenerated, *) by CorrelationId\r\n| extend HostPool=split(_ResourceId,\"/\")[8]\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Unspecified error\",\"Unspecified error\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The system cannot open the file.\",\"The system cannot open the file.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The RPC server is unavailable.\",\"The RPC server is unavailable.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No such interface supported\",\"No such interface supported\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No process is on the other end of the pipe.\",\"No process is on the other end of the pipe.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Operation aborted\",\"\tOperation aborted\",CodeSymbolic) // workaround\r\n| where  TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\" and UserName !=\"\" and (\"{UserSelector}\"==\"\" or UserName in ('' {UserSelector})) and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})) and (column_ifexists(\"CodeSymbolic\",\"*\")==\"*\" or \"{ErrorSelector}\"==\"\" or column_ifexists(\"CodeSymbolic\",\"\") in ('' {ErrorSelector}) or CodeSymbolic==\"\")\r\n| where Source==\"{Select_ErrorSourceSignature}\" or CodeSymbolic==\"{Select_ErrorSourceSignature}\"\r\n| summarize Errors=count() by CodeSymbolic\r\n| order by Errors desc\r\n",
                    "size": 1,
                    "title": "Errors by source/reason: {Select_ErrorSourceSignature}",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "CodeSymbolic",
                    "exportParameterName": "Select_CodeSymbolicSignature",
                    "exportToExcelOptions": "all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Signature",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Success",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "Errors",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "Error rate",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "percent",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "customWidth": "100",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Logins"
                    },
                    {
                      "parameterName": "Select_ErrorSourceSignature",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "name": "query - 13 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDErrors | summarize arg_max(TimeGenerated, *) by CorrelationId\r\n| extend HostPool=split(_ResourceId,\"/\")[8]\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Unspecified error\",\"Unspecified error\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The system cannot open the file.\",\"The system cannot open the file.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The RPC server is unavailable.\",\"The RPC server is unavailable.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No such interface supported\",\"No such interface supported\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No process is on the other end of the pipe.\",\"No process is on the other end of the pipe.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Operation aborted\",\"\tOperation aborted\",CodeSymbolic) // workaround\r\n| where  TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\" and UserName !=\"\" and (\"{UserSelector}\"==\"\" or UserName in ('' {UserSelector})) and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})) and CodeSymbolic==\"{Select_CodeSymbolicSignature}\"\r\n| where Source==\"{Select_ErrorSourceSignature}\" or CodeSymbolic==\"{Select_ErrorSourceSignature}\"\r\n| summarize Errors=count() by Message\r\n| order by Errors desc\r\n",
                    "size": 1,
                    "title": "Errors by source and symbolic: {Select_ErrorSourceSignature} / {Select_CodeSymbolicSignature}",
                    "timeContextFromParameter": "TimeRange",
                    "exportToExcelOptions": "all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Signature",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Success",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "Errors",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "Error rate",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "percent",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_bar_Errors_1",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_bar_Errors_1",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "customWidth": "100",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Logins"
                    },
                    {
                      "parameterName": "Select_CodeSymbolicSignature",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "name": "query - 13 - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDConnections | summarize arg_max(TimeGenerated, *) by CorrelationId\r\n| summarize arg_max(TimeGenerated, *) by CorrelationId  // workaround to filter \"double-entries\"\r\n| join kind=leftouter (\r\n    WVDErrors | summarize arg_max(TimeGenerated, *) by CorrelationId\r\n) on CorrelationId\r\n| extend HostPool=split(_ResourceId,\"/\")[8]\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Unspecified error\",\"Unspecified error\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The system cannot open the file.\",\"The system cannot open the file.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The RPC server is unavailable.\",\"The RPC server is unavailable.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No such interface supported\",\"No such interface supported\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No process is on the other end of the pipe.\",\"No process is on the other end of the pipe.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Operation aborted\",\"\tOperation aborted\",CodeSymbolic) // workaround\r\n| where  TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\" and UserName !=\"\" and (\"{UserSelector}\"==\"\" or UserName in ('' {UserSelector})) and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})) and (column_ifexists(\"CodeSymbolic\",\"*\")==\"*\" or \"{ErrorSelector}\"==\"\" or column_ifexists(\"CodeSymbolic\",\"\") in ('' {ErrorSelector}) or CodeSymbolic==\"\")\r\n| extend IPSegmentC=strcat(split(ClientSideIPAddress,\".\")[0],\".\",split(ClientSideIPAddress,\".\")[1],\".\",split(ClientSideIPAddress,\".\")[2])\r\n| extend Signature=strcat(ClientType,\"#\",ClientVersion)\r\n| summarize Success=countif(CodeSymbolic==\"\"), Errors=countif(CodeSymbolic!=\"\") by ClientType, ClientVersion, Signature\r\n| extend [\"Error rate\"]=Errors*1.0/(Success+Errors)\r\n| order by Errors\r\n",
                    "size": 1,
                    "title": "Errors by client",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "Signature",
                    "exportParameterName": "Select_SourceSignature",
                    "showExportToExcel": true,
                    "exportToExcelOptions": "all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Signature",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Success",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "Errors",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "Error rate",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "percent",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_bar_Error rate_5",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_bar_Error rate_5",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "Logins"
                  },
                  "name": "query - 13 - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDConnections | summarize arg_max(TimeGenerated, *) by CorrelationId\r\n| summarize arg_max(TimeGenerated, *) by CorrelationId  // workaround to filter \"double-entries\"\r\n| join kind=leftouter (\r\n    WVDErrors | summarize arg_max(TimeGenerated, *) by CorrelationId\r\n) on CorrelationId\r\n| extend HostPool=split(_ResourceId,\"/\")[8]\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Unspecified error\",\"Unspecified error\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The system cannot open the file.\",\"The system cannot open the file.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The RPC server is unavailable.\",\"The RPC server is unavailable.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No such interface supported\",\"No such interface supported\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No process is on the other end of the pipe.\",\"No process is on the other end of the pipe.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Operation aborted\",\"\tOperation aborted\",CodeSymbolic) // workaround\r\n| where  TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\" and UserName !=\"\" and (\"{UserSelector}\"==\"\" or UserName in ('' {UserSelector})) and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})) and (column_ifexists(\"CodeSymbolic\",\"*\")==\"*\" or \"{ErrorSelector}\"==\"\" or column_ifexists(\"CodeSymbolic\",\"\") in ('' {ErrorSelector}) or CodeSymbolic==\"\")\r\n| extend IPSegmentC=strcat(split(ClientSideIPAddress,\".\")[0],\".\",split(ClientSideIPAddress,\".\")[1],\".\",split(ClientSideIPAddress,\".\")[2])\r\n| summarize Success=countif(CodeSymbolic==\"\"), Errors=countif(CodeSymbolic!=\"\") by [\"IP-Segment (C)\"]=IPSegmentC\r\n| extend [\"Error rate\"]=Errors*1.0/(Success+Errors)\r\n| order by Errors",
                    "size": 1,
                    "title": "Errors by IP segment (class C)",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "IP-Segment (C)",
                    "exportParameterName": "Select_SourceSignature",
                    "showExportToExcel": true,
                    "exportToExcelOptions": "all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Success",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "Errors",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "Error rate",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "percent",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "Logins"
                  },
                  "name": "query - 13 - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDConnections | summarize arg_max(TimeGenerated, *) by CorrelationId\r\n| summarize arg_max(TimeGenerated, *) by CorrelationId  // workaround to filter \"double-entries\"\r\n| join kind=leftouter (\r\n    WVDErrors | summarize arg_max(TimeGenerated, *) by CorrelationId\r\n) on CorrelationId\r\n| extend HostPool=split(_ResourceId,\"/\")[8]\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Unspecified error\",\"Unspecified error\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The system cannot open the file.\",\"The system cannot open the file.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The RPC server is unavailable.\",\"The RPC server is unavailable.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No such interface supported\",\"No such interface supported\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No process is on the other end of the pipe.\",\"No process is on the other end of the pipe.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Operation aborted\",\"\tOperation aborted\",CodeSymbolic) // workaround\r\n| where  TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\" and UserName !=\"\" and (\"{UserSelector}\"==\"\" or UserName in ('' {UserSelector})) and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})) and (column_ifexists(\"CodeSymbolic\",\"*\")==\"*\" or \"{ErrorSelector}\"==\"\" or column_ifexists(\"CodeSymbolic\",\"\") in ('' {ErrorSelector}) or CodeSymbolic==\"\")\r\n| extend IPSegmentC=strcat(split(ClientSideIPAddress,\".\")[0],\".\",split(ClientSideIPAddress,\".\")[1],\".\",split(ClientSideIPAddress,\".\")[2])\r\n| summarize Success=countif(CodeSymbolic==\"\"), Errors=countif(CodeSymbolic!=\"\") by Version=SessionHostAgentVersion\r\n| extend [\"Error rate\"]=Errors*1.0/(Success+Errors)\r\n| order by Errors",
                    "size": 1,
                    "title": "Errors by Session Host Agent",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "Version",
                    "exportParameterName": "Select_SourceSignature",
                    "showExportToExcel": true,
                    "exportToExcelOptions": "all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Success",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "Errors",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "Error rate",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "percent",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "Logins"
                  },
                  "name": "query - 13 - Copy - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDConnections | summarize arg_max(TimeGenerated, *) by CorrelationId\r\n| summarize arg_max(TimeGenerated, *) by CorrelationId  // workaround to filter \"double-entries\"\r\n| join kind=leftouter (\r\n    WVDErrors | summarize arg_max(TimeGenerated, *) by CorrelationId\r\n) on CorrelationId\r\n| extend HostPool=split(_ResourceId,\"/\")[8]\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Unspecified error\",\"Unspecified error\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The system cannot open the file.\",\"The system cannot open the file.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The RPC server is unavailable.\",\"The RPC server is unavailable.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No such interface supported\",\"No such interface supported\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No process is on the other end of the pipe.\",\"No process is on the other end of the pipe.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Operation aborted\",\"\tOperation aborted\",CodeSymbolic) // workaround\r\n| where  TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\" and UserName !=\"\" and (\"{UserSelector}\"==\"\" or UserName in ('' {UserSelector})) and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})) and (column_ifexists(\"CodeSymbolic\",\"*\")==\"*\" or \"{ErrorSelector}\"==\"\" or column_ifexists(\"CodeSymbolic\",\"\") in ('' {ErrorSelector}) or CodeSymbolic==\"\")\r\n| extend IPSegmentC=strcat(split(ClientSideIPAddress,\".\")[0],\".\",split(ClientSideIPAddress,\".\")[1],\".\",split(ClientSideIPAddress,\".\")[2]),ClientSignature=strcat(ClientType,\"#\",ClientVersion)\r\n| where IPSegmentC==\"{Select_SourceSignature}\" or ClientSignature==\"{Select_SourceSignature}\" or SessionHostAgentVersion==\"{Select_SourceSignature}\"\r\n| extend CodeSymbolic=iff(CodeSymbolic==\"\",\"Success\",CodeSymbolic)\r\n| where CodeSymbolic!=\"Success\"\r\n| summarize Count=count() by CodeSymbolic",
                    "size": 0,
                    "title": "Errors raised by category (in 15m bins) for {Select_SourceSignature}",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "series",
                    "exportParameterName": "Select_DetailCodeSymbolic",
                    "exportDefaultValue": "-",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "barchart",
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "customWidth": "30",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Logins"
                    },
                    {
                      "parameterName": "Select_SourceSignature",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "name": "query - 14 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDConnections | summarize arg_max(TimeGenerated, *) by CorrelationId\r\n| summarize arg_max(TimeGenerated, *) by CorrelationId  // workaround to filter \"double-entries\"\r\n| join kind=leftouter (\r\n    WVDErrors | summarize arg_max(TimeGenerated, *) by CorrelationId\r\n) on CorrelationId\r\n| extend HostPool=split(_ResourceId,\"/\")[8]\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Unspecified error\",\"Unspecified error\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The system cannot open the file.\",\"The system cannot open the file.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The RPC server is unavailable.\",\"The RPC server is unavailable.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No such interface supported\",\"No such interface supported\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No process is on the other end of the pipe.\",\"No process is on the other end of the pipe.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Operation aborted\",\"\tOperation aborted\",CodeSymbolic) // workaround\r\n| where  TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\" and UserName !=\"\" and (\"{UserSelector}\"==\"\" or UserName in ('' {UserSelector})) and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})) and (column_ifexists(\"CodeSymbolic\",\"*\")==\"*\" or \"{ErrorSelector}\"==\"\" or column_ifexists(\"CodeSymbolic\",\"\") in ('' {ErrorSelector}) or CodeSymbolic==\"\")\r\n| extend IPSegmentC=strcat(split(ClientSideIPAddress,\".\")[0],\".\",split(ClientSideIPAddress,\".\")[1],\".\",split(ClientSideIPAddress,\".\")[2]),ClientSignature=strcat(ClientType,\"#\",ClientVersion)\r\n| where IPSegmentC==\"{Select_SourceSignature}\" or ClientSignature==\"{Select_SourceSignature}\" or SessionHostAgentVersion==\"{Select_SourceSignature}\"\r\n| where \"{Select_DetailCodeSymbolic}\"==\"-\" or \"{Select_DetailCodeSymbolic}\"==\"\" or CodeSymbolic==\"{Select_DetailCodeSymbolic}\"\r\n| extend CodeSymbolic=iff(CodeSymbolic==\"\",\"Success\",CodeSymbolic)\r\n| summarize Count=count() by bin(TimeGenerated, 15m), CodeSymbolic",
                    "size": 0,
                    "title": "Errors raised by time (in 15m bins) for {Select_SourceSignature}   {Select_DetailCodeSymbolic}",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "scatterchart",
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "customWidth": "70",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Logins"
                    },
                    {
                      "parameterName": "Select_SourceSignature",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "name": "query - 14"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDErrors \r\n| extend HostPool=split(_ResourceId,\"/\")[8]\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Unspecified error\",\"Unspecified error\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The system cannot open the file.\",\"The system cannot open the file.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The RPC server is unavailable.\",\"The RPC server is unavailable.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No such interface supported\",\"No such interface supported\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No process is on the other end of the pipe.\",\"No process is on the other end of the pipe.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Operation aborted\",\"\tOperation aborted\",CodeSymbolic) // workaround\r\n| where  TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\" and UserName !=\"\" and (\"{UserSelector}\"==\"\" or UserName in ('' {UserSelector})) and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})) and (column_ifexists(\"CodeSymbolic\",\"*\")==\"*\" or \"{ErrorSelector}\"==\"\" or column_ifexists(\"CodeSymbolic\",\"\") in ('' {ErrorSelector}))\r\n| summarize Count=count() by bin(TimeGenerated, 15m), CodeSymbolic",
                    "size": 0,
                    "title": "Errors raised by time (in 15m bins)",
                    "timeContextFromParameter": "TimeRange",
                    "timeBrushParameterName": "Brush_Overview",
                    "timeBrushExportOnlyWhenBrushed": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "scatterchart",
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "Logins"
                  },
                  "name": "query - 14 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDErrors \r\n| extend HostPool=split(_ResourceId,\"/\")[8]\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Unspecified error\",\"Unspecified error\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The system cannot open the file.\",\"The system cannot open the file.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The RPC server is unavailable.\",\"The RPC server is unavailable.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No such interface supported\",\"No such interface supported\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No process is on the other end of the pipe.\",\"No process is on the other end of the pipe.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Operation aborted\",\"\tOperation aborted\",CodeSymbolic) // workaround\r\n| where  TimeGenerated {Brush_Overview} and HostPool==\"{HostPoolOld}\" and UserName !=\"\" and (\"{UserSelector}\"==\"\" or UserName in ('' {UserSelector})) and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})) and (column_ifexists(\"CodeSymbolic\",\"*\")==\"*\" or \"{ErrorSelector}\"==\"\" or column_ifexists(\"CodeSymbolic\",\"\") in ('' {ErrorSelector}))\r\n| summarize Count=count() by TimeGenerated, CodeSymbolic",
                    "size": 0,
                    "title": "Errors raised by selected time frame",
                    "timeContextFromParameter": "TimeRange",
                    "timeBrushParameterName": "Brush_OverviewDetail",
                    "timeBrushExportOnlyWhenBrushed": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "scatterchart",
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Logins"
                    },
                    {
                      "parameterName": "Brush_Overview",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "name": "query - 14 - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDErrors\r\n| summarize arg_max(TimeGenerated, *) by CorrelationId  // workaround to filter \"double-entries\"\r\n| join kind=leftouter (\r\n    WVDConnections | summarize arg_max(TimeGenerated, *) by CorrelationId\r\n) on CorrelationId\r\n| extend HostPool=split(_ResourceId,\"/\")[8]\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Unspecified error\",\"Unspecified error\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The system cannot open the file.\",\"The system cannot open the file.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The RPC server is unavailable.\",\"The RPC server is unavailable.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No such interface supported\",\"No such interface supported\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No process is on the other end of the pipe.\",\"No process is on the other end of the pipe.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Operation aborted\",\"\tOperation aborted\",CodeSymbolic) // workaround\r\n| where  TimeGenerated {Brush_OverviewDetail} and HostPool==\"{HostPoolOld}\" and UserName !=\"\" and (\"{UserSelector}\"==\"\" or UserName in ('' {UserSelector})) and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})) and (column_ifexists(\"CodeSymbolic\",\"*\")==\"*\" or \"{ErrorSelector}\"==\"\" or column_ifexists(\"CodeSymbolic\",\"\") in ('' {ErrorSelector}) or CodeSymbolic==\"\")\r\n| project CorrelationId, TimeStamp=TimeGenerated, User=UserName, Activity=ActivityType, Source, CodeSymbolic, Message, [\"Service Error\"]=ServiceError, [\"Client OS\"]=ClientOS, [\"Client Version\"]=ClientVersion, [\"Client Type\"]=ClientType, [\"Client IP-Address\"]=ClientIPAddress, [\"Connection Type\"]=ConnectionType, [\"App or Desktop Name\"]=ResourceAlias, [\"Session Host Name\"]=SessionHostName, [\"Session Host IP-Address\"]=SessionHostIPAddress, [\"Session Host OS-Version\"]=SessionHostOSVersion, [\"Session Host OS-Description\"]=SessionHostOSDescription, [\"Session Host Agent-Version\"]=SessionHostAgentVersion, [\"Session Host Session-Id\"]=SessionHostSessionId, [\"Gateway Region\"]=GatewayRegion, [\"Is UDP used\"]=UdpUse\r\n| order by TimeStamp asc\r\n\r\n",
                    "size": 1,
                    "title": "Errors raised by selected time frame - Level 2",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "CorrelationId",
                    "exportParameterName": "Select_DetailBrushCorrelationId",
                    "showExportToExcel": true,
                    "exportToExcelOptions": "all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "CorrelationId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Signature",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Success",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "Errors",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "Error rate",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "percent",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "CodeSymbolic",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "CodeSymbolic",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "customWidth": "100",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Logins"
                    },
                    {
                      "parameterName": "Brush_OverviewDetail",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "name": "query - 13 - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDConnections | summarize arg_max(TimeGenerated, *) by CorrelationId\r\n| summarize arg_max(TimeGenerated, *) by CorrelationId  // workaround to filter \"double-entries\"\r\n| join kind=leftouter (\r\n    WVDErrors | summarize arg_max(TimeGenerated, *) by CorrelationId\r\n) on CorrelationId\r\n| extend HostPool=split(_ResourceId,\"/\")[8]\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Unspecified error\",\"Unspecified error\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The system cannot open the file.\",\"The system cannot open the file.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The RPC server is unavailable.\",\"The RPC server is unavailable.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No such interface supported\",\"No such interface supported\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No process is on the other end of the pipe.\",\"No process is on the other end of the pipe.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Operation aborted\",\"\tOperation aborted\",CodeSymbolic) // workaround\r\n| where  TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\" and UserName !=\"\" and (\"{UserSelector}\"==\"\" or UserName in ('' {UserSelector})) and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})) and (column_ifexists(\"CodeSymbolic\",\"*\")==\"*\" or \"{ErrorSelector}\"==\"\" or column_ifexists(\"CodeSymbolic\",\"\") in ('' {ErrorSelector}) or CodeSymbolic==\"\")\r\n| extend IPSegmentC=strcat(split(ClientSideIPAddress,\".\")[0],\".\",split(ClientSideIPAddress,\".\")[1],\".\",split(ClientSideIPAddress,\".\")[2])\r\n| extend Signature=strcat(ClientType,\"#\",ClientVersion)\r\n| summarize SuccessD=countif(CodeSymbolic==\"\"), ErrorsD=countif(CodeSymbolic!=\"\") by UserName, bin(TimeGenerated,1d)\r\n| summarize Success=avg(SuccessD), Errors=avg(ErrorsD) by UserName\r\n| extend [\"Error rate\"]=Errors*1.0/(Success+Errors)\r\n| order by [\"Error rate\"]\r\n",
                    "size": 0,
                    "title": "Average Errors per User per day",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "UserName",
                    "exportParameterName": "Select_AverUserUser",
                    "showExportToExcel": true,
                    "exportToExcelOptions": "all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Success",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Errors",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Error rate",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "percent",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Signature",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_bar_Errors_2",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_bar_Errors_2",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "customWidth": "100",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "Logins"
                  },
                  "name": "query - 13 - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDErrors\r\n| summarize arg_max(TimeGenerated, *) by CorrelationId  // workaround to filter \"double-entries\"\r\n| join kind=leftouter (\r\n    WVDConnections | summarize arg_max(TimeGenerated, *) by CorrelationId\r\n) on CorrelationId\r\n| extend HostPool=split(_ResourceId,\"/\")[8]\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Unspecified error\",\"Unspecified error\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The system cannot open the file.\",\"The system cannot open the file.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"The RPC server is unavailable.\",\"The RPC server is unavailable.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No such interface supported\",\"No such interface supported\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"No process is on the other end of the pipe.\",\"No process is on the other end of the pipe.\",CodeSymbolic) // workaround\r\n| extend CodeSymbolic=iff(CodeSymbolic startswith_cs \"Operation aborted\",\"\tOperation aborted\",CodeSymbolic) // workaround\r\n| where  TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\" and UserName !=\"\" and (\"{UserSelector}\"==\"\" or UserName in ('' {UserSelector})) and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})) and (column_ifexists(\"CodeSymbolic\",\"*\")==\"*\" or \"{ErrorSelector}\"==\"\" or column_ifexists(\"CodeSymbolic\",\"\") in ('' {ErrorSelector}) or CodeSymbolic==\"\")\r\n| where UserName==\"{Select_AverUserUser}\"\r\n| project CorrelationId, TimeStamp=TimeGenerated, User=UserName, Activity=ActivityType, Source, CodeSymbolic, Message, [\"Service Error\"]=ServiceError, [\"Client OS\"]=ClientOS, [\"Client Version\"]=ClientVersion, [\"Client Type\"]=ClientType, [\"Client IP-Address\"]=ClientIPAddress, [\"Connection Type\"]=ConnectionType, [\"App or Desktop Name\"]=ResourceAlias, [\"Session Host Name\"]=SessionHostName, [\"Session Host IP-Address\"]=SessionHostIPAddress, [\"Session Host OS-Version\"]=SessionHostOSVersion, [\"Session Host OS-Description\"]=SessionHostOSDescription, [\"Session Host Agent-Version\"]=SessionHostAgentVersion, [\"Session Host Session-Id\"]=SessionHostSessionId, [\"Gateway Region\"]=GatewayRegion, [\"Is UDP used\"]=UdpUse\r\n| order by TimeStamp asc\r\n\r\n",
                    "size": 1,
                    "title": "Errors raised by {Select_AverUserUser}",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "CorrelationId",
                    "exportParameterName": "Select_AverUserUserDetail",
                    "exportToExcelOptions": "all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "CorrelationId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Signature",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Success",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "Errors",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "Error rate",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "percent",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "CodeSymbolic",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "CodeSymbolic",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "customWidth": "100",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Logins"
                    },
                    {
                      "parameterName": "Select_AverUserUser",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "name": "query - 13 - Copy - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDAgentHealthStatus \r\n| extend HostPool=split(_ResourceId,\"/\")[8] \r\n| where  TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\" and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector}))\r\n| extend SessionHostResourceIdUx=strcat(_ResourceId,\"/SessionHosts/\",SessionHostName)\r\n| order by SessionHostResourceIdUx, StatusTimeStamp\r\n| extend AgentVersionPrev=prev(AgentVersion), SxSStackVersionPrev=prev(SxSStackVersion)\r\n| extend Change=SessionHostResourceIdUx==prev(SessionHostResourceIdUx) and (AgentVersion!=AgentVersionPrev or SxSStackVersion!=SxSStackVersionPrev)\r\n| where Change and AgentVersionPrev !=\"\" and SessionHostResourceIdUx!=\"\"\r\n| project Timestamp=iff(StatusTimeStamp!=\"\",StatusTimeStamp,TimeGenerated),[\"Sessionhost\"]=SessionHostName,OSVersion,[\"Agent version\"]=AgentVersion,[\"Agent version prev.\"]=AgentVersionPrev,[\"SxSStack version\"]=SxSStackVersion,[\"SxSStack version prev\"]=SxSStackVersionPrev\r\n| order by Timestamp\r\n\r\n",
                    "size": 0,
                    "title": "Agent Updates on Session Hosts",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "exportToExcelOptions": "all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Signature",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Success",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "Errors",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "Error rate",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "percent",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true
                    }
                  },
                  "customWidth": "100",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "Logins"
                  },
                  "name": "query - 13 - Copy - Copy - Copy"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Logins"
            },
            "name": "group - Logins"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDConnectionNetworkData | extend HostPool=split(_ResourceId,\"/\")[8] | where TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\"\r\n| join kind=inner  (WVDConnections| where TimeGenerated {TimeRange} and ClientIPAddress !=\"\" and State ==\"Connected\" and UserName !=\"\" and (\"{UserSelector}\"==\"\" or UserName in ('' {UserSelector})) and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})))  on CorrelationId\r\n| extend ShortPath=iff(UdpUse==1,\"Private\",iff(UdpUse==2,\"Public\",\"\"))\r\n| summarize ClientIP=take_any(ClientIPAddress),[\"Avg. RTT\"]=avg(EstRoundTripTimeInMs),[\"Max. RTT\"]=max(EstRoundTripTimeInMs),[\"P90 RTT\"]=percentile(EstRoundTripTimeInMs,90),[\"Avg. Bandwidth\"]=avg(EstAvailableBandwidthKBps),[\"Max. Bandwidth\"]=max(EstAvailableBandwidthKBps),[\"P90 Bandwidth\"]=percentile(EstAvailableBandwidthKBps,90) by UserName, ShortPath\r\n| order by [\"Avg. RTT\"] desc\r\n\r\n",
                    "size": 0,
                    "title": "RTT and Bandwidth by User",
                    "exportFieldName": "UserName",
                    "exportParameterName": "Select_SourceNetwork_A_UserName",
                    "showExportToExcel": true,
                    "exportToExcelOptions": "all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Avg. RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "Max. RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "P90 RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "Avg. Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Max. Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "P90 Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_heatmap_Avg. RTT_3",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_Avg. RTT_3",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "Latencies"
                  },
                  "name": "query - 13 - Copy - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDConnectionNetworkData | extend HostPool=split(_ResourceId,\"/\")[8] | where TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\"\r\n| join kind=inner  (WVDConnections| where TimeGenerated {TimeRange} and State ==\"Connected\" and UserName ==\"{Select_SourceNetwork_A_UserName}\" and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})))  on CorrelationId\r\n| summarize [\"Avg. RTT/ms\"]=avg(EstRoundTripTimeInMs),[\"Max. RTT/ms\"]=max(EstRoundTripTimeInMs),[\"P90 RTT/ms\"]=percentile(EstRoundTripTimeInMs,90) by TimeGenerated\r\n",
                    "size": 0,
                    "showAnnotations": true,
                    "title": "RTT for {Select_SourceNetwork_A_UserName}",
                    "timeContextFromParameter": "TimeRange",
                    "timeBrushParameterName": "Brush_Latency_A",
                    "timeBrushExportOnlyWhenBrushed": true,
                    "exportFieldName": "CorrelationId",
                    "exportParameterName": "Select_SourceNetwork_A_UserName",
                    "showExportToExcel": true,
                    "exportToExcelOptions": "all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "linechart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Avg. RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "Max. RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "P90 RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "Avg. Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Max. Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "P90 Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_heatmap_Avg. RTT_1",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_Avg. RTT_1",
                        "sortOrder": 2
                      }
                    ],
                    "graphSettings": {
                      "type": 0
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Latencies"
                    },
                    {
                      "parameterName": "Select_SourceNetwork_A_UserName",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "name": "query - 13 - Copy - Copy - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDConnectionNetworkData | extend HostPool=split(_ResourceId,\"/\")[8] | where TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\"\r\n| join kind=inner (WVDConnections| where TimeGenerated {TimeRange} and State ==\"Connected\" and UserName ==\"{Select_SourceNetwork_A_UserName}\" and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})))  on CorrelationId\r\n| summarize [\"Avg. Bandwidth/Bps\"]=avg(EstAvailableBandwidthKBps)*1024.0,[\"Max. Bandwidth/Bps\"]=max(EstAvailableBandwidthKBps)*1024.0,[\"P90 Bandwidth/Bps\"]=percentile(EstAvailableBandwidthKBps,90)*1024.0 by TimeGenerated\r\n",
                    "size": 0,
                    "showAnnotations": true,
                    "title": "Bandwidth for {Select_SourceNetwork_A_UserName}",
                    "timeBrushParameterName": "Brush_Latency_A",
                    "timeBrushExportOnlyWhenBrushed": true,
                    "showExportToExcel": true,
                    "exportToExcelOptions": "all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "linechart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Avg. RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "Max. RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "P90 RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "Avg. Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Max. Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "P90 Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_heatmap_Avg. RTT_1",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_Avg. RTT_1",
                        "sortOrder": 2
                      }
                    ],
                    "graphSettings": {
                      "type": 0
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Latencies"
                    },
                    {
                      "parameterName": "Select_SourceNetwork_A_UserName",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "name": "query - 13 - Copy - Copy - Copy - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDConnectionNetworkData | extend HostPool=split(_ResourceId,\"/\")[8] | where TimeGenerated {Brush_Latency_A} and HostPool==\"{HostPoolOld}\"\r\n| join kind=inner  (WVDConnections| where State ==\"Connected\" and UserName ==\"{Select_SourceNetwork_A_UserName}\" and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})))  on CorrelationId\r\n| summarize [\"Avg. RTT/ms\"]=avg(EstRoundTripTimeInMs),[\"Max. RTT/ms\"]=max(EstRoundTripTimeInMs),[\"P90 RTT/ms\"]=percentile(EstRoundTripTimeInMs,90) by TimeGenerated\r\n",
                    "size": 0,
                    "showAnnotations": true,
                    "title": "RTT for {Select_SourceNetwork_A_UserName}",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "exportToExcelOptions": "all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "linechart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Avg. RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "Max. RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "P90 RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "Avg. Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Max. Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "P90 Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_heatmap_Avg. RTT_1",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_Avg. RTT_1",
                        "sortOrder": 2
                      }
                    ],
                    "graphSettings": {
                      "type": 0
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Latencies"
                    },
                    {
                      "parameterName": "Select_SourceNetwork_A_UserName",
                      "comparison": "isNotEqualTo"
                    },
                    {
                      "parameterName": "Brush_Latency_A",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "name": "query - 13 - Copy - Copy - Copy - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDConnectionNetworkData | extend HostPool=split(_ResourceId,\"/\")[8] | where TimeGenerated {Brush_Latency_A} and HostPool==\"{HostPoolOld}\"\r\n| join kind=inner  (WVDConnections| where State ==\"Connected\" and UserName ==\"{Select_SourceNetwork_A_UserName}\" and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})))  on CorrelationId\r\n| summarize [\"Avg. Bandwidth/Bps\"]=avg(EstAvailableBandwidthKBps)*1024.0,[\"Max. Bandwidth/Bps\"]=max(EstAvailableBandwidthKBps)*1024.0,[\"P90 Bandwidth/Bps\"]=percentile(EstAvailableBandwidthKBps,90)*1024.0 by TimeGenerated\r\n",
                    "size": 0,
                    "showAnnotations": true,
                    "title": "Bandwidth for {Select_SourceNetwork_A_UserName}",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "exportToExcelOptions": "all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "linechart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Avg. RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "Max. RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "P90 RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "Avg. Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Max. Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "P90 Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_heatmap_Avg. RTT_1",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_Avg. RTT_1",
                        "sortOrder": 2
                      }
                    ],
                    "graphSettings": {
                      "type": 0
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Latencies"
                    },
                    {
                      "parameterName": "Select_SourceNetwork_A_UserName",
                      "comparison": "isNotEqualTo"
                    },
                    {
                      "parameterName": "Brush_Latency_A",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "name": "query - 13 - Copy - Copy - Copy - Copy - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDConnectionNetworkData \r\n| extend HostPool=split(_ResourceId,\"/\")[8] | where HostPool==\"{HostPoolOld}\"\r\n| join kind=inner  (WVDConnections| where TimeGenerated {TimeRange} and State ==\"Connected\" and UserName !=\"\" and (\"{UserSelector}\"==\"\" or UserName in ('' {UserSelector})) and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})))  on CorrelationId | extend IPSegmentC=strcat(split(ClientSideIPAddress,\".\")[0],\".\",split(ClientSideIPAddress,\".\")[1],\".\",split(ClientSideIPAddress,\".\")[2])\r\n| extend ShortPath=iff(UdpUse==1,\"Private\",iff(UdpUse==2,\"Public\",\"\"))\r\n| summarize [\"Avg. RTT\"]=avg(EstRoundTripTimeInMs),[\"Max. RTT\"]=max(EstRoundTripTimeInMs),[\"P90 RTT\"]=percentile(EstRoundTripTimeInMs,90),[\"Avg. Bandwidth\"]=avg(EstAvailableBandwidthKBps),[\"Max. Bandwidth\"]=max(EstAvailableBandwidthKBps),[\"P90 Bandwidth\"]=percentile(EstAvailableBandwidthKBps,90) by IPSegmentC, ShortPath\r\n| order by [\"Avg. RTT\"] desc\r\n\r\n",
                    "size": 1,
                    "title": "RTT and Bandwidth per User by IP segment (class C)",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "IPSegmentC",
                    "exportParameterName": "Select_SourceNetwork_B_IPSegment",
                    "showExportToExcel": true,
                    "exportToExcelOptions": "all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Avg. RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "Max. RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "P90 RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "Avg. Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Max. Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "P90 Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "IPSegmentC",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "IPSegmentC",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "Latencies"
                  },
                  "name": "query - 13 - Copy - Copy - Copy - Copyx"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDConnectionNetworkData | extend HostPool=split(_ResourceId,\"/\")[8] | where TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\"\r\n| join kind=inner  (WVDConnections| where TimeGenerated {TimeRange} and State ==\"Connected\" and UserName !=\"\" and (\"{UserSelector}\"==\"\" or UserName in ('' {UserSelector})) and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})))  on CorrelationId | extend IPSegmentC=strcat(split(ClientSideIPAddress,\".\")[0],\".\",split(ClientSideIPAddress,\".\")[1],\".\",split(ClientSideIPAddress,\".\")[2]) | where IPSegmentC ==\"{Select_SourceNetwork_B_IPSegment}\"\r\n| summarize [\"Avg. RTT\"]=avg(EstRoundTripTimeInMs),[\"Max. RTT\"]=max(EstRoundTripTimeInMs),[\"P90 RTT\"]=percentile(EstRoundTripTimeInMs,90),[\"Avg. Bandwidth\"]=avg(EstAvailableBandwidthKBps),[\"Max. Bandwidth\"]=max(EstAvailableBandwidthKBps),[\"P90 Bandwidth\"]=percentile(EstAvailableBandwidthKBps,90) by UserName\r\n| order by [\"Avg. RTT\"] desc\r\n",
                    "size": 0,
                    "title": "RTT and Bandwidth by IP segment {Select_SourceNetwork_B_IPSegment}",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "UserName",
                    "exportParameterName": "Select_SourceNetwork_B_UserName",
                    "showExportToExcel": true,
                    "exportToExcelOptions": "all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Avg. RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "Max. RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "P90 RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "Avg. Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Max. Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "P90 Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_heatmap_Avg. RTT_1",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_Avg. RTT_1",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Latencies"
                    },
                    {
                      "parameterName": "Select_SourceNetwork_B_IPSegment",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "name": "query - 13 - Copy - Copy - Copy - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDConnectionNetworkData | extend HostPool=split(_ResourceId,\"/\")[8] | where TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\"\r\n| join kind=inner  (WVDConnections| where TimeGenerated {TimeRange} and State ==\"Connected\" and UserName ==\"{Select_SourceNetwork_B_UserName}\" and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})) | extend IPSegmentC=strcat(split(ClientSideIPAddress,\".\")[0],\".\",split(ClientSideIPAddress,\".\")[1],\".\",split(ClientSideIPAddress,\".\")[2])| where IPSegmentC ==\"{Select_SourceNetwork_B_IPSegment}\")  on CorrelationId\r\n| summarize [\"Avg. RTT/ms\"]=avg(EstRoundTripTimeInMs),[\"Max. RTT/ms\"]=max(EstRoundTripTimeInMs),[\"P90 RTT/ms\"]=percentile(EstRoundTripTimeInMs,90) by TimeGenerated\r\n",
                    "size": 0,
                    "showAnnotations": true,
                    "title": "RTT for {Select_SourceNetwork_B_UserName} in {Select_SourceNetwork_B_IPSegment}",
                    "timeContextFromParameter": "TimeRange",
                    "timeBrushParameterName": "Brush_Latency_B",
                    "timeBrushExportOnlyWhenBrushed": true,
                    "showExportToExcel": true,
                    "exportToExcelOptions": "all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "linechart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Avg. RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "Max. RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "P90 RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "Avg. Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Max. Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "P90 Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true
                    },
                    "sortBy": [],
                    "graphSettings": {
                      "type": 0
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Latencies"
                    },
                    {
                      "parameterName": "Select_SourceNetwork_B_UserName",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "name": "query - 13 - Copy - Copy - Copy - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDConnectionNetworkData | extend HostPool=split(_ResourceId,\"/\")[8] | where TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\"\r\n| join kind=inner (WVDConnections| where TimeGenerated {TimeRange} and State ==\"Connected\" and UserName ==\"{Select_SourceNetwork_B_UserName}\" and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})) | extend IPSegmentC=strcat(split(ClientSideIPAddress,\".\")[0],\".\",split(ClientSideIPAddress,\".\")[1],\".\",split(ClientSideIPAddress,\".\")[2])| where IPSegmentC ==\"{Select_SourceNetwork_B_IPSegment}\")  on CorrelationId\r\n| summarize [\"Avg. Bandwidth/Bps\"]=avg(EstAvailableBandwidthKBps)*1024.0,[\"Max. Bandwidth/Bps\"]=max(EstAvailableBandwidthKBps)*1024.0,[\"P90 Bandwidth/Bps\"]=percentile(EstAvailableBandwidthKBps,90)*1024.0 by TimeGenerated\r\n",
                    "size": 0,
                    "showAnnotations": true,
                    "title": "Bandwidth for {Select_SourceNetwork_B_UserName} in {Select_SourceNetwork_B_IPSegment}",
                    "timeContext": {
                      "durationMs": 43200000
                    },
                    "timeBrushParameterName": "Brush_Latency_B",
                    "timeBrushExportOnlyWhenBrushed": true,
                    "showExportToExcel": true,
                    "exportToExcelOptions": "all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "linechart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Avg. RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "Max. RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "P90 RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "Avg. Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Max. Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "P90 Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_heatmap_Avg. RTT_1",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_Avg. RTT_1",
                        "sortOrder": 2
                      }
                    ],
                    "graphSettings": {
                      "type": 0
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Latencies"
                    },
                    {
                      "parameterName": "Select_SourceNetwork_B_UserName",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "name": "query - 13 - Copy - Copy - Copy - Copy - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDConnectionNetworkData | extend HostPool=split(_ResourceId,\"/\")[8] | where TimeGenerated {Brush_Latency_B} and HostPool==\"{HostPoolOld}\"\r\n| join kind=inner  (WVDConnections| where State ==\"Connected\" and UserName ==\"{Select_SourceNetwork_B_UserName}\" and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})) | extend IPSegmentC=strcat(split(ClientSideIPAddress,\".\")[0],\".\",split(ClientSideIPAddress,\".\")[1],\".\",split(ClientSideIPAddress,\".\")[2])| where IPSegmentC ==\"{Select_SourceNetwork_B_IPSegment}\")  on CorrelationId\r\n| summarize [\"Avg. RTT/ms\"]=avg(EstRoundTripTimeInMs),[\"Max. RTT/ms\"]=max(EstRoundTripTimeInMs),[\"P90 RTT/ms\"]=percentile(EstRoundTripTimeInMs,90) by TimeGenerated\r\n",
                    "size": 0,
                    "showAnnotations": true,
                    "title": "RTT for {Select_SourceNetwork_B_UserName} in {Select_SourceNetwork_B_IPSegment}",
                    "timeContext": {
                      "durationMs": 43200000
                    },
                    "showExportToExcel": true,
                    "exportToExcelOptions": "all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "linechart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Avg. RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "Max. RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "P90 RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "Avg. Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Max. Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "P90 Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_heatmap_Avg. RTT_1",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_Avg. RTT_1",
                        "sortOrder": 2
                      }
                    ],
                    "graphSettings": {
                      "type": 0
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Latencies"
                    },
                    {
                      "parameterName": "Select_SourceNetwork_B_UserName",
                      "comparison": "isNotEqualTo"
                    },
                    {
                      "parameterName": "Brush_Latency_B",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "name": "query - 13 - Copy - Copy - Copy - Copy - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDConnectionNetworkData | extend HostPool=split(_ResourceId,\"/\")[8] | where TimeGenerated {Brush_Latency_B} and HostPool==\"{HostPoolOld}\"\r\n| join kind=inner  (WVDConnections| where State ==\"Connected\" and UserName ==\"{Select_SourceNetwork_B_UserName}\" and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})) | extend IPSegmentC=strcat(split(ClientSideIPAddress,\".\")[0],\".\",split(ClientSideIPAddress,\".\")[1],\".\",split(ClientSideIPAddress,\".\")[2])| where IPSegmentC ==\"{Select_SourceNetwork_B_IPSegment}\")  on CorrelationId\r\n| summarize [\"Avg. Bandwidth/Bps\"]=avg(EstAvailableBandwidthKBps)*1024.0,[\"Max. Bandwidth/Bps\"]=max(EstAvailableBandwidthKBps)*1024.0,[\"P90 Bandwidth/Bps\"]=percentile(EstAvailableBandwidthKBps,90)*1024.0 by TimeGenerated\r\n",
                    "size": 0,
                    "showAnnotations": true,
                    "title": "Bandwidth for {Select_SourceNetwork_B_UserName} in {Select_SourceNetwork_B_IPSegment}",
                    "timeContext": {
                      "durationMs": 43200000
                    },
                    "showExportToExcel": true,
                    "exportToExcelOptions": "all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "linechart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Avg. RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "Max. RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "P90 RTT",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 20,
                            "max": 200,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "Avg. Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Max. Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "P90 Bandwidth",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "150px"
                          },
                          "numberFormat": {
                            "unit": 12,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_heatmap_Avg. RTT_1",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_Avg. RTT_1",
                        "sortOrder": 2
                      }
                    ],
                    "graphSettings": {
                      "type": 0
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Latencies"
                    },
                    {
                      "parameterName": "Select_SourceNetwork_B_UserName",
                      "comparison": "isNotEqualTo"
                    },
                    {
                      "parameterName": "Brush_Latency_B",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "name": "query - 13 - Copy - Copy - Copy - Copy - Copy - Copy - Copy"
                }
              ]
            },
            "name": "group - Latencies"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDCheckpoints| where Name ==\"LogonDelay\" | extend HostPool=split(_ResourceId,\"/\")[8] | where TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\"\r\n| extend LogonType=Parameters.LogonType,WinLogon_Logon_GPClient=todouble(Parameters.WinLogon_Logon_GPClient),WinLogon_Logon_Profiles=todouble(Parameters.WinLogon_Logon_Profiles),WinLogon_Logon_Sens=todouble(Parameters.WinLogon_Logon_Sens),WinLogon_Logon_SessionEnv=todouble(Parameters.WinLogon_Logon_SessionEnv),WinLogon_Logon_TermSrv=todouble(Parameters.WinLogon_Logon_TermSrv),WinLogon_Logon_frxsvc=todouble(Parameters.WinLogon_Logon_frxsvc),WinLogon_StartShell=todouble(Parameters.WinLogon_StartShell),WinLogon_Logon=todouble(Parameters.WinLogon_Logon),WinLogon_Total=todouble(Parameters.WinLogon_Total), AuthenticateUser=todouble(Parameters.AuthenticateUser)\r\n| join kind=inner  (WVDConnections| where TimeGenerated {TimeRange} and State ==\"Connected\" and UserName !=\"\" and (\"{UserSelector}\"==\"\" or UserName in ('' {UserSelector})) and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})))  on CorrelationId\r\n| summarize [\"Windows Logon - Total (avg)\"]=avg(WinLogon_Total), [\"Windows Logon - Total (P90)\"]=percentile(WinLogon_Total,90) by UserName\r\n| order by [\"Windows Logon - Total (avg)\"] desc\r\n\r\n\r\n",
                    "size": 0,
                    "title": "Logon Timing by User",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "UserName",
                    "exportParameterName": "Select_LogonTiming_A_UserName",
                    "showExportToExcel": true,
                    "exportToExcelOptions": "all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Windows Logon - Total (avg)",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "max": 180000,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Windows Logon - Total (P90)",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "max": 180000,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "LogonTiming"
                  },
                  "name": "query - 13 - Copy - Copy - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDCheckpoints| where Name ==\"LogonDelay\" and UserName =~\"{Select_LogonTiming_A_UserName}\" | extend HostPool=split(_ResourceId,\"/\")[8] | where TimeGenerated {TimeRange} and HostPool==\"{HostPoolOld}\"\r\n| extend LogonType=Parameters.LogonType,WinLogon_Logon_GPClient=todouble(Parameters.WinLogon_Logon_GPClient),WinLogon_Logon_Profiles=todouble(Parameters.WinLogon_Logon_Profiles),WinLogon_Logon_Sens=todouble(Parameters.WinLogon_Logon_Sens),WinLogon_Logon_SessionEnv=todouble(Parameters.WinLogon_Logon_SessionEnv),WinLogon_Logon_TermSrv=todouble(Parameters.WinLogon_Logon_TermSrv),WinLogon_Logon_frxsvc=todouble(Parameters.WinLogon_Logon_frxsvc),WinLogon_StartShell=todouble(Parameters.WinLogon_StartShell),WinLogon_Logon=todouble(Parameters.WinLogon_Logon),WinLogon_Total=todouble(Parameters.WinLogon_Total), AuthenticateUser=todouble(Parameters.AuthenticateUser)\r\n| join kind=inner  (WVDConnections| where TimeGenerated {TimeRange} and ClientIPAddress !=\"\" and State ==\"Connected\" and UserName !=\"\" and (\"{UserSelector}\"==\"\" or UserName in ('' {UserSelector})) and (column_ifexists(\"SessionHostName\",\"*\")==\"*\" or \"{SessionHostSelector}\"==\"\" or column_ifexists(\"SessionHostName\",\"\") in ('' {SessionHostSelector})))  on CorrelationId\r\n| summarize ClientIP=take_any(ClientIPAddress),[\"Authentication\"]=avg(AuthenticateUser), [\"Logon - Total\"]=avg(WinLogon_Total), [\"Logon - GPO\"]=avg(WinLogon_Logon_GPClient), [\"Logon - Profile\"]=avg(WinLogon_Logon_Profiles), [\"Logon - Event Notification\"]=avg(WinLogon_Logon_Sens), [\"Logon - Env.\"]=avg(WinLogon_Logon_SessionEnv), [\"Logon - TS Service\"]=avg(WinLogon_Logon_TermSrv), [\"Logon - FRXSrv\"]=avg(WinLogon_Logon_frxsvc), [\"Logon - Start Shell\"]=avg(WinLogon_StartShell) by UserName, SessionHost=SessionHostName, TimeStamp=TimeGenerated\r\n| order by [\"Logon - Total\"] desc\r\n\r\n\r\n",
                    "size": 3,
                    "title": "Logon Timing by User {Select_LogonTiming_A_UserName}",
                    "exportFieldName": "UserName",
                    "exportParameterName": "Select_LogonTiming_B_UserName",
                    "showExportToExcel": true,
                    "exportToExcelOptions": "all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "SessionHost",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "15ch"
                          }
                        },
                        {
                          "columnMatch": "TimeStamp",
                          "formatter": 6,
                          "formatOptions": {
                            "customColumnWidthSetting": "25ch"
                          }
                        },
                        {
                          "columnMatch": "ClientIP",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "15ch"
                          }
                        },
                        {
                          "columnMatch": "Authentication",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "max": 180000,
                            "palette": "greenRed",
                            "customColumnWidthSetting": "18ch"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Logon - Total",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "max": 180000,
                            "palette": "greenRed",
                            "customColumnWidthSetting": "18ch"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Logon - GPO",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "max": 180000,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Logon - Profile",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "max": 180000,
                            "palette": "greenRed",
                            "customColumnWidthSetting": "20ch"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Logon - Event Notification",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "max": 180000,
                            "palette": "greenRed",
                            "customColumnWidthSetting": "20ch"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Logon - Env.",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "max": 180000,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Logon - TS Service",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "max": 180000,
                            "palette": "greenRed",
                            "customColumnWidthSetting": "20ch"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Logon - FRXSrv",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "max": 180000,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Logon - Start Shell",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "max": 180000,
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 23,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "TimeStamp",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "TimeStamp",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "LogonTiming"
                    },
                    {
                      "parameterName": "Select_LogonTiming_A_UserName",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "name": "query - 13 - Copy - Copy - Copy - Copy - Copy"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "LogonTiming"
            },
            "name": "group - LogonTiming"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "550b4213-7293-48f0-affa-2473fc66ba79",
                        "version": "KqlParameterItem/1.0",
                        "name": "FocusFailures",
                        "label": "Focus on failures",
                        "type": 10,
                        "isRequired": true,
                        "typeSettings": {
                          "additionalResourceOptions": []
                        },
                        "jsonData": "[\r\n    {\"label\": \"Yes\", \"value\": \"| project-away Success*  // Focus on failures\"},\r\n    {\"label\": \"No\",  \"value\": \"//\", \"selected\": true}\r\n]",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "above",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters_debug"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Success rate of (re)establishing a connection (% of connections)",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Success rate of establishing a connection state when attempted by the user\r\nWVDConnections\r\n| join kind=leftsemi\r\n(\r\n    WVDConnections\r\n    | where TimeGenerated {TimeRange}\r\n    | distinct CorrelationId\r\n) on CorrelationId\r\n//| where State ==\"Completed\"// in (\"Connected\", \"Completed\")\r\n| summarize arg_max(TimeGenerated, *) by CorrelationId\r\n| where _ResourceId =~ '{HostPool}'\r\n| join kind=leftouter\r\n(\r\n    WVDCheckpoints\r\n    | where Source == \"RDStack\" and Name == \"RdpStackConnectionEstablished\"\r\n    | project CorrelationId, Connected=true\r\n) on CorrelationId\r\n| extend Connected=coalesce(Connected, false)\r\n// Split the activity ID into the \"session ID\" (first 36-4=32 characters of the GUID, same value for all reconnections) and the last 4 characters are the attempt index (0 for initial connection, increment for each reconnect)\r\n| extend SessionId=substring(CorrelationId, 0, 36 - 4),\r\n         AttemptIndex=toint(strcat(\"0x\", substring(CorrelationId, 36 - 2), substring(CorrelationId, 36 - 4, 2))) // Swap the last two pairs of characters, and intrepret as hex\r\n// For each attempt in a session, verify that checkpoints from the host confirm the connection\r\n| summarize Success=countif(Connected)>0, StartTime=min(TimeGenerated) by SessionId\r\n| make-series \r\n    SuccessSessions=dcountif(SessionId, Success) default=0,\r\n    ErrorSessions=dcountif(SessionId, not(Success)) default=0\r\n    on StartTime step {TimeRange:grain}\r\n{FocusFailures}",
                          "size": 0,
                          "aggregation": 5,
                          "title": "Volume of connections by connection result",
                          "timeBrushParameterName": "ConnectionTimeBrush",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "barchart",
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "SuccessSessions",
                                "label": "Connections reaching a host",
                                "color": "green"
                              },
                              {
                                "seriesName": "ErrorSessions",
                                "label": "Connections unable to reach a host",
                                "color": "redBright"
                              }
                            ]
                          }
                        },
                        "name": "Volume of connections by connection result"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Success rate of establishing a connection state when attempted by the user\r\nWVDConnections\r\n| join kind=leftsemi\r\n(\r\n    WVDConnections\r\n    | where TimeGenerated {TimeRange}\r\n    | distinct CorrelationId\r\n) on CorrelationId\r\n| summarize arg_max(TimeGenerated, *) by CorrelationId\r\n| where _ResourceId =~ '{HostPool}'\r\n| join kind=leftouter\r\n(\r\n    WVDCheckpoints\r\n    | where Source == \"RDStack\" and Name == \"RdpStackConnectionEstablished\"\r\n    | project CorrelationId, Connected=true\r\n) on CorrelationId\r\n| extend Connected=coalesce(Connected, false)\r\n// Split the activity ID into the \"session ID\" (first 36-4=32 characters of the GUID, same value for all reconnections) and the last 4 characters are the attempt index (0 for initial connection, increment for each reconnect)\r\n| extend SessionId=substring(CorrelationId, 0, 36 - 4),\r\n         AttemptIndex=toint(strcat(\"0x\", substring(CorrelationId, 36 - 2), substring(CorrelationId, 36 - 4, 2))) // Swap the last two pairs of characters, and intrepret as hex\r\n// For each attempt in a session, verify that checkpoints from the host confirm the connection\r\n| summarize Success=countif(Connected)>0, StartTime=min(TimeGenerated) by SessionId\r\n| make-series \r\n    SuccessSessions=dcountif(SessionId, Success) default=0,\r\n    TotalSessions=dcount(SessionId) default=toint(0) // Cast to prevent double.nan which is more difficult to fill in with series_fill_const\r\n    on StartTime step {TimeRange:grain}\r\n| project StartTime, AnyAttemptSuccessRate=series_fill_const(series_divide(SuccessSessions,TotalSessions), 1)\r\n//{FocusFailures} // Reference parameter to force refresh on change",
                          "size": 1,
                          "aggregation": 5,
                          "title": "Connection success rate",
                          "color": "blue",
                          "noDataMessage": "No connections were started in the selected time range",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "timechart",
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "AnyAttemptSuccessRate",
                                "label": "Connections reaching a session host"
                              }
                            ],
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 0,
                                "options": {
                                  "style": "percent",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 1
                                }
                              },
                              "min": 0,
                              "max": 1
                            }
                          }
                        },
                        "name": "Connection success rate"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Success rate of establishing a connection state when attempted by the user\r\nWVDConnections\r\n| join kind=leftsemi\r\n(\r\n    WVDConnections\r\n    | where TimeGenerated {TimeRange}\r\n    | distinct CorrelationId\r\n) on CorrelationId\r\n| summarize arg_max(TimeGenerated, *) by CorrelationId\r\n| where _ResourceId =~ '{HostPool}'\r\n| join kind=leftouter\r\n(\r\n    WVDCheckpoints\r\n    | where Source == \"RDStack\" and Name == \"RdpStackConnectionEstablished\"\r\n    | project CorrelationId, Connected=true\r\n) on CorrelationId\r\n| extend Connected=coalesce(Connected, false)\r\n// Split the activity ID into the \"session ID\" (first 36-4=32 characters of the GUID, same value for all reconnections) and the last 4 characters are the attempt index (0 for initial connection, increment for each reconnect)\r\n| extend SessionId=substring(CorrelationId, 0, 36 - 4),\r\n         AttemptIndex=toint(strcat(\"0x\", substring(CorrelationId, 36 - 2), substring(CorrelationId, 36 - 4, 2))) // Swap the last two pairs of characters, and intrepret as hex\r\n// For each attempt in a session, verify that checkpoints from the host confirm the connection\r\n| summarize Attempts=dcount(CorrelationId), Success=countif(Connected)>0, FirstAttempt=min(TimeGenerated) by UserName, SessionId\r\n| where bin_at(FirstAttempt, {TimeRange:grain}, {TimeRange:start}) between(({ConnectionTimeBrush:start})..({ConnectionTimeBrush:end}))\r\n| sort by FirstAttempt asc\r\n| where not(Success) or not(\"{FocusFailures}\" contains \"Focus on failures\")\r\n| project FirstAttempt, SessionId=strcat(iif(Success, \"🟢\", \"🔴\"), \" \", SessionId, \"*\"), UserName, Attempts\r\n| take 250 // prevent the tooltip that takes up vertical space. is 250 reasonable? can be adjusted by customers by editing the query and visual config",
                          "size": 1,
                          "aggregation": 5,
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "FirstAttempt",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "26ch"
                                }
                              },
                              {
                                "columnMatch": "SessionId",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "40ch"
                                }
                              },
                              {
                                "columnMatch": "UserName",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "90fr"
                                }
                              },
                              {
                                "columnMatch": "Attempts",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue",
                                  "customColumnWidthSetting": "10fr"
                                }
                              }
                            ],
                            "sortBy": [
                              {
                                "itemKey": "UserName",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "FirstAttempt",
                                "label": "First attempt"
                              },
                              {
                                "columnId": "SessionId",
                                "label": "Connection Id"
                              },
                              {
                                "columnId": "UserName",
                                "label": "User"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "UserName",
                              "sortOrder": 1
                            }
                          ],
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "AnyAttemptSuccessRate",
                                "label": "Connections reaching a session host"
                              }
                            ],
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 0,
                                "options": {
                                  "style": "percent",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 1
                                }
                              },
                              "max": 1
                            }
                          }
                        },
                        "name": "Connection outcome listing"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "Reconnect Success Rate",
                  "styleSettings": {
                    "margin": "10px",
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Success rate of establishing a connection (% of users able to connect)",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// % of users able to reach a session host\r\nWVDConnections\r\n| join kind=leftsemi\r\n(\r\n    WVDConnections\r\n    | where TimeGenerated {TimeRange}\r\n    | distinct CorrelationId\r\n) on CorrelationId\r\n| summarize arg_max(TimeGenerated, *) by CorrelationId\r\n| where _ResourceId =~ '{HostPool}'\r\n| join kind=leftouter\r\n(\r\n    WVDCheckpoints\r\n    | where Source == \"RDStack\" and Name == \"RdpStackConnectionEstablished\"\r\n    | project CorrelationId, Connected=true\r\n) on CorrelationId\r\n| extend Connected=coalesce(Connected, false)\r\n// For each user in each time bin, find out if they were able to connect\r\n| summarize Connected=countif(Connected)>0 by UserName, TimeGenerated=bin_at(TimeGenerated, {TimeRange:grain}, {TimeRange:start})\r\n| make-series SuccessUsers=dcountif(UserName, Connected), Total=dcount(UserName) on TimeGenerated step {TimeRange:grain}\r\n| project TimeGenerated, SuccessUsers, ErrorUsers=series_subtract(Total, SuccessUsers)\r\n{FocusFailures}",
                          "size": 0,
                          "aggregation": 5,
                          "title": "Volume of users by connection result",
                          "timeBrushParameterName": "ConnectionTimeBrush",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "barchart",
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "SuccessUsers",
                                "label": "Users able to connect",
                                "color": "green"
                              },
                              {
                                "seriesName": "ErrorUsers",
                                "label": "Users unable to connect",
                                "color": "redBright"
                              }
                            ]
                          }
                        },
                        "name": "Volume of users by connection result"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// % of users able to reach a session host\r\nWVDConnections\r\n| join kind=leftsemi\r\n(\r\n    WVDConnections\r\n    | where TimeGenerated {TimeRange}\r\n    | distinct CorrelationId\r\n) on CorrelationId\r\n| summarize arg_max(TimeGenerated, *) by CorrelationId\r\n| where _ResourceId =~ '{HostPool}'\r\n| join kind=leftouter\r\n(\r\n    WVDCheckpoints\r\n    | where Source == \"RDStack\" and Name == \"RdpStackConnectionEstablished\"\r\n    | project CorrelationId, Connected=true\r\n) on CorrelationId\r\n| extend Connected=coalesce(Connected, false)\r\n| summarize Connected=countif(Connected)>0 by UserName, TimeGenerated=bin_at(TimeGenerated, {TimeRange:grain}, {TimeRange:start})\r\n| make-series UsersConnecting=dcountif(UserName, Connected) default=0, TotalUsers=dcount(UserName) default=toint(0) on TimeGenerated step {TimeRange:grain}\r\n| project TimeGenerated, UsersAbleToConnect=series_fill_const(series_divide(UsersConnecting, TotalUsers), 1)\r\n//{FocusFailures} // Reference parameter to force refresh on change",
                          "size": 1,
                          "aggregation": 5,
                          "title": "User-based success rate",
                          "color": "turquoise",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "timechart",
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "LastAttemptSuccessRate",
                                "label": "Final reconnection succeeded"
                              },
                              {
                                "seriesName": "AnyAttemptSuccessRate",
                                "label": "Any reconnection succeeded"
                              },
                              {
                                "seriesName": "AllUpSuccessRate",
                                "label": "Success of each attempt"
                              },
                              {
                                "seriesName": "UsersAbleToConnect",
                                "label": "Users able to connect"
                              }
                            ],
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 0,
                                "options": {
                                  "style": "percent",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 1
                                }
                              },
                              "min": 0,
                              "max": 1
                            }
                          }
                        },
                        "name": "User-based success rate"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// % of users able to reach a session host\r\nWVDConnections\r\n| join kind=leftsemi\r\n(\r\n    WVDConnections\r\n    | where TimeGenerated {TimeRange}\r\n    | distinct CorrelationId\r\n) on CorrelationId\r\n| where _ResourceId =~ '{HostPool}'\r\n| summarize arg_max(TimeGenerated, *) by CorrelationId\r\n| join kind=leftouter\r\n(\r\n    WVDCheckpoints\r\n    | where Source == \"RDStack\" and Name == \"RdpStackConnectionEstablished\"\r\n    | project CorrelationId, Connected=true\r\n) on CorrelationId\r\n| extend Connected=coalesce(Connected, false)\r\n// Split the activity ID into the \"session ID\" (first 36-4=32 characters of the GUID, same value for all reconnections) and the last 4 characters are the attempt index (0 for initial connection, increment for each reconnect)\r\n| extend SessionId=substring(CorrelationId, 0, 36 - 4),\r\n         AttemptIndex=toint(strcat(\"0x\", substring(CorrelationId, 36 - 2), substring(CorrelationId, 36 - 4, 2))) // Swap the last two pairs of characters, and intrepret as hex\r\n| summarize FirstAttempt=min(TimeGenerated), TotalAttempts=dcount(CorrelationId), Success=dcountif(CorrelationId, Connected)>0, SampleSession=any(SessionId) by UserName, BinnedTime=bin_at(TimeGenerated, {TimeRange:grain}, {TimeRange:start})\r\n| where BinnedTime between(({ConnectionTimeBrush:start})..({ConnectionTimeBrush:end}))\r\n| where not(Success) or not(\"{FocusFailures}\" contains \"Focus on failures\")\r\n| sort by FirstAttempt desc, Success asc, UserName asc\r\n| project FirstAttempt, SampleSession=strcat(SampleSession, \"*\"), UserName=strcat(iif(Success, \"🟢\", \"🔴\"), \" \", UserName), Attempts=TotalAttempts\r\n| take 250 // prevent the tooltip that takes up vertical space. is 250 reasonable? can be adjusted by customers by editing the query and visual config",
                          "size": 1,
                          "aggregation": 5,
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "FirstAttempt",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "26ch"
                                }
                              },
                              {
                                "columnMatch": "UserName",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "90fr"
                                }
                              },
                              {
                                "columnMatch": "SampleSession",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "40ch"
                                }
                              },
                              {
                                "columnMatch": "Attempts",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue",
                                  "customColumnWidthSetting": "10fr"
                                }
                              }
                            ],
                            "sortBy": [
                              {
                                "itemKey": "UserName",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "FirstAttempt",
                                "label": "First attempt"
                              },
                              {
                                "columnId": "SampleSession",
                                "label": "Sample connection Id"
                              },
                              {
                                "columnId": "UserName",
                                "label": "User"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "UserName",
                              "sortOrder": 1
                            }
                          ],
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "AnyAttemptSuccessRate",
                                "label": "Connections reaching a session host"
                              }
                            ],
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 0,
                                "options": {
                                  "style": "percent",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 1
                                }
                              },
                              "max": 1
                            }
                          }
                        },
                        "name": "Connection outcome listing1"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "User-based connection success rate",
                  "styleSettings": {
                    "margin": "10px",
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Potential connectivity issues in {TimeRange:label}",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "parameters": [
                            {
                              "id": "5382e3d1-e3bd-4b1e-87be-7e4a9748b39a",
                              "version": "KqlParameterItem/1.0",
                              "name": "ReportBy",
                              "label": "Report by",
                              "type": 10,
                              "isRequired": true,
                              "query": "let FullList = datatable(Value:string)[\"Host\", \"User\", \"Resource\", \"Client\"];\r\nlet GetConnectionFailures = (BaseData:(Slicer:string, CorrelationId:string, UserName:string, ResourceAlias:string, SessionHostName:string, Client:string, TimeGenerated:datetime , Connected:bool), ViewName:string)\r\n{\r\n    BaseData\r\n    | summarize Users=dcount(UserName), Resources=dcount(ResourceAlias), Hosts=dcount(SessionHostName), Clients=dcount(Client), LastAttempt=max(TimeGenerated), Attempts=dcount(CorrelationId), View=ViewName, Activities=makeset(CorrelationId) by Slicer, Connected\r\n    | as BySlicer\r\n    | where Connected != true\r\n    | join kind=leftanti\r\n    (\r\n        BySlicer\r\n        | where Connected\r\n    ) on Slicer\r\n    | project-away Connected\r\n};\r\nWVDConnections\r\n| where State == \"Completed\"\r\n| where _ResourceId =~ '{HostPool}'\r\n| join kind=leftouter\r\n(\r\n    WVDCheckpoints\r\n    | where Source == \"RDStack\" and Name == \"RdpStackConnectionEstablished\"\r\n    | project CorrelationId, Connected=true\r\n) on CorrelationId\r\n| extend SessionHostName=trim_end(@\"\\..*\", SessionHostName), Client=strcat(replace(\"com.microsoft.rdc.\", \"\", ClientType), \" \", ClientVersion)\r\n| as BaseData\r\n| extend Slicer=UserName\r\n| invoke GetConnectionFailures(\"User\")\r\n| union \r\n(\r\n    BaseData\r\n    | extend Slicer=Client\r\n    | invoke GetConnectionFailures(\"Client\")\r\n)\r\n| union \r\n(\r\n    BaseData\r\n    | extend Slicer=SessionHostName\r\n    | invoke GetConnectionFailures(\"Host\")\r\n)\r\n| union \r\n(\r\n    BaseData\r\n    | extend Slicer=ResourceAlias\r\n    | invoke GetConnectionFailures(\"Resource\")\r\n)\r\n| where strlen(Slicer) > 2\r\n| sort by View, Attempts desc \r\n| summarize Items=dcount(Slicer) by Value=View\r\n| join kind=fullouter FullList on Value\r\n| project Value=coalesce(Value, Value1), Items=coalesce(Items, 0)\r\n| project Value, Label=strcat(Value, \" (\", Items, \")\")",
                              "crossComponentResources": [
                                "{poolla}"
                              ],
                              "value": "Host",
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "timeContext": {
                                "durationMs": 604800000
                              },
                              "timeContextFromParameter": "TimeRange",
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            }
                          ],
                          "style": "formHorizontal",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters_connectivity"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let GetConnectionFailures = (BaseData:(Slicer:string, CorrelationId:string, UserName:string, ResourceAlias:string, SessionHostName:string, Client:string, TimeGenerated:datetime , Connected:bool), ViewName:string)\r\n{\r\n    BaseData\r\n    | summarize Users=dcount(UserName), Resources=dcount(ResourceAlias), Hosts=dcount(SessionHostName), Clients=dcount(Client), LastAttempt=max(TimeGenerated), Attempts=dcount(CorrelationId), View=ViewName, Activities=makeset(CorrelationId)\r\n             by Slicer, Connected\r\n    | as BySlicer\r\n    | where Connected != true\r\n    | join kind=leftanti // Exclude the users that managed to connect\r\n    (\r\n        BySlicer\r\n        | where Connected\r\n    ) on Slicer\r\n    | project-away Connected\r\n};\r\nWVDConnections\r\n| where State == \"Completed\"\r\n| where _ResourceId =~ '{HostPool}'\r\n| join kind=leftouter\r\n(\r\n    WVDCheckpoints\r\n    | where Source == \"RDStack\" and Name == \"RdpStackConnectionEstablished\"\r\n    | project CorrelationId, Connected=true\r\n) on CorrelationId\r\n| extend SessionHostName=trim_end(@\"\\..*\", SessionHostName), Client=strcat(replace(\"com.microsoft.rdc.\", \"\", ClientType), \" \", ClientVersion)\r\n| as BaseData\r\n| extend Slicer=UserName\r\n| invoke GetConnectionFailures(\"User\")\r\n| union \r\n(\r\n    BaseData\r\n    | extend Slicer=Client\r\n    | invoke GetConnectionFailures(\"Client\")\r\n)\r\n| union \r\n(\r\n    BaseData\r\n    | extend Slicer=SessionHostName\r\n    | invoke GetConnectionFailures(\"Host\")\r\n)\r\n| union \r\n(\r\n    BaseData\r\n    | extend Slicer=ResourceAlias\r\n    | invoke GetConnectionFailures(\"Resource\")\r\n)\r\n| where strlen(Slicer) > 2\r\n| where View == \"{ReportBy}\"\r\n| sort by View, Attempts desc \r\n| project {ReportBy}=Slicer, Attempts, LastAttempt, Users, Resources, Hosts, Clients, Activities, Slicer\r\n| project-away {ReportBy}s // Remove the count of the dimension used as a slicer, since it will always be 1\r\n          ",
                          "size": 0,
                          "aggregation": 5,
                          "title": "{ReportBy}s unable to connect in {TimeRange:label}",
                          "noDataMessage": "There are no instances of inability to connect for the chosen view and time frame",
                          "noDataMessageStyle": 3,
                          "timeContextFromParameter": "TimeRange",
                          "exportedParameters": [
                            {
                              "fieldName": "Activities",
                              "parameterName": "ExpandActivities"
                            },
                            {
                              "fieldName": "Slicer",
                              "parameterName": "SelectedSlicer",
                              "parameterType": 1
                            }
                          ],
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Attempts",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "redBright",
                                  "compositeBarSettings": {
                                    "labelText": "",
                                    "columnSettings": [
                                      {
                                        "columnName": "Attempts",
                                        "color": "blue"
                                      }
                                    ]
                                  }
                                }
                              },
                              {
                                "columnMatch": "Users",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "turquoise"
                                }
                              },
                              {
                                "columnMatch": "Hosts",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "magenta"
                                }
                              },
                              {
                                "columnMatch": "Clients",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "orange"
                                }
                              },
                              {
                                "columnMatch": "Activities",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Slicer",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Resources",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "yellow"
                                }
                              },
                              {
                                "columnMatch": "View",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "ClientType",
                                "formatter": 1
                              }
                            ],
                            "sortBy": [
                              {
                                "itemKey": "LastAttempt",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "LastAttempt",
                                "label": "Last attempt"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "LastAttempt",
                              "sortOrder": 1
                            }
                          ],
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "UsersConnecting",
                                "color": "green"
                              },
                              {
                                "seriesName": "UsersNotConnecting",
                                "color": "redBright"
                              }
                            ]
                          }
                        },
                        "customWidth": "45",
                        "name": "Inability To Connect",
                        "styleSettings": {
                          "padding": "10"
                        }
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "title": "Details for selected {ReportBy}: {SelectedSlicer}. Activities {ExpandActivities}",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "let SelectedActivities = dynamic([{ExpandActivities}]);\r\nWVDConnections\r\n| where SelectedActivities contains CorrelationId\r\n| extend SessionHostName=trim_end(@\"\\..*\", SessionHostName), Client=strcat(replace(\"com.microsoft.rdc.\", \"\", ClientType), \" \", ClientVersion)\r\n| summarize Activities=dcount(CorrelationId) by Host=SessionHostName, User=UserName, Resource=ResourceAlias, Client\r\n",
                                "size": 1,
                                "aggregation": 5,
                                "timeContextFromParameter": "TimeRange",
                                "showExportToExcel": true,
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{poolla}"
                                ],
                                "visualization": "table",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "Activities",
                                      "formatter": 4,
                                      "formatOptions": {
                                        "palette": "redBright"
                                      }
                                    }
                                  ],
                                  "labelSettings": [
                                    {
                                      "columnId": "Activities",
                                      "label": "Attempts"
                                    }
                                  ]
                                },
                                "chartSettings": {
                                  "seriesLabelSettings": [
                                    {
                                      "seriesName": "UsersConnecting",
                                      "color": "green"
                                    },
                                    {
                                      "seriesName": "UsersNotConnecting",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              },
                              "conditionalVisibility": {
                                "parameterName": "ExpandActivities",
                                "comparison": "isNotEqualTo"
                              },
                              "name": "query - 7"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "let SelectedActivities = dynamic([{ExpandActivities}]);\r\nlet GetPrettyError=(ErrorName:string, ErrorCode:string)\r\n{\r\n    iif(ErrorName !in ('', '<>'), strcat(ErrorName, ' (', ErrorCode, ')'), ErrorCode)\r\n};\r\nWVDErrors\r\n| where SelectedActivities contains CorrelationId\r\n| extend Error=GetPrettyError(CodeSymbolic, Code)\r\n| summarize MessageSample=any(Message), Activities=dcount(CorrelationId) by ErrorKind=iif(ServiceError, \"Service\", \"Deployment\"), Source, Error\r\n",
                                "size": 4,
                                "aggregation": 5,
                                "noDataMessage": "No errors were found for the selection",
                                "timeContextFromParameter": "TimeRange",
                                "showExportToExcel": true,
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{poolla}"
                                ],
                                "visualization": "table",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "Activities",
                                      "formatter": 4,
                                      "formatOptions": {
                                        "palette": "redBright"
                                      }
                                    }
                                  ],
                                  "labelSettings": [
                                    {
                                      "columnId": "ErrorKind",
                                      "label": "Error Kind"
                                    },
                                    {
                                      "columnId": "MessageSample",
                                      "label": "Sample Error Message"
                                    }
                                  ]
                                },
                                "chartSettings": {
                                  "seriesLabelSettings": [
                                    {
                                      "seriesName": "UsersConnecting",
                                      "color": "green"
                                    },
                                    {
                                      "seriesName": "UsersNotConnecting",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              },
                              "conditionalVisibility": {
                                "parameterName": "ExpandActivities",
                                "comparison": "isNotEqualTo"
                              },
                              "name": "query - 8"
                            }
                          ]
                        },
                        "customWidth": "55",
                        "conditionalVisibility": {
                          "parameterName": "ExpandActivities",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "SelectedActivityGroup",
                        "styleSettings": {
                          "padding": "10px",
                          "showBorder": true
                        }
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "Please select a {ReportBy} on the left to display further details\r\n",
                          "style": "info"
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "ExpandActivities",
                          "comparison": "isEqualTo"
                        },
                        "name": "NoSelectedActivity_Instruction"
                      }
                    ]
                  },
                  "name": "Potential connectivity issues",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let GetPrettyError=(ErrorName:string, ErrorCode:string)\r\n{\r\n    iif(ErrorName !in ('', '<>'), strcat(ErrorName, ' (', ErrorCode, ')'), ErrorCode)\r\n};\r\nWVDConnections\r\n| where TimeGenerated {TimeRange}\r\n| where _ResourceId =~ '{HostPool}'\r\n| extend Client=strcat(replace(\"com.microsoft.rdc.\", \"\", ClientType), \" \", ClientVersion)\r\n| extend PredecessorConnectionId=replace(\"<>\", \"\", trim(@\"{|}\", PredecessorConnectionId))\r\n| as Connections\r\n| where State==\"Started\"\r\n| extend StartTime = TimeGenerated\r\n| join kind=leftouter\r\n(\r\n    Connections\r\n    | summarize (EndTime, State)=arg_max(TimeGenerated, State) by CorrelationId\r\n) on CorrelationId\r\n| extend State=coalesce(State1, State)\r\n| join kind=leftouter\r\n(\r\n    WVDErrors\r\n    | project CorrelationId, ServiceError, Source, Error = GetPrettyError(CodeSymbolic, Code)\r\n    | distinct *\r\n    | summarize Errors=count() by CorrelationId\r\n) on CorrelationId\r\n| project CorrelationId, SessionId=strcat(substring(CorrelationId, 0, strlen(CorrelationId) - 4), \"*\"), UserName, SessionHostName, Errors=coalesce(Errors, 0), StartTime, EndTime, Duration=bin(EndTime-StartTime, 1s), ClientType, ClientVersion\r\n| summarize StartTime=min(StartTime), EndTime=max(EndTime), Duration=sum(Duration), Attempts=dcount(CorrelationId), Errors=sum(Errors), CorrelationId=makeset(CorrelationId)\r\n         by UserName, SessionHostName, SessionId, Client=strcat(replace(\"com.microsoft.rdc.\", \"\", ClientType), \" \", ClientVersion)\r\n| project UserName, SessionHostName, SessionId, Attempts, Errors, Client, StartTime, Duration, CorrelationId\r\n",
                          "size": 2,
                          "title": "Connection activity browser for {TimeRange:label}",
                          "noDataMessage": "No Connected Sessions detected in the selected time period",
                          "exportedParameters": [
                            {
                              "fieldName": "SessionId",
                              "parameterName": "GroupedCorrelationId"
                            },
                            {
                              "fieldName": "UserName",
                              "parameterName": "CorrelationUser",
                              "parameterType": 1
                            },
                            {
                              "fieldName": "SessionHostName",
                              "parameterName": "CorrelationHost",
                              "parameterType": 1
                            }
                          ],
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "table",
                          "showExpandCollapseGrid": true,
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "$gen_group",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "100fr"
                                }
                              },
                              {
                                "columnMatch": "UserName",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "SessionHostName",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "SessionId",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Attempts",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue",
                                  "aggregation": "Sum",
                                  "customColumnWidthSetting": "13ch"
                                }
                              },
                              {
                                "columnMatch": "Errors",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "redBright",
                                  "aggregation": "Sum",
                                  "customColumnWidthSetting": "12ch"
                                }
                              },
                              {
                                "columnMatch": "Client",
                                "formatter": 0,
                                "formatOptions": {
                                  "aggregation": "Unique",
                                  "customColumnWidthSetting": "28ch"
                                }
                              },
                              {
                                "columnMatch": "StartTime",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "22ch"
                                }
                              },
                              {
                                "columnMatch": "Duration",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "14ch"
                                }
                              },
                              {
                                "columnMatch": "CorrelationId",
                                "formatter": 5
                              }
                            ],
                            "rowLimit": 2000,
                            "filter": true,
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "UserName",
                                "SessionHostName"
                              ],
                              "finalBy": "SessionId"
                            },
                            "sortBy": [
                              {
                                "itemKey": "$gen_count_$gen_group_0",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "UserName",
                                "label": "Activity by User and Host"
                              },
                              {
                                "columnId": "StartTime",
                                "label": "Start time"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "$gen_count_$gen_group_0",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "customWidth": "50",
                        "name": "wvdconnectedsessionsdetails",
                        "styleSettings": {
                          "padding": "10px"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let GetPrettyError=(ErrorName:string, ErrorCode:string)\r\n{\r\n    iif(ErrorName !in ('', '<>'), strcat(ErrorName, ' (', ErrorCode, ')'), ErrorCode)\r\n};\r\nlet IsSelectedCorrelation = (Selected:string, Current:string)\r\n{\r\n    let GuidStart = substring(Selected, 0, strlen(Selected)-1);\r\n    (Selected contains \"*\" and Current startswith GuidStart)     or    Current == Selected\r\n};\r\nWVDCheckpoints\r\n| where TimeGenerated {TimeRange} and IsSelectedCorrelation(\"{GroupedCorrelationId}\", CorrelationId)\r\n| project CorrelationId, TimeGenerated, Kind=\"Checkpoint\", Source, Information=Name, Parameters\r\n| as ResultSet\r\n| union\r\n(\r\n    WVDErrors\r\n    | where IsSelectedCorrelation(\"{GroupedCorrelationId}\", CorrelationId)\r\n    | project CorrelationId,TimeGenerated, Kind=iif(ServiceError, \"Service\", \"Deployment\"), Source, Information = GetPrettyError(CodeSymbolic, Code)\r\n    | distinct *\r\n)\r\n| join kind = leftouter\r\n(\r\n    ResultSet\r\n    | where Source == \"RDStack\" and Information == \"RdpStackConnectionEstablished\"\r\n    | project CorrelationId, Connected=true\r\n    | summarize Success=dcountif(CorrelationId, Connected)>0 by CorrelationId\r\n) on CorrelationId\r\n| extend CorrelationId=strcat(iif(Success, \"🟢\", \"🔴\"), \" \", CorrelationId)\r\n| project-away Success\r\n| sort by CorrelationId asc, TimeGenerated asc\r\n",
                          "size": 2,
                          "title": "Details for {CorrelationUser} connecting to {CorrelationHost}",
                          "noDataMessage": "No errors were found for the selected session.",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "table",
                          "showExpandCollapseGrid": true,
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "CorrelationId",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "TimeGenerated",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Kind",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Checkpoint",
                                      "representation": "Normal",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Deployment",
                                      "representation": "3",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Service",
                                      "representation": "Important",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Blank",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Parameters",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "100fr"
                                }
                              }
                            ],
                            "filter": true,
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "CorrelationId"
                              ],
                              "expandTopLevel": true,
                              "finalBy": "TimeGenerated"
                            },
                            "labelSettings": [
                              {
                                "columnId": "CorrelationId",
                                "label": "Attempt and timestamp"
                              }
                            ]
                          },
                          "sortBy": []
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "GroupedCorrelationId",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "DetailsCorrelationUser_Group",
                        "styleSettings": {
                          "padding": "10px"
                        }
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "Please select a connection on the left for further details here",
                          "style": "info"
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "GroupedCorrelationId",
                          "comparison": "isEqualTo"
                        },
                        "name": "SelectedActivity_Instructions"
                      }
                    ]
                  },
                  "name": "Activity browser",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "8809818d-1aa3-4a27-ac0b-b1808000be06",
                              "version": "KqlParameterItem/1.0",
                              "name": "wvdActivityType",
                              "label": "Activity type",
                              "type": 10,
                              "description": "Scope top errors by activity type",
                              "isRequired": true,
                              "query": "WVDErrors\r\n| distinct ActivityType\r\n| sort by ActivityType asc",
                              "crossComponentResources": [
                                "{poolla}"
                              ],
                              "value": "Connection",
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "timeContext": {
                                "durationMs": 604800000
                              },
                              "timeContextFromParameter": "TimeRange",
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            },
                            {
                              "id": "2660c262-528a-4897-8631-94acd157c3c0",
                              "version": "KqlParameterItem/1.0",
                              "name": "TopNErrors",
                              "label": "Display top N errors",
                              "type": 2,
                              "isRequired": true,
                              "value": "10",
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[ 10, 20, 30]"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters_activity"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let GetPrettyError=(ErrorName:string, ErrorCode:string)\r\n{\r\n    iif(ErrorName !in ('', '<>'), strcat(ErrorName, ' (', ErrorCode, ')'), ErrorCode)\r\n};\r\nWVDConnections\r\n| where \"{wvdActivityType}\" == \"Connection\" and _ResourceId =~ '{HostPool}'\r\n| union (WVDFeeds             | where \"{wvdActivityType}\" == \"Feed\" and _ResourceId =~ '{wvdworkspace}')\r\n| union (WVDManagement        | where \"{wvdActivityType}\" == \"Management\" and (_ResourceId =~ '{HostPool}' or _ResourceId =~ '{wvdworkspace}'))\r\n| union (WVDHostRegistrations | where \"{wvdActivityType}\" == \"RegistrationToken\" and _ResourceId =~ '{HostPool}')\r\n| join kind=rightouter\r\n(\r\n    WVDErrors\r\n    | where TimeGenerated {TimeRange} and ActivityType == \"{wvdActivityType}\" and (_ResourceId =~ '{HostPool}' or _ResourceId =~ '{wvdworkspace}')\r\n    | extend Error=GetPrettyError(CodeSymbolic, Code)\r\n) on CorrelationId\r\n| as ErrorList\r\n| make-series ActivitiesImpactedOverTime=dcount(CorrelationId) default=0,\r\n              UsersImpactedOverTime=dcountif(UserName, strlen(UserName) > 2) default=0,\r\n              HostsImpactedOverTime=dcountif(SessionHostName, strlen(SessionHostName) > 2) default=0\r\n           on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by ActivityType, ServiceError, Source, Error\r\n| join kind=inner\r\n(\r\n    ErrorList\r\n    | summarize MessageSample=any(Message), TotalActivitiesImpacted=dcount(CorrelationId), TotalUsersImpacted=dcountif(UserName, strlen(UserName) > 2), TotalHostsImpacted=dcountif(SessionHostName, strlen(SessionHostName) > 2)\r\n             by ActivityType, ServiceError, Source, Error\r\n) on ActivityType, ServiceError, Source, Error\r\n| project Kind=iif(ServiceError, \"Service\", \"Deployment\"), Source, Error, MessageSample, TotalActivitiesImpacted, ActivitiesImpactedOverTime, TotalUsersImpacted, UsersImpactedOverTime, TotalHostsImpacted, HostsImpactedOverTime\r\n// Hosts count not applicable for Feed activities, so blank out the columns\r\n| extend TotalHostsImpacted=iif(\"{wvdActivityType}\" != \"Feed\", TotalHostsImpacted, int(null)), HostsImpactedOverTime=iif(\"{wvdActivityType}\" != \"Feed\", HostsImpactedOverTime, series_divide(HostsImpactedOverTime, todouble(0/0)))\r\n| sort by TotalUsersImpacted, TotalActivitiesImpacted, TotalHostsImpacted\r\n| top {TopNErrors} by TotalActivitiesImpacted",
                          "size": 0,
                          "aggregation": 3,
                          "title": "Ranking of Errors impacting {wvdActivityType} activities in {TimeRange:label}",
                          "noDataMessage": "No errors reported in the selected time period",
                          "exportFieldName": "label",
                          "exportParameterName": "wvderror",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Kind",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Service",
                                      "representation": "Important",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Deployment",
                                      "representation": "3",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Blank",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Error",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "40fr"
                                }
                              },
                              {
                                "columnMatch": "MessageSample",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "60fr"
                                }
                              },
                              {
                                "columnMatch": "TotalActivitiesImpacted",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue"
                                }
                              },
                              {
                                "columnMatch": "ActivitiesImpactedOverTime",
                                "formatter": 21,
                                "formatOptions": {
                                  "palette": "blue",
                                  "customColumnWidthSetting": "210px"
                                }
                              },
                              {
                                "columnMatch": "TotalUsersImpacted",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "turquoise"
                                }
                              },
                              {
                                "columnMatch": "UsersImpactedOverTime",
                                "formatter": 21,
                                "formatOptions": {
                                  "palette": "turquoise",
                                  "customColumnWidthSetting": "210px"
                                }
                              },
                              {
                                "columnMatch": "TotalHostsImpacted",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "magenta"
                                }
                              },
                              {
                                "columnMatch": "HostsImpactedOverTime",
                                "formatter": 21,
                                "formatOptions": {
                                  "palette": "magenta",
                                  "customColumnWidthSetting": "210px"
                                }
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "MessageSample",
                                "label": "Message sample"
                              },
                              {
                                "columnId": "TotalActivitiesImpacted",
                                "label": "Activities"
                              },
                              {
                                "columnId": "ActivitiesImpactedOverTime",
                                "label": "Over time"
                              },
                              {
                                "columnId": "TotalUsersImpacted",
                                "label": "Users"
                              },
                              {
                                "columnId": "UsersImpactedOverTime",
                                "label": "Over time"
                              },
                              {
                                "columnId": "TotalHostsImpacted",
                                "label": "Hosts"
                              },
                              {
                                "columnId": "HostsImpactedOverTime",
                                "label": "Over time"
                              }
                            ]
                          },
                          "sortBy": [],
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "CodeSymbolic",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "ErrorRate",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "CodeSymbolic",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "usercount",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "chartSettings": {
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 0,
                                "options": {
                                  "style": "percent",
                                  "useGrouping": true
                                }
                              }
                            }
                          }
                        },
                        "showPin": true,
                        "name": "Ranking Errors"
                      }
                    ]
                  },
                  "name": "ErrorRankingGroup",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "WVDErrors helps you to identify issues that can be resolved by admin tasks. \r\nThe value on ServiceError always says “false” for those types of issues. \r\n\r\nIf ServiceError = “true”, you'll need to escalate the issue to Microsoft. Ensure you provide the CorrelationID for the errors you escalate.\r\n\r\nhttps://docs.microsoft.com/en-us/azure/virtual-desktop/diagnostics-log-analytics#example-queries",
                    "style": "info"
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "ConnectionDiagnostics"
                  },
                  "name": "text - 43"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "WVDErrors\r\n//| where ServiceError != \"false\"\r\n| project TimeGenerated, ServiceError, UserName, ActivityType, Source, Code, CodeSymbolic, Message, Operation, SourceSystem, Type, CorrelationId, _ResourceId\r\n//| summarize count(UserName) by CodeSymbolic",
                    "size": 0,
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalytics}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "ServiceError",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "true",
                                "representation": "redBright",
                                "text": "True-Call Microsoft"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "sortBy": [
                        {
                          "itemKey": "TimeGenerated",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "TimeGenerated",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "ConnectionDiagnostics"
                  },
                  "name": "query - 42"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "ConnectionDiagnostics"
            },
            "name": "connectionDiagnostics"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "parameters": [
                            {
                              "id": "8d92d80e-75b9-429c-acd9-182fcc3a6eb0",
                              "version": "KqlParameterItem/1.0",
                              "name": "UserNameSearchString",
                              "label": "UPN to search for",
                              "type": 1,
                              "description": "Enter a full or partial user principal name to filter the list of user names",
                              "value": "jame",
                              "timeContext": {
                                "durationMs": 2592000000
                              },
                              "timeContextFromParameter": "TimeRange"
                            },
                            {
                              "id": "e1e164a5-c5e8-4219-997a-fc580dc3f593",
                              "version": "KqlParameterItem/1.0",
                              "name": "UserName",
                              "label": "Matching users",
                              "type": 2,
                              "description": "List of matching users with some activity in the selected time period",
                              "isRequired": true,
                              "query": "WVDConnections\r\n| where isnotempty(\"{UserNameSearchString}\") and _ResourceId =~ '{HostPool}'\r\n| project UserName\r\n| union\r\n(\r\n    WVDFeeds\r\n    | where isnotempty(\"{UserNameSearchString}\") and _ResourceId =~ '{wvdworkspace}'\r\n    | project UserName\r\n)\r\n| union\r\n(\r\n    WVDManagement\r\n    | where isnotempty(\"{UserNameSearchString}\") and (_ResourceId =~ '{wvdworkspace}' or _ResourceId =~ '{HostPool}')\r\n    | project UserName\r\n)\r\n| where UserName has \"@\" and tolower(UserName) contains \"{UserNameSearchString}\"\r\n| distinct UserName\r\n| extend Lowercased=tolower(UserName)\r\n| sort by Lowercased asc\r\n| project Label=UserName, Value=UserName, Selected=(row_number()==1)",
                              "crossComponentResources": [
                                "{poolla}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 2592000000
                              },
                              "timeContextFromParameter": "TimeRange",
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces",
                              "value": null
                            }
                          ],
                          "style": "above",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "customWidth": "50",
                        "name": "parameters - 1",
                        "styleSettings": {
                          "maxWidth": "500px"
                        }
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "parameters": [
                            {
                              "id": "ffe3e22b-a2b9-4a6c-90e7-92ce3419c150",
                              "version": "KqlParameterItem/1.0",
                              "name": "UserStatus",
                              "type": 2,
                              "isRequired": true,
                              "query": "let GetHumanTimestamp = (Duration:timespan) {\r\n    let Weeks   = Duration/7d;\r\n    let Days    = Duration/1d;\r\n    let Hours   = Duration/1h;\r\n    let Minutes = Duration/1m;\r\n    case(\r\n        Weeks   > 1, strcat(      round(Weeks,   1),  \" weeks\"),\r\n        Days    > 1, strcat(      round(Days,    1),  \" days\"),\r\n        Hours   > 1, strcat(      round(Hours,   1),  \" hours\"),\r\n        Minutes > 1, strcat(toint(round(Minutes, 0)), \" minutes\"),\r\n                         \"less than 1 minute\"\r\n        )                  \r\n};\r\nWVDConnections\r\n| where UserName == \"{UserName}\" and _ResourceId =~ '{HostPool}'\r\n| summarize arg_max(TimeGenerated, ClientType, ClientVersion, SessionHostName, ResourceAlias) by State\r\n| extend HumanTimestamp = GetHumanTimestamp(now()-TimeGenerated), Host=trim_end(@\"\\..*\", SessionHostName), ClientType = replace(\"com.microsoft.rdc.\", \"\", ClientType)\r\n| as SourceData\r\n| where State == \"Started\"\r\n| project State, TimeGenerated, Message=strcat(\"Is currently **attempting to connect** to **\", Host, \"** (for about **\", HumanTimestamp, \"**), using **\", ClientType, \"** version **\", ClientVersion, \"** and the **\", ResourceAlias, \"** resource.\")\r\n| union\r\n(\r\n    SourceData\r\n    | where State == \"Completed\"\r\n    | project State, TimeGenerated, Message=strcat(\"Last seen after **disconnecting** from **\", Host, \"** about **\", HumanTimestamp, \"** ago, having used **\", ClientType, \"** version **\", ClientVersion, \"** to launch **\", ResourceAlias, \"**\")\r\n)\r\n| union\r\n(\r\n    SourceData\r\n    | where State == \"Connected\"\r\n    | project State, TimeGenerated, Message=strcat(\"**Currently connected** to **\", Host, \"** for about **\", HumanTimestamp, \"** using **\", ClientType, \"** version **\", ClientVersion, \"** via the **\", ResourceAlias, \"** resource.\")\r\n)\r\n| summarize arg_max(TimeGenerated, State, Message) by Selected=true\r\n| project Value=State, Label=Message, Selected\r\n// TODO: If a connection was established to pool A before a connection to pool B is terminated (overlapping connections), the former should be reported, as it's an ongoing activity",
                              "crossComponentResources": [
                                "{poolla}"
                              ],
                              "value": null,
                              "isHiddenWhenLocked": true,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 2592000000
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "false",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "parameters - 15"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "Enter a full or partial user name above and select a match from the dropdown to see a report of user activity.",
                          "style": "info"
                        },
                        "conditionalVisibility": {
                          "parameterName": "UserName",
                          "comparison": "isEqualTo",
                          "value": ""
                        },
                        "name": "text16",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 1,
                              "content": {
                                "json": "{UserStatus:label}",
                                "style": "success"
                              },
                              "conditionalVisibility": {
                                "parameterName": "UserStatus",
                                "comparison": "isEqualTo",
                                "value": "Connected"
                              },
                              "name": "text17",
                              "styleSettings": {
                                "showBorder": true
                              }
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "{UserStatus:label}",
                                "style": "info"
                              },
                              "conditionalVisibility": {
                                "parameterName": "UserStatus",
                                "comparison": "isEqualTo",
                                "value": "Completed"
                              },
                              "name": "text18",
                              "styleSettings": {
                                "showBorder": true
                              }
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "{UserStatus:label}",
                                "style": "upsell"
                              },
                              "conditionalVisibility": {
                                "parameterName": "UserStatus",
                                "comparison": "isEqualTo",
                                "value": "Started"
                              },
                              "name": "text19",
                              "styleSettings": {
                                "showBorder": true
                              }
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "**No connections** found for **{UserName}** in the last **30 days**.",
                                "style": "warning"
                              },
                              "conditionalVisibility": {
                                "parameterName": "UserStatus",
                                "comparison": "isEqualTo",
                                "value": ""
                              },
                              "name": "text20",
                              "styleSettings": {
                                "showBorder": true
                              }
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "WVDConnections\r\n| where UserName == '{UserName}'\r\n| where _ResourceId =~ '{HostPool}'\r\n| as SourceData\r\n| where State==\"Started\"\r\n| project-rename StartTime=TimeGenerated\r\n| join kind=fullouter\r\n(\r\n    SourceData\r\n    | where State == \"Completed\"\r\n    | project CorrelationId, SessionHostName, EndTime=TimeGenerated\r\n) on CorrelationId\r\n| project CorrelationId=coalesce(CorrelationId, CorrelationId1), StartTime=coalesce(StartTime, {TimeRange:start}), EndTime=coalesce(EndTime, {TimeRange:end}), SessionHostName=coalesce(SessionHostName, SessionHostName1)\r\n| extend ProbeTime = range(bin_at(StartTime, {TimeRange:grain}, {TimeRange:start}), bin_at(EndTime + {TimeRange:grain}, {TimeRange:grain}, {TimeRange:end}), {TimeRange:grain})\r\n| mv-expand ProbeTime to typeof(datetime)\r\n| extend ConnectionContainsProbe = (StartTime < ProbeTime and EndTime > ProbeTime),\r\n         ConnectionEndedInPreviousBucket = (StartTime < ProbeTime and EndTime + {TimeRange:grain} >= ProbeTime)\r\n| make-series Connections=dcountif(CorrelationId, ConnectionContainsProbe or ConnectionEndedInPreviousBucket) on ProbeTime from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by Host=trim_end(@\"\\..*\", SessionHostName)",
                                "size": 1,
                                "title": "Connections over time for {UserName}",
                                "noDataMessage": "No connections detected for this user in the specified time frame.",
                                "showExportToExcel": true,
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{poolla}"
                                ],
                                "visualization": "areachart",
                                "chartSettings": {
                                  "showMetrics": false,
                                  "showLegend": true
                                }
                              },
                              "customWidth": "50",
                              "name": "ConnectionsbyUser"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "WVDFeeds\r\n| where UserName == '{UserName}' and _ResourceId =~ '{wvdworkspace}'\r\n| make-series FeedCount = dcount(CorrelationId) default=long(0) on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}",
                                "size": 1,
                                "title": "Feed refreshes over time for {UserName}",
                                "noDataMessage": "No feed refreshes for this user in the specified time frame.",
                                "timeContextFromParameter": "TimeRange",
                                "showExportToExcel": true,
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{poolla}"
                                ],
                                "visualization": "barchart",
                                "chartSettings": {
                                  "showMetrics": false
                                }
                              },
                              "customWidth": "50",
                              "name": "FeedRefreshesByUser"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "WVDFeeds\r\n| where UserName == \"{UserName}\" and _ResourceId =~ '{wvdworkspace}'\r\n| summarize LastSeen=max(TimeGenerated), FeedRefreshes=dcount(CorrelationId) by ClientType\r\n| join kind=fullouter\r\n(\r\n    WVDConnections\r\n    | where UserName == \"{UserName}\" and _ResourceId =~ '{HostPool}'\r\n    | summarize LastSeen=max(TimeGenerated), Connections=dcount(CorrelationId) by ClientType\r\n) on ClientType\r\n| project ClientType=coalesce(ClientType, ClientType1), Subtitle=\"Connections / Feed refrehes\", LastSeen=max_of(LastSeen, LastSeen1), FeedRefreshes=coalesce(FeedRefreshes, 0), Connections=coalesce(Connections, 0)\r\n| extend ClientTypeShort=replace(\"com.microsoft.rdc.\", \"\", ClientType)\r\n| sort by Connections desc",
                                "size": 0,
                                "title": "Select a client",
                                "timeContextFromParameter": "TimeRange",
                                "exportFieldName": "ClientType",
                                "exportParameterName": "SelectedClientType",
                                "exportDefaultValue": "*",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{poolla}"
                                ],
                                "visualization": "tiles",
                                "gridSettings": {
                                  "sortBy": [
                                    {
                                      "itemKey": "LastSeen",
                                      "sortOrder": 2
                                    }
                                  ]
                                },
                                "sortBy": [
                                  {
                                    "itemKey": "LastSeen",
                                    "sortOrder": 2
                                  }
                                ],
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "ClientTypeShort",
                                    "formatter": 1
                                  },
                                  "subtitleContent": {
                                    "columnMatch": "Subtitle"
                                  },
                                  "leftContent": {
                                    "columnMatch": "Connections",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "min": -1,
                                      "max": 0,
                                      "palette": "blue"
                                    }
                                  },
                                  "rightContent": {
                                    "columnMatch": "FeedRefreshes",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "min": -1,
                                      "max": 0,
                                      "palette": "orange"
                                    },
                                    "numberFormat": {
                                      "unit": 0,
                                      "options": {
                                        "style": "decimal",
                                        "maximumSignificantDigits": 2
                                      }
                                    }
                                  },
                                  "secondaryContent": {
                                    "columnMatch": "LastSeen",
                                    "formatter": 6,
                                    "dateFormat": {
                                      "formatName": "shortDateTimePattern"
                                    },
                                    "tooltipFormat": {
                                      "tooltip": "Last seen time"
                                    }
                                  },
                                  "showBorder": true
                                }
                              },
                              "customWidth": "16",
                              "name": "ClientTiles",
                              "styleSettings": {
                                "maxWidth": "250px"
                              }
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "WVDConnections\r\n| where _ResourceId =~ '{HostPool}' and UserName == '{UserName}' and (\"{SelectedClientType}\" == \"*\" or ClientType == \"{SelectedClientType}\")\r\n| as SourceData\r\n| where State==\"Started\"\r\n| project-rename StartTime=TimeGenerated\r\n| join kind=fullouter\r\n(\r\n    SourceData\r\n    | where State == \"Completed\"\r\n    | project CorrelationId, ClientVersion, ClientType, EndTime=TimeGenerated\r\n) on CorrelationId\r\n| project CorrelationId=coalesce(CorrelationId, CorrelationId1), StartTime=coalesce(StartTime, {TimeRange:start}), EndTime=coalesce(EndTime, {TimeRange:end}), ClientType=coalesce(ClientType, ClientType1), ClientVersion=coalesce(ClientVersion, ClientVersion1)\r\n| extend ClientTypeShort=replace(\"com.microsoft.rdc.\", \"\", ClientType), ProbeTime = range(bin_at(StartTime, {TimeRange:grain}, {TimeRange:start}), bin_at(EndTime + {TimeRange:grain}, {TimeRange:grain}, {TimeRange:end}), {TimeRange:grain})\r\n| mv-expand ProbeTime to typeof(datetime)\r\n| extend ConnectionContainsProbe = (StartTime < ProbeTime and EndTime > ProbeTime),\r\n         ConnectionEndedInPreviousBucket = (StartTime < ProbeTime and EndTime + {TimeRange:grain} >= ProbeTime)\r\n| make-series Connections=dcountif(CorrelationId, ConnectionContainsProbe or ConnectionEndedInPreviousBucket) on ProbeTime from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by Client=strcat(ClientTypeShort, \" v\", ClientVersion)\r\n\r\n",
                                "size": 0,
                                "title": "Connections by client and version",
                                "noDataMessage": "No connections found for the configured filters.",
                                "timeContextFromParameter": "TimeRange",
                                "showExportToExcel": true,
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{poolla}"
                                ],
                                "visualization": "areachart",
                                "sortBy": [],
                                "chartSettings": {
                                  "showMetrics": false,
                                  "showLegend": true
                                }
                              },
                              "customWidth": "42",
                              "name": "ConnectionsByClientAndVersion",
                              "styleSettings": {
                                "margin": "6px"
                              }
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "WVDFeeds\r\n| where UserName == \"{UserName}\" and _ResourceId =~ '{wvdworkspace}' and (\"{SelectedClientType}\" == \"*\" or ClientType == \"{SelectedClientType}\")\r\n| extend ClientTypeShort=replace(\"com.microsoft.rdc.\", \"\", ClientType)\r\n| make-series FeedRefreshes=dcount(CorrelationId) on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by strcat(ClientTypeShort, \" v\", ClientVersion)\r\n",
                                "size": 0,
                                "title": "Feed refreshes by client and version",
                                "timeContextFromParameter": "TimeRange",
                                "showExportToExcel": true,
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{poolla}"
                                ],
                                "visualization": "areachart",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "ClientType",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "ClientVersion",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "LastSeen",
                                      "formatter": 6,
                                      "formatOptions": {
                                        "aggregation": "Max",
                                        "customColumnWidthSetting": "30ch"
                                      }
                                    },
                                    {
                                      "columnMatch": "FeedRefreshes",
                                      "formatter": 4,
                                      "formatOptions": {
                                        "min": 0,
                                        "palette": "gray",
                                        "aggregation": "Sum",
                                        "customColumnWidthSetting": "128px"
                                      }
                                    },
                                    {
                                      "columnMatch": "Connections",
                                      "formatter": 4,
                                      "formatOptions": {
                                        "min": 0,
                                        "palette": "blue",
                                        "aggregation": "Sum",
                                        "customColumnWidthSetting": "115px"
                                      }
                                    }
                                  ],
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "ClientType"
                                    ],
                                    "expandTopLevel": true,
                                    "finalBy": "ClientVersion"
                                  }
                                },
                                "sortBy": []
                              },
                              "customWidth": "42",
                              "name": "FeedRefreshesByClientAndVersion",
                              "styleSettings": {
                                "margin": "6px"
                              }
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "WVDConnections\r\n| where UserName == '{UserName}' and _ResourceId =~ '{HostPool}'\r\n| as Connections\r\n| where State == \"Connected\" and TimeGenerated <= {TimeRange:end}\r\n| join kind=inner\r\n(\r\n    WVDCheckpoints\r\n    | where (Name == \"LaunchExecutable\" and Parameters.connectionStage == \"RdpShellAppExecuted\") or Name==\"RdpShellAppExecuted\"\r\n    | project CorrelationId, Parameters=tostring(Parameters.filename)\r\n    | extend Parameters=trim('\"', Parameters) // remove quotes for paths with spaces in them\r\n    | extend Parameters=replace(@\"^(.*[\\\\\\/])\", \"\", tolower(Parameters)) // remove binary path to only keep file name\r\n    | extend Parameters=replace(@\"microsoft.windows(.+)_8wekyb3d8bbwe!app\", @\"\\1\", Parameters) //inbox apps to readable format\r\n) on CorrelationId\r\n| summarize TotalLaunches=dcount(CorrelationId), DaysLaunched=dcount(bin(TimeGenerated, 1d)), Clients=dcount(ClientType) by Parameters\r\n| extend Subtitle=\"Launches / Days with usage\", Clients=strcat(\"Used on \", Clients, iif(Clients > 1, \" different \", \" \"), \"client\", iif(Clients > 1, \"s\", \"\"))\r\n| sort by TotalLaunches desc",
                                "size": 1,
                                "title": "Remote apps used",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{poolla}"
                                ],
                                "visualization": "tiles",
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "Parameters",
                                    "formatter": 1
                                  },
                                  "subtitleContent": {
                                    "columnMatch": "Clients"
                                  },
                                  "leftContent": {
                                    "columnMatch": "TotalLaunches",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "style": "decimal",
                                        "maximumFractionDigits": 2,
                                        "maximumSignificantDigits": 3
                                      }
                                    }
                                  },
                                  "rightContent": {
                                    "columnMatch": "DaysLaunched",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    }
                                  },
                                  "secondaryContent": {
                                    "columnMatch": "Subtitle",
                                    "formatter": 1
                                  },
                                  "showBorder": false
                                }
                              },
                              "customWidth": "50",
                              "name": "PopularResourceByUser"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "WVDConnections\r\n| where UserName == '{UserName}' and _ResourceId =~ '{HostPool}'\r\n| as Connections\r\n| where State == \"Started\" and TimeGenerated <= {TimeRange:end}\r\n| extend StartTime = TimeGenerated\r\n| join kind=leftouter\r\n(\r\n    Connections\r\n    | where UserName == \"{UserName}\" and State == \"Completed\"\r\n    | extend EndTime = TimeGenerated\r\n)\r\non CorrelationId\r\n| extend EndTime = coalesce(EndTime, {TimeRange:end})\r\n| where EndTime >= {TimeRange:start}\r\n// limit duration hours to our timeframe even if connection spanned the edges...\r\n| extend Duration = min_of(EndTime, {TimeRange:end}) - max_of(StartTime, {TimeRange:start})\r\n| summarize Duration = sum(Duration) by Host=trim_end(@\"\\..*\", SessionHostName)\r\n| project Host, UsageHours = Duration / 1h\r\n",
                                "size": 1,
                                "title": "Connection time by host",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{poolla}"
                                ],
                                "visualization": "piechart",
                                "chartSettings": {
                                  "yAxis": [
                                    "UsageHours"
                                  ],
                                  "ySettings": {
                                    "numberFormatSettings": {
                                      "unit": 26,
                                      "options": {
                                        "style": "decimal",
                                        "useGrouping": true,
                                        "maximumFractionDigits": 1
                                      }
                                    }
                                  }
                                }
                              },
                              "customWidth": "50",
                              "name": "HostUsageByUser"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "let GetDaysInTimeRange = (Period:timespan) {\r\n    // Get the number of days in the period, note the period MUST be longer than 1 day, and in full days\r\n    max_of(toint(round(Period/1d, 0)), 1);\r\n};\r\nlet GetTimespanAverage = (Time:timespan, Period:timespan) {\r\n    // Get the number of days in the period, note the period MUST be longer than 1 day, and in full days\r\n    let Days = GetDaysInTimeRange(Period);\r\n    // Total hours is the number of days*24, plus the hours\r\n    let TotalHours = toint(format_timespan(Time, \"d\")) * 24 + toint(format_timespan(Time, \"H\"));\r\n    // Calculate the average hours\r\n    let AvgHours = TotalHours / Days;\r\n    // We're rounding down for the average, figure out fractional hours left \r\n    let MinuteResidue = toint(((1.0*TotalHours/Days) - AvgHours) * 60);\r\n    // Total minutes is the number of minutes plus the residue from above\r\n    let TotalMinutes = toint(format_timespan(Time, \"m\")) + MinuteResidue;\r\n    // Calculate average minutes\r\n    let AvgMinutes =  toint(round(todouble(TotalMinutes) / Days));\r\n    // Pad with zero if necessary\r\n    let MinuteStr = iif(AvgMinutes < 10, strcat(\"0\", AvgMinutes), tostring(AvgMinutes));\r\n    let Result = strcat(\"~ \", AvgHours, \":\", MinuteStr, \" h\");\r\n    iif(Time/1s > 0, Result, '');\r\n};\r\nlet ProbeRange = range ProbeDay from {TimeRange:start} to {TimeRange:end} step 1d | extend JoinKey=1;\r\nWVDConnections\r\n| where UserName == \"{UserName}\" and _ResourceId =~ '{HostPool}'\r\n| as UserConnections\r\n| where State == \"Started\" and TimeGenerated <= {TimeRange:end}\r\n| extend StartTime = TimeGenerated\r\n| join kind=rightouter\r\n(\r\n    UserConnections\r\n    | where State == \"Completed\"\r\n    | extend EndTime = TimeGenerated\r\n) on CorrelationId\r\n| extend StartTime = min_of(coalesce(StartTime, {TimeRange:start}), EndTime) // If the start time has fallen out of retention, it should not be set to after the EndTime\r\n| where StartTime between ({TimeRange:start} .. {TimeRange:end}) or // Connections starting in our date range\r\n        EndTime   between ({TimeRange:start} .. {TimeRange:end}) or // Connections ending in our date range\r\n        (StartTime <= {TimeRange:start} and EndTime >= {TimeRange:end}) // Connections that started before and ended after the range\r\n| extend EndTime=min_of(EndTime, {TimeRange:end})-1s, StartTime=max_of(StartTime,{TimeRange:start})+1s // Crop connections to within the report boundary\r\n| extend Duration = EndTime-StartTime\r\n| sort by ClientType asc // Sort for Clients string to be homogenous\r\n| as UserUsage\r\n| join kind=leftouter\r\n(\r\n    WVDCheckpoints\r\n    | where (Name == \"LaunchExecutable\" and Parameters.connectionStage == \"RdpShellAppExecuted\") or Name==\"RdpShellAppExecuted\"\r\n    | project CorrelationId, Parameters=tostring(Parameters.filename)\r\n) on CorrelationId\r\n| summarize AppsToStartConnection=dcount(ResourceAlias),\r\n            AppsUsed=dcount(Parameters),\r\n            Connections=dcount(CorrelationId),\r\n            Time=sum(Duration),\r\n            ClientCount=dcount(ClientType)\r\n            by UserName\r\n| join kind=leftouter \r\n(\r\n    // Count days with usage\r\n    UserUsage\r\n    | extend JoinKey = 1\r\n    | join kind=fullouter ProbeRange on JoinKey\r\n    | make-series ConnectedToday=dcountif(CorrelationId, bin(ProbeDay, 1d) == bin(StartTime, 1d) or \r\n                                                bin(ProbeDay, 1d) == bin(EndTime, 1d) or \r\n                                                bin(ProbeDay, 1d) between (bin(StartTime, 1d)..bin(EndTime, 1d)))\r\n                on ProbeDay from {TimeRange:start} to {TimeRange:end} step 1d by UserName\r\n    | mv-expand ProbeDay to typeof(datetime), ConnectedToday to typeof(int)\r\n    | summarize Days=countif(ConnectedToday > 0) by UserName\r\n) on UserName\r\n| project\r\n    ['Days in time range']=GetDaysInTimeRange({TimeRange:end} - {TimeRange:start}),\r\n    ['Days with usage']=coalesce(Days, 0),\r\n    ['Apps to start connection']=coalesce(AppsToStartConnection, 0),\r\n    ['Apps used']=coalesce(AppsUsed, 0),\r\n    ['Connection count']=coalesce(Connections, 0),\r\n    ['Connection time']=strcat(\"~ \", toint(format_timespan(Time, 'd'))*24+toint(format_timespan(Time, 'H')), \":\", format_timespan(Time, 'mm'), \" h\"),\r\n    ['Average daily time']=GetTimespanAverage(Time,{TimeRange:end} - {TimeRange:start}),\r\n    ['Client count']=coalesce(ClientCount, 0)\r\n| evaluate narrow()\r\n| project Metric=replace(@\"\\[|'|\\]\", \"\", Column), Value",
                                "size": 1,
                                "title": "Key usage numbers",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{poolla}"
                                ],
                                "visualization": "tiles",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "Days",
                                      "formatter": 0,
                                      "numberFormat": {
                                        "unit": 27,
                                        "options": {
                                          "style": "decimal",
                                          "useGrouping": false
                                        }
                                      }
                                    },
                                    {
                                      "columnMatch": "ConnectionTime",
                                      "formatter": 0,
                                      "numberFormat": {
                                        "unit": 24,
                                        "options": {
                                          "style": "decimal",
                                          "useGrouping": false,
                                          "maximumSignificantDigits": 2
                                        }
                                      }
                                    }
                                  ]
                                },
                                "tileSettings": {
                                  "titleContent": {
                                    "columnMatch": "Metric",
                                    "formatter": 1
                                  },
                                  "leftContent": {
                                    "columnMatch": "Value",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "palette": "auto"
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "style": "decimal",
                                        "maximumFractionDigits": 2,
                                        "maximumSignificantDigits": 3
                                      }
                                    }
                                  },
                                  "showBorder": false
                                },
                                "chartSettings": {
                                  "ySettings": {
                                    "numberFormatSettings": {
                                      "unit": 26,
                                      "options": {
                                        "style": "decimal",
                                        "useGrouping": true,
                                        "maximumFractionDigits": 1
                                      }
                                    }
                                  }
                                }
                              },
                              "name": "KeyUsageNumbersTiles"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "WVDConnections\r\n| where _ResourceId =~ \"{HostPool}\" and UserName == \"{UserName}\"\r\n| as ConnectionData\r\n| where State == \"Started\"\r\n| join kind = leftsemi\r\n(\r\n    // Only include connections that actually reached the host to prevent short (failed) attempts from skewing the data\r\n    WVDCheckpoints\r\n    | where Source == \"RDStack\" and Name =~ \"RdpStackConnectionEstablished\" and _ResourceId =~ \"{HostPool}\"\r\n) on CorrelationId\r\n\r\n| join kind = inner\r\n(\r\n    WVDCheckpoints\r\n    | where _ResourceId =~ \"{HostPool}\"\r\n    | where Name =~ \"LoadBalancedNewConnection\"\r\n    | extend LoadBalanceOutcome=Parameters.LoadBalanceOutcome\r\n    | project CorrelationId, ConnectionBackground=case(LoadBalanceOutcome == \"NewSession\", \"New session\", LoadBalanceOutcome in (\"Active\", \"Disconnected\", \"Pending\"), \"Existing session\", LoadBalanceOutcome)\r\n) on CorrelationId\r\n| join kind = inner\r\n(\r\n    WVDCheckpoints // new session\r\n    | where _ResourceId =~ \"{HostPool}\"\r\n    | where Name =~ \"ShellReady\" or (Name =~ \"LaunchExecutable\" and Parameters.connectionStage == \"RdpShellAppExecuted\") or Name=~\"RdpShellAppExecuted\"\r\n    | project TimeNewSessions=TimeGenerated, CorrelationId\r\n    | summarize TimeNewSessions=min(TimeNewSessions) by CorrelationId\r\n\r\n) on CorrelationId\r\n| join kind = inner ( \r\n        ConnectionData // existent Sessions\r\n        | where State == \"Connected\"\r\n        | project TimeConnected=TimeGenerated, CorrelationId\r\n) on CorrelationId\r\n| extend ProductiveTime = iff(ConnectionBackground==\"New session\",TimeNewSessions, TimeConnected)\r\n| join kind = leftouter\r\n(  \r\n    //OnCredentialsAcquisitionCompleted\t2021-09-13T16:48:50.4440000Z\tClient\t{\"CredentialType\":\"SavedPassword\",\"DurationMS\":\"9\",\"Success\":\"True\"}\r\n    WVDCheckpoints\r\n    | where _ResourceId =~ \"{HostPool}\"\r\n    | where Name =~ \"OnCredentialsAcquisitionCompleted\"\r\n    | project CorrelationId, credaquire = Parameters.DurationMS   \r\n) on CorrelationId\r\n| join kind = leftouter\r\n(  \r\n    WVDCheckpoints\r\n    | where _ResourceId =~ \"{HostPool}\"\r\n    | where Name =~ \"SSOTokenRetrieval\"\r\n    | project CorrelationId, ssotokeretrieval = Parameters.DurationMS\r\n) on CorrelationId\r\n| extend ProductiveTime = (ProductiveTime - TimeGenerated) / 1s - (coalesce(credaquire,0)/1000) - (coalesce(ssotokeretrieval,0)/1000)\r\n| make-series Median=percentile(ProductiveTime, 50) on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by ConnectionBackground\r\n\r\n",
                                "size": 0,
                                "aggregation": 5,
                                "title": "Time to connect",
                                "timeContextFromParameter": "TimeRange",
                                "showExportToExcel": true,
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{poolla}"
                                ],
                                "visualization": "unstackedbar",
                                "chartSettings": {
                                  "ySettings": {
                                    "numberFormatSettings": {
                                      "unit": 24,
                                      "options": {
                                        "style": "decimal",
                                        "useGrouping": true,
                                        "maximumSignificantDigits": 2
                                      }
                                    }
                                  }
                                }
                              },
                              "name": "TimeToConnectGraph"
                            },
                            {
                              "type": 12,
                              "content": {
                                "version": "NotebookGroup/1.0",
                                "groupType": "editable",
                                "items": [
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "let GetPrettyError=(ErrorName:string, ErrorCode:string)\r\n{\r\n    iif(ErrorName !in ('', '<>'), strcat(ErrorName, ' (', ErrorCode, ')'), ErrorCode)\r\n};\r\nWVDConnections\r\n| where TimeGenerated {TimeRange} and UserName == \"{UserName}\" and _ResourceId =~ '{HostPool}'\r\n| extend Client=strcat(replace(\"com.microsoft.rdc.\", \"\", ClientType), \" \", ClientVersion)\r\n| extend  PredecessorConnectionId=replace(\"<>\", \"\", trim(@\"{|}\", PredecessorConnectionId))\r\n| as Connections\r\n| where State==\"Started\"\r\n| extend StartTime = TimeGenerated\r\n| join kind=leftouter\r\n(\r\n    Connections\r\n    | summarize (EndTime, State)=arg_max(TimeGenerated, State) by CorrelationId\r\n) on CorrelationId\r\n| extend State=coalesce(State1, State)\r\n| join kind=leftouter\r\n(\r\n    WVDErrors\r\n    | project CorrelationId, ServiceError, Source, Error = GetPrettyError(CodeSymbolic, Code)\r\n    | distinct *\r\n    | summarize Errors=count() by CorrelationId\r\n) on CorrelationId\r\n| project CorrelationId, SessionId=strcat(substring(CorrelationId, 0, strlen(CorrelationId) - 4), \"*\"), UserName, SessionHostName, Errors=coalesce(Errors, 0), StartTime, EndTime, Duration=bin(EndTime-StartTime, 1s), ClientType, ClientVersion\r\n| summarize InitialConnection=min(StartTime), EndTime=max(EndTime), Duration=sum(Duration)/1s, Attempts=dcount(CorrelationId), Errors=sum(Errors), CorrelationId=makeset(CorrelationId)\r\n         by SessionHostName, SessionId, Client=strcat(replace(\"com.microsoft.rdc.\", \"\", ClientType), \" v\", ClientVersion)\r\n| project HostName=trim_end(@\"\\..*\", SessionHostName), SessionId, Attempts, Errors, Client, Duration, InitialConnection, CorrelationId\r\n",
                                      "size": 0,
                                      "title": "Connection activity browser for {TimeRange:label}",
                                      "noDataMessage": "No Connected Sessions detected in the selected time period",
                                      "exportedParameters": [
                                        {
                                          "fieldName": "SessionId",
                                          "parameterName": "GroupedCorrelationId"
                                        },
                                        {
                                          "fieldName": "HostName",
                                          "parameterName": "CorrelationHost",
                                          "parameterType": 1
                                        }
                                      ],
                                      "showExportToExcel": true,
                                      "queryType": 0,
                                      "resourceType": "microsoft.operationalinsights/workspaces",
                                      "crossComponentResources": [
                                        "{poolla}"
                                      ],
                                      "visualization": "table",
                                      "showExpandCollapseGrid": true,
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "$gen_group",
                                            "formatter": 0,
                                            "formatOptions": {
                                              "customColumnWidthSetting": "43ch"
                                            }
                                          },
                                          {
                                            "columnMatch": "HostName",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "SessionId",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "Attempts",
                                            "formatter": 4,
                                            "formatOptions": {
                                              "min": 0,
                                              "palette": "blue",
                                              "aggregation": "Sum"
                                            }
                                          },
                                          {
                                            "columnMatch": "Errors",
                                            "formatter": 4,
                                            "formatOptions": {
                                              "min": 0,
                                              "palette": "redBright",
                                              "aggregation": "Sum"
                                            }
                                          },
                                          {
                                            "columnMatch": "Client",
                                            "formatter": 5,
                                            "formatOptions": {
                                              "aggregation": "Unique"
                                            }
                                          },
                                          {
                                            "columnMatch": "Duration",
                                            "formatter": 1,
                                            "formatOptions": {
                                              "aggregation": "Sum"
                                            },
                                            "numberFormat": {
                                              "unit": 24,
                                              "options": {
                                                "style": "decimal",
                                                "useGrouping": false,
                                                "maximumSignificantDigits": 2
                                              }
                                            }
                                          },
                                          {
                                            "columnMatch": "InitialConnection",
                                            "formatter": 6,
                                            "formatOptions": {
                                              "aggregation": "Min",
                                              "customColumnWidthSetting": "24ch"
                                            }
                                          },
                                          {
                                            "columnMatch": "CorrelationId",
                                            "formatter": 5
                                          },
                                          {
                                            "columnMatch": "$gen_group",
                                            "formatter": 0,
                                            "formatOptions": {
                                              "customColumnWidthSetting": "43ch"
                                            }
                                          }
                                        ],
                                        "filter": true,
                                        "hierarchySettings": {
                                          "treeType": 1,
                                          "groupBy": [
                                            "Client",
                                            "HostName"
                                          ],
                                          "expandTopLevel": true,
                                          "finalBy": "SessionId"
                                        },
                                        "sortBy": [
                                          {
                                            "itemKey": "InitialConnection",
                                            "sortOrder": 1
                                          }
                                        ],
                                        "labelSettings": [
                                          {
                                            "columnId": "Client",
                                            "label": "Connections by client and host"
                                          },
                                          {
                                            "columnId": "InitialConnection",
                                            "label": "Initial connection"
                                          }
                                        ]
                                      },
                                      "sortBy": [
                                        {
                                          "itemKey": "InitialConnection",
                                          "sortOrder": 1
                                        }
                                      ]
                                    },
                                    "customWidth": "50",
                                    "name": "wvdconnectedsessionsdetails",
                                    "styleSettings": {
                                      "padding": "10px"
                                    }
                                  },
                                  {
                                    "type": 12,
                                    "content": {
                                      "version": "NotebookGroup/1.0",
                                      "groupType": "editable",
                                      "items": [
                                        {
                                          "type": 3,
                                          "content": {
                                            "version": "KqlItem/1.0",
                                            "query": "let GetPrettyError=(ErrorName:string, ErrorCode:string)\r\n{\r\n    iif(ErrorName !in ('', '<>'), strcat(ErrorName, ' (', ErrorCode, ')'), ErrorCode)\r\n};\r\nlet IsSelectedCorrelation = (Selected:string, Current:string)\r\n{\r\n    let GuidStart = substring(Selected, 0, strlen(Selected)-1);\r\n    (Selected contains \"*\" and Current startswith GuidStart)     or    Current == Selected\r\n};\r\nWVDCheckpoints\r\n| where TimeGenerated {TimeRange} and IsSelectedCorrelation(\"{GroupedCorrelationId}\", CorrelationId)\r\n| project CorrelationId, TimeGenerated, Kind=\"Checkpoint\", Source, Information=Name, Parameters\r\n| as ResultSet\r\n| union\r\n(\r\n    WVDErrors\r\n    | where IsSelectedCorrelation(\"{GroupedCorrelationId}\", CorrelationId)\r\n    | project CorrelationId,TimeGenerated, Kind=iif(ServiceError, \"Service\", \"Deployment\"), Source, Information = GetPrettyError(CodeSymbolic, Code)\r\n    | distinct *\r\n)\r\n| join kind = leftouter\r\n(\r\n    ResultSet\r\n    | where Source == \"RDStack\" and Information == \"RdpStackConnectionEstablished\"\r\n    | project CorrelationId, Connected=true\r\n    | summarize Success=dcountif(CorrelationId, Connected)>0 by CorrelationId\r\n) on CorrelationId\r\n| extend CorrelationId=strcat(iif(Success, \"🟢\", \"🔴\"), \" \", CorrelationId)\r\n| project-away Success\r\n| sort by CorrelationId asc, TimeGenerated asc\r\n",
                                            "size": 2,
                                            "title": "Connecting to {CorrelationHost}",
                                            "noDataMessage": "No errors were found for the selected session.",
                                            "timeContextFromParameter": "TimeRange",
                                            "showExportToExcel": true,
                                            "queryType": 0,
                                            "resourceType": "microsoft.operationalinsights/workspaces",
                                            "crossComponentResources": [
                                              "{poolla}"
                                            ],
                                            "visualization": "table",
                                            "showExpandCollapseGrid": true,
                                            "gridSettings": {
                                              "formatters": [
                                                {
                                                  "columnMatch": "CorrelationId",
                                                  "formatter": 5
                                                },
                                                {
                                                  "columnMatch": "TimeGenerated",
                                                  "formatter": 5,
                                                  "numberFormat": {
                                                    "unit": 0,
                                                    "options": {
                                                      "style": "decimal",
                                                      "useGrouping": false
                                                    }
                                                  }
                                                },
                                                {
                                                  "columnMatch": "Kind",
                                                  "formatter": 18,
                                                  "formatOptions": {
                                                    "thresholdsOptions": "icons",
                                                    "thresholdsGrid": [
                                                      {
                                                        "operator": "==",
                                                        "thresholdValue": "Checkpoint",
                                                        "representation": "Normal",
                                                        "text": "{0}{1}"
                                                      },
                                                      {
                                                        "operator": "==",
                                                        "thresholdValue": "Deployment",
                                                        "representation": "3",
                                                        "text": "{0}{1}"
                                                      },
                                                      {
                                                        "operator": "==",
                                                        "thresholdValue": "Service",
                                                        "representation": "Important",
                                                        "text": "{0}{1}"
                                                      },
                                                      {
                                                        "operator": "Default",
                                                        "thresholdValue": null,
                                                        "representation": "Blank",
                                                        "text": "{0}{1}"
                                                      }
                                                    ]
                                                  }
                                                }
                                              ],
                                              "filter": true,
                                              "hierarchySettings": {
                                                "treeType": 1,
                                                "groupBy": [
                                                  "CorrelationId"
                                                ],
                                                "expandTopLevel": true,
                                                "finalBy": "TimeGenerated"
                                              },
                                              "labelSettings": [
                                                {
                                                  "columnId": "CorrelationId",
                                                  "label": "Attempt and timestamp"
                                                }
                                              ]
                                            },
                                            "sortBy": []
                                          },
                                          "conditionalVisibility": {
                                            "parameterName": "GroupedCorrelationId",
                                            "comparison": "isNotEqualTo"
                                          },
                                          "name": "ConnectingByHost",
                                          "styleSettings": {
                                            "padding": "10px"
                                          }
                                        },
                                        {
                                          "type": 1,
                                          "content": {
                                            "json": "Use the search box or browse for a connection ID and select it to display details here. ",
                                            "style": "info"
                                          },
                                          "conditionalVisibility": {
                                            "parameterName": "GroupedCorrelationId",
                                            "comparison": "isEqualTo"
                                          },
                                          "name": "text - 1",
                                          "styleSettings": {
                                            "margin": "10px",
                                            "padding": "10px"
                                          }
                                        }
                                      ]
                                    },
                                    "customWidth": "50",
                                    "name": "group - 2"
                                  }
                                ]
                              },
                              "name": "Activity browser",
                              "styleSettings": {
                                "showBorder": true
                              }
                            },
                            {
                              "type": 12,
                              "content": {
                                "version": "NotebookGroup/1.0",
                                "groupType": "editable",
                                "items": [
                                  {
                                    "type": 9,
                                    "content": {
                                      "version": "KqlParameterItem/1.0",
                                      "parameters": [
                                        {
                                          "id": "8809818d-1aa3-4a27-ac0b-b1808000be06",
                                          "version": "KqlParameterItem/1.0",
                                          "name": "wvdActivityType",
                                          "label": "Activity Type",
                                          "type": 10,
                                          "description": "Scope top errors by activity type",
                                          "isRequired": true,
                                          "query": "WVDErrors\r\n| distinct ActivityType\r\n| sort by ActivityType asc\r\n| project label=ActivityType, value=ActivityType, selected=(row_number() == 1)",
                                          "crossComponentResources": [
                                            "{poolla}"
                                          ],
                                          "typeSettings": {
                                            "additionalResourceOptions": []
                                          },
                                          "timeContext": {
                                            "durationMs": 2592000000
                                          },
                                          "timeContextFromParameter": "TimeRange",
                                          "queryType": 0,
                                          "resourceType": "microsoft.operationalinsights/workspaces"
                                        },
                                        {
                                          "id": "2660c262-528a-4897-8631-94acd157c3c0",
                                          "version": "KqlParameterItem/1.0",
                                          "name": "TopNErrors",
                                          "label": "Display top N errors",
                                          "type": 2,
                                          "description": "The number of errors (by count of activities impacted) returned",
                                          "isRequired": true,
                                          "typeSettings": {
                                            "additionalResourceOptions": []
                                          },
                                          "jsonData": "[ \r\n    {\r\n        \"label\": \"10\",\r\n        \"value\": \"10\",\r\n        \"selected\": true\r\n    },\r\n    {\r\n        \"label\": \"25\",\r\n        \"value\": \"25\"\r\n    },\r\n    {\r\n        \"label\": \"All\",\r\n        \"value\": \"99999\"\r\n    }\r\n]",
                                          "timeContext": {
                                            "durationMs": 2592000000
                                          },
                                          "timeContextFromParameter": "TimeRange"
                                        }
                                      ],
                                      "style": "pills",
                                      "queryType": 0,
                                      "resourceType": "microsoft.operationalinsights/workspaces"
                                    },
                                    "name": "parameters - 12"
                                  },
                                  {
                                    "type": 3,
                                    "content": {
                                      "version": "KqlItem/1.0",
                                      "query": "let GetPrettyError=(ErrorName:string, ErrorCode:string)\r\n{\r\n    iif(ErrorName !in ('', '<>'), strcat(ErrorName, ' (', ErrorCode, ')'), ErrorCode)\r\n};\r\nWVDConnections\r\n| where \"{wvdActivityType}\" == \"Connection\" and UserName == \"{UserName}\" and _ResourceId =~ '{HostPool}' \r\n| union (WVDFeeds             | where \"{wvdActivityType}\" == \"Feed\"             and UserName == \"{UserName}\" and _ResourceId =~ '{wvdworkspace}')\r\n| union (WVDManagement        | where \"{wvdActivityType}\" == \"Management\"       and UserName == \"{UserName}\" and (_ResourceId =~ '{wvdworkspace}' or _ResourceId =~ '{HostPool}'))\r\n| join kind=rightouter\r\n(\r\n    WVDErrors\r\n    | where TimeGenerated {TimeRange} and ActivityType == \"{wvdActivityType}\" and (_ResourceId =~ '{wvdworkspace}' or _ResourceId =~ '{HostPool}')\r\n    | extend Error=GetPrettyError(CodeSymbolic, Code)\r\n) on CorrelationId\r\n| as ErrorList\r\n| make-series ActivitiesImpactedOverTime=dcount(CorrelationId) default=0,\r\n              HostsImpactedOverTime=dcountif(SessionHostName, strlen(SessionHostName) > 2) default=0\r\n           on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by ActivityType, ServiceError, Source, Error\r\n| join kind=inner\r\n(\r\n    ErrorList\r\n    | summarize MessageSample=any(Message), TotalActivitiesImpacted=dcount(CorrelationId), TotalUsersImpacted=dcountif(UserName, strlen(UserName) > 2), TotalHostsImpacted=dcountif(SessionHostName, strlen(SessionHostName) > 2)\r\n             by ActivityType, ServiceError, Source, Error\r\n) on ActivityType, ServiceError, Source, Error\r\n| project Kind=iif(ServiceError, \"Service\", \"Deployment\"), Source, Error, MessageSample, TotalActivitiesImpacted, ActivitiesImpactedOverTime, TotalHostsImpacted, HostsImpactedOverTime\r\n// Hosts count not applicable for Feed activities, so blank out the columns\r\n| extend TotalHostsImpacted=iif(\"{wvdActivityType}\" != \"Feed\", TotalHostsImpacted, int(null)), HostsImpactedOverTime=iif(\"{wvdActivityType}\" != \"Feed\", HostsImpactedOverTime, series_divide(HostsImpactedOverTime, todouble(0/0)))\r\n| sort by TotalActivitiesImpacted, TotalHostsImpacted\r\n| top {TopNErrors} by TotalActivitiesImpacted",
                                      "size": 0,
                                      "aggregation": 3,
                                      "title": "Ranking of errors impacting {wvdActivityType} activities for {UserName} in {TimeRange:label}",
                                      "noDataMessage": "No errors reported in the selected time period",
                                      "timeContextFromParameter": "TimeRange",
                                      "exportFieldName": "label",
                                      "exportParameterName": "wvderror",
                                      "showExportToExcel": true,
                                      "queryType": 0,
                                      "resourceType": "microsoft.operationalinsights/workspaces",
                                      "crossComponentResources": [
                                        "{poolla}"
                                      ],
                                      "visualization": "table",
                                      "gridSettings": {
                                        "formatters": [
                                          {
                                            "columnMatch": "Kind",
                                            "formatter": 18,
                                            "formatOptions": {
                                              "thresholdsOptions": "icons",
                                              "thresholdsGrid": [
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "Service",
                                                  "representation": "Important",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "==",
                                                  "thresholdValue": "Deployment",
                                                  "representation": "3",
                                                  "text": "{0}{1}"
                                                },
                                                {
                                                  "operator": "Default",
                                                  "thresholdValue": null,
                                                  "representation": "Blank",
                                                  "text": "{0}{1}"
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "columnMatch": "TotalActivitiesImpacted",
                                            "formatter": 4,
                                            "formatOptions": {
                                              "min": 0,
                                              "palette": "blue"
                                            }
                                          },
                                          {
                                            "columnMatch": "ActivitiesImpactedOverTime",
                                            "formatter": 21,
                                            "formatOptions": {
                                              "palette": "blue",
                                              "customColumnWidthSetting": "210px"
                                            }
                                          },
                                          {
                                            "columnMatch": "TotalHostsImpacted",
                                            "formatter": 4,
                                            "formatOptions": {
                                              "min": 0,
                                              "palette": "magenta"
                                            }
                                          },
                                          {
                                            "columnMatch": "HostsImpactedOverTime",
                                            "formatter": 21,
                                            "formatOptions": {
                                              "palette": "magenta",
                                              "customColumnWidthSetting": "210px"
                                            }
                                          },
                                          {
                                            "columnMatch": "TotalUsersImpacted",
                                            "formatter": 4,
                                            "formatOptions": {
                                              "palette": "turquoise"
                                            }
                                          },
                                          {
                                            "columnMatch": "UsersImpactedOverTime",
                                            "formatter": 21,
                                            "formatOptions": {
                                              "palette": "turquoise"
                                            }
                                          }
                                        ],
                                        "labelSettings": [
                                          {
                                            "columnId": "MessageSample",
                                            "label": "Message sample"
                                          },
                                          {
                                            "columnId": "TotalActivitiesImpacted",
                                            "label": "Activities"
                                          },
                                          {
                                            "columnId": "ActivitiesImpactedOverTime",
                                            "label": "Over time"
                                          },
                                          {
                                            "columnId": "TotalHostsImpacted",
                                            "label": "Hosts"
                                          },
                                          {
                                            "columnId": "HostsImpactedOverTime",
                                            "label": "Over time"
                                          }
                                        ]
                                      },
                                      "sortBy": [],
                                      "tileSettings": {
                                        "showBorder": false,
                                        "titleContent": {
                                          "columnMatch": "CodeSymbolic",
                                          "formatter": 1
                                        },
                                        "leftContent": {
                                          "columnMatch": "ErrorRate",
                                          "formatter": 12,
                                          "formatOptions": {
                                            "palette": "auto"
                                          },
                                          "numberFormat": {
                                            "unit": 17,
                                            "options": {
                                              "maximumSignificantDigits": 3,
                                              "maximumFractionDigits": 2
                                            }
                                          }
                                        }
                                      },
                                      "graphSettings": {
                                        "type": 0,
                                        "topContent": {
                                          "columnMatch": "CodeSymbolic",
                                          "formatter": 1
                                        },
                                        "centerContent": {
                                          "columnMatch": "usercount",
                                          "formatter": 1,
                                          "numberFormat": {
                                            "unit": 17,
                                            "options": {
                                              "maximumSignificantDigits": 3,
                                              "maximumFractionDigits": 2
                                            }
                                          }
                                        }
                                      },
                                      "chartSettings": {
                                        "ySettings": {
                                          "numberFormatSettings": {
                                            "unit": 0,
                                            "options": {
                                              "style": "percent",
                                              "useGrouping": true
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "showPin": true,
                                    "name": "Ranking Errors"
                                  }
                                ]
                              },
                              "name": "ErrorRankingGroup",
                              "styleSettings": {
                                "showBorder": true
                              }
                            }
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "UserName",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "UserSelectedGroup"
                      }
                    ]
                  },
                  "name": "User_Group"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "UserReport"
            },
            "name": "userreport"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "c84ce0a1-5b4b-44ae-a7f7-be40f620f5dc",
                              "version": "KqlParameterItem/1.0",
                              "name": "ActivityType",
                              "label": "Activity type",
                              "type": 2,
                              "description": "The type of activity generated by the client as it communicates with the AVD service. Connection activities are generated when a user actively chooses to connect to a published resource on a VM. Feed refresh activities are generated when the client retrieves the list of those published resources, which can happen automatically in the background.",
                              "isRequired": true,
                              "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{\\r\\n\\t\\t\\\"value\\\": \\\"WVDConnections\\\",\\r\\n\\t\\t\\\"display\\\": \\\"Connections\\\",\\r\\n\\t\\t\\\"selected\\\": \\\"true\\\"\\r\\n\\t},\\r\\n\\t{\\r\\n\\t\\t\\\"value\\\": \\\"WVDFeeds\\\",\\r\\n\\t\\t\\\"display\\\": \\\"Feed refreshes\\\"\\r\\n\\t},\\r\\n\\t{\\r\\n\\t\\t\\\"value\\\": \\\"*\\\",\\r\\n\\t\\t\\\"display\\\": \\\"Connections and feed refreshes\\\"\\r\\n\\t}\\r\\n]\",\"transformers\":null}",
                              "value": "*",
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 0
                              },
                              "queryType": 8
                            }
                          ],
                          "style": "pills",
                          "queryType": 8
                        },
                        "name": "Activity type parameter"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDConnections\r\n| where (\"{ActivityType}\" == Type or \"{ActivityType}\" == \"*\") and _ResourceId =~ '{HostPool}'\r\n| distinct CorrelationId, UserName, ClientType, ClientVersion\r\n| union\r\n(\r\n    WVDFeeds\r\n    | where (\"{ActivityType}\" == Type or \"{ActivityType}\" == \"*\") and _ResourceId =~ '{wvdworkspace}'\r\n    | distinct CorrelationId, UserName, ClientType, ClientVersion\r\n)\r\n| summarize Users=dcount(UserName), Activities=dcount(CorrelationId), Versions=dcount(ClientVersion) by ClientType\r\n| project ClientType, ClientShort=replace(\"com.microsoft.rdc.\", \"\", ClientType), Versions, Users, Activities\r\n| extend AggregationLevel=\"ClientVersion\", ChartTitle=strcat(\"Active users (on \", ClientShort, \") by client version over time\")\r\n| sort by Users desc, Activities desc",
                          "size": 0,
                          "aggregation": 5,
                          "timeContextFromParameter": "TimeRange",
                          "exportedParameters": [
                            {
                              "fieldName": "ClientType",
                              "parameterName": "SelectedClientType",
                              "parameterType": 1,
                              "defaultValue": "*"
                            },
                            {
                              "fieldName": "AggregationLevel",
                              "parameterName": "SelectedAggregationLevel",
                              "parameterType": 1,
                              "defaultValue": "ClientTypeShort"
                            },
                            {
                              "fieldName": "ChartTitle",
                              "parameterName": "ChartTitle",
                              "parameterType": 1,
                              "defaultValue": "Active users by client type over time"
                            },
                            {
                              "fieldName": "ClientShort",
                              "parameterName": "SelectedClientShort",
                              "parameterType": 1,
                              "defaultValue": "all clients"
                            }
                          ],
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "ClientType",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Versions",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Users",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true
                                  }
                                }
                              },
                              {
                                "columnMatch": "Activities",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "gray"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true
                                  }
                                }
                              },
                              {
                                "columnMatch": "AggregationLevel",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "ChartTitle",
                                "formatter": 5
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "ClientShort",
                                "label": "Client"
                              }
                            ]
                          },
                          "sortBy": [],
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "ClientTypeShort"
                            },
                            "subtitleContent": {
                              "columnMatch": "Subtitle"
                            },
                            "leftContent": {
                              "columnMatch": "UsersConnecting",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            },
                            "rightContent": {
                              "columnMatch": "UsersRefreshing",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            },
                            "secondaryContent": {
                              "columnMatch": "Versions"
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "30",
                        "name": "Client apps selector",
                        "styleSettings": {
                          "margin": "10px",
                          "padding": "10px"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDConnections\r\n| where \"{ActivityType}\" == Type or \"{ActivityType}\" == \"*\"\r\n| where (\"{SelectedClientType}\" == \"*\" or \"{SelectedClientType}\" == ClientType) and _ResourceId =~ '{HostPool}'\r\n| as SourceData\r\n| where State==\"Started\"\r\n| project-rename StartTime=TimeGenerated\r\n| join kind=fullouter\r\n(\r\n    SourceData\r\n    | where State == \"Completed\"\r\n    | project CorrelationId, UserName, ClientVersion, ClientType, EndTime=TimeGenerated\r\n) on CorrelationId\r\n| project CorrelationId=coalesce(CorrelationId, CorrelationId1), UserName=coalesce(UserName, UserName1), StartTime=coalesce(StartTime, {TimeRange:start}), EndTime=coalesce(EndTime, {TimeRange:end}), ClientType=coalesce(ClientType, ClientType1), ClientVersion=coalesce(ClientVersion, ClientVersion1)\r\n| union\r\n(\r\n    WVDFeeds\r\n    | where _ResourceId =~ '{wvdworkspace}' and (\"{ActivityType}\" == Type or \"{ActivityType}\" == \"*\")\r\n    | where \"{SelectedClientType}\" == \"*\" or \"{SelectedClientType}\" == ClientType\r\n    | summarize StartTime=min(TimeGenerated), EndTime=max(TimeGenerated) by UserName, ClientType, ClientVersion, RefreshOperation=substring(CorrelationId, 0, 36 - 4)\r\n)\r\n| extend ClientTypeShort=replace(\"com.microsoft.rdc.\", \"\", ClientType), ProbeTime = range(bin_at(StartTime, {TimeRange:grain}, {TimeRange:start}), bin_at(EndTime + {TimeRange:grain}, {TimeRange:grain}, {TimeRange:end}), {TimeRange:grain})\r\n| mv-expand ProbeTime to typeof(datetime)\r\n| extend ConnectionContainsProbe = (StartTime < ProbeTime and EndTime > ProbeTime),\r\n         ConnectionEndedInPreviousBucket = (StartTime < ProbeTime and EndTime + {TimeRange:grain} >= ProbeTime)\r\n| extend ShouldCount = ConnectionContainsProbe or ConnectionEndedInPreviousBucket\r\n| make-series Users=dcountif(UserName, ShouldCount) on ProbeTime from {TimeRange:start} to {TimeRange:end}+{TimeRange:grain} step {TimeRange:grain} by {SelectedAggregationLevel}\r\n",
                          "size": 0,
                          "aggregation": 5,
                          "title": "{ChartTitle}",
                          "noDataMessage": "There were no activities found for the selected filters",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "visualization": "areachart",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "ClientType",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "ClientTypeShort",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "25ch"
                                }
                              },
                              {
                                "columnMatch": "UsersConnecting",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue",
                                  "customColumnWidthSetting": "100px"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false
                                  }
                                }
                              },
                              {
                                "columnMatch": "ConnectionCount",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue",
                                  "customColumnWidthSetting": "100px"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true
                                  }
                                }
                              },
                              {
                                "columnMatch": "UsersRefreshing",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "gray",
                                  "customColumnWidthSetting": "100px"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false
                                  }
                                }
                              },
                              {
                                "columnMatch": "RefreshCount",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "gray",
                                  "customColumnWidthSetting": "100px"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true
                                  }
                                }
                              },
                              {
                                "columnMatch": "LatestVersion",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "17ch"
                                }
                              },
                              {
                                "columnMatch": "Versions",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "14ch"
                                }
                              }
                            ]
                          },
                          "sortBy": []
                        },
                        "customWidth": "70",
                        "name": "Active users by client over time",
                        "styleSettings": {
                          "margin": "10px",
                          "padding": "10px",
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDConnections\r\n| where \"{ActivityType}\" == Type or \"{ActivityType}\" == \"*\"\r\n| where \"{SelectedClientType}\" == \"*\" or \"{SelectedClientType}\" == ClientType\r\n| where _ResourceId =~ '{HostPool}'\r\n| union\r\n(\r\n    WVDFeeds\r\n    | where _ResourceId =~ '{wvdworkspace}' and (\"{ActivityType}\" == Type or \"{ActivityType}\" == \"*\")\r\n    | where \"{SelectedClientType}\" == \"*\" or \"{SelectedClientType}\" == ClientType\r\n)\r\n| summarize Users=dcount(UserName), Activities=dcount(CorrelationId) by ClientType, ClientVersion\r\n| as VersionData\r\n| join kind=leftouter\r\n(\r\n    VersionData\r\n    | extend ExtendedVersion=strcat(ClientVersion, '.0.0.0.0')\r\n    | extend FirstFourSegments=indexof(ExtendedVersion, \".\", indexof(ExtendedVersion, \".\", indexof(ExtendedVersion, \".\", indexof(ExtendedVersion, \".\") + 1) + 1) + 1)\r\n    | extend NormalizedVersion=substring(ExtendedVersion, 0, FirstFourSegments)\r\n    | distinct ClientType, ClientVersion, NormalizedVersion\r\n    | as VersionCatalog\r\n    | join kind=inner\r\n    (\r\n        VersionCatalog\r\n        | distinct ClientType, NormalizedVersion\r\n        | extend SplitVersion=split(NormalizedVersion, '.')\r\n        | order by ClientType, toint(SplitVersion[0]) desc, toint(SplitVersion[1]) desc, toint(SplitVersion[2]) desc, toint(SplitVersion[3]) desc\r\n        | extend VersionSortIndex=row_number(1, prev(ClientType) != ClientType)\r\n        | project ClientType, NormalizedVersion, VersionSortIndex\r\n    ) on ClientType, NormalizedVersion\r\n    | project ClientType, ClientVersion, VersionSortIndex\r\n) on ClientType, ClientVersion\r\n| project VersionSortIndex, ClientType=replace(\"com.microsoft.rdc.\", \"\", ClientType), ClientVersion, Users, Activities\r\n| sort by VersionSortIndex asc",
                          "size": 0,
                          "title": "Usage by client version for {SelectedClientShort}",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "VersionSortIndex",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "ClientType",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "ClientVersion",
                                "formatter": 1,
                                "formatOptions": {
                                  "customColumnWidthSetting": "24ch"
                                }
                              },
                              {
                                "columnMatch": "Users",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true
                                  }
                                }
                              },
                              {
                                "columnMatch": "Activities",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "gray"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true
                                  }
                                }
                              }
                            ],
                            "rowLimit": 500,
                            "labelSettings": [
                              {
                                "columnId": "VersionSortIndex",
                                "label": "#",
                                "comment": "The descending sort index for the version number"
                              },
                              {
                                "columnId": "ClientType",
                                "label": "Client versions",
                                "comment": ""
                              },
                              {
                                "columnId": "ClientVersion",
                                "label": "Version",
                                "comment": "Software version of the client"
                              }
                            ]
                          },
                          "sortBy": []
                        },
                        "customWidth": "30",
                        "conditionalVisibility": {
                          "parameterName": "SelectedClientShort",
                          "comparison": "isNotEqualTo",
                          "value": "all clients"
                        },
                        "name": "Usage by client version for client type",
                        "styleSettings": {
                          "margin": "10px",
                          "padding": "10px",
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDConnections\r\n| where \"{ActivityType}\" == Type or \"{ActivityType}\" == \"*\"\r\n| where \"{SelectedClientType}\" == \"*\" or \"{SelectedClientType}\" == ClientType\r\n| where _ResourceId =~ '{HostPool}'\r\n| union\r\n(\r\n    WVDFeeds\r\n    | where _ResourceId =~ '{wvdworkspace}' and (\"{ActivityType}\" == Type or \"{ActivityType}\" == \"*\")\r\n    | where \"{SelectedClientType}\" == \"*\" or \"{SelectedClientType}\" == ClientType\r\n)\r\n| summarize Users=dcount(UserName), Activities=dcount(CorrelationId) by ClientType, ClientVersion\r\n| as VersionData\r\n| join kind=leftouter\r\n(\r\n    VersionData\r\n    | extend ExtendedVersion=strcat(ClientVersion, '.0.0.0.0')\r\n    | extend FirstFourSegments=indexof(ExtendedVersion, \".\", indexof(ExtendedVersion, \".\", indexof(ExtendedVersion, \".\", indexof(ExtendedVersion, \".\") + 1) + 1) + 1)\r\n    | extend NormalizedVersion=substring(ExtendedVersion, 0, FirstFourSegments)\r\n    | distinct ClientType, ClientVersion, NormalizedVersion\r\n    | as VersionCatalog\r\n    | join kind=inner\r\n    (\r\n        VersionCatalog\r\n        | distinct ClientType, NormalizedVersion\r\n        | extend SplitVersion=split(NormalizedVersion, '.')\r\n        | order by ClientType, toint(SplitVersion[0]) desc, toint(SplitVersion[1]) desc, toint(SplitVersion[2]) desc, toint(SplitVersion[3]) desc\r\n        | extend VersionSortIndex=row_number(1, prev(ClientType) != ClientType)\r\n        | project ClientType, NormalizedVersion, VersionSortIndex\r\n    ) on ClientType, NormalizedVersion\r\n    | project ClientType, ClientVersion, VersionSortIndex\r\n) on ClientType, ClientVersion\r\n| project VersionSortIndex, ClientType=replace(\"com.microsoft.rdc.\", \"\", ClientType), ClientVersion, Users, Activities\r\n| sort by VersionSortIndex asc",
                          "size": 0,
                          "title": "Usage by client version for {SelectedClientShort}",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "$gen_group",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "29.2857ch"
                                }
                              },
                              {
                                "columnMatch": "VersionSortIndex",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "ClientType",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "ClientVersion",
                                "formatter": 5,
                                "formatOptions": {
                                  "customColumnWidthSetting": "17ch"
                                }
                              },
                              {
                                "columnMatch": "Users",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true
                                  }
                                }
                              },
                              {
                                "columnMatch": "Activities",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "gray",
                                  "aggregation": "Sum"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true
                                  }
                                }
                              }
                            ],
                            "rowLimit": 500,
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "ClientType"
                              ],
                              "expandTopLevel": false,
                              "finalBy": "ClientVersion"
                            },
                            "sortBy": [
                              {
                                "itemKey": "$gen_count_$gen_group_0",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "VersionSortIndex",
                                "label": "#",
                                "comment": "The descending sort index for the version number"
                              },
                              {
                                "columnId": "ClientType",
                                "label": "Client versions",
                                "comment": ""
                              },
                              {
                                "columnId": "ClientVersion",
                                "label": "Version",
                                "comment": "Software version of the client"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "$gen_count_$gen_group_0",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "customWidth": "30",
                        "conditionalVisibility": {
                          "parameterName": "SelectedClientShort",
                          "comparison": "isEqualTo",
                          "value": "all clients"
                        },
                        "name": "Usage by client version for all clients",
                        "styleSettings": {
                          "margin": "10px",
                          "padding": "10px",
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let LatestClientsReleaseTimes =\r\nWVDConnections\r\n| where \"{SelectedClientType}\" == \"*\" or \"{SelectedClientType}\" == ClientType\r\n| where _ResourceId =~ '{HostPool}'\r\n| summarize FirstSeen=min(TimeGenerated) by ClientType, ClientVersion\r\n| join kind=fullouter\r\n(\r\n    WVDFeeds\r\n    | where _ResourceId =~ '{wvdworkspace}' and (\"{SelectedClientType}\" == \"*\" or \"{SelectedClientType}\" == ClientType)\r\n    | summarize FirstSeen=min(TimeGenerated) by ClientType, ClientVersion\r\n) on ClientType, ClientVersion\r\n| project ClientType=coalesce(ClientType, ClientType1), ClientVersion=coalesce(ClientVersion, ClientVersion1), FirstSeen=min_of(FirstSeen, FirstSeen1)\r\n| extend ExtendedVersion=strcat(ClientVersion, '.0.0.0.0')\r\n| extend FirstFourSegments=indexof(ExtendedVersion, \".\", indexof(ExtendedVersion, \".\", indexof(ExtendedVersion, \".\", indexof(ExtendedVersion, \".\") + 1) + 1) + 1)\r\n| extend NormalizedVersion=substring(ExtendedVersion, 0, FirstFourSegments)\r\n| as VersionCatalog\r\n| join kind=inner\r\n(\r\n    VersionCatalog\r\n    | distinct ClientType, NormalizedVersion\r\n    | extend SplitVersion=split(NormalizedVersion, '.')\r\n    | order by ClientType, toint(SplitVersion[0]) desc, toint(SplitVersion[1]) desc, toint(SplitVersion[2]) desc, toint(SplitVersion[3]) desc\r\n    | extend VersionSortIndex=row_number(1, prev(ClientType) != ClientType)\r\n    | project ClientType, NormalizedVersion, VersionSortIndex\r\n) on ClientType, NormalizedVersion\r\n| project ClientType, ClientVersion, FirstSeen, VersionSortIndex;\r\nWVDConnections\r\n| where TimeGenerated {TimeRange} and (\"{SelectedClientType}\" == \"*\" or \"{SelectedClientType}\" == ClientType)\r\n| where _ResourceId =~ '{HostPool}'\r\n| summarize ConnectionCount=dcount(CorrelationId), LastSeen=max(TimeGenerated) by UserName, ClientType, ClientVersion\r\n| join kind=fullouter\r\n(\r\n    WVDFeeds\r\n    | where TimeGenerated {TimeRange} and _ResourceId =~ '{wvdworkspace}' and (\"{SelectedClientType}\" == \"*\" or \"{SelectedClientType}\" == ClientType)\r\n    | summarize RefreshCount=dcount(CorrelationId), LastSeen=max(TimeGenerated) by UserName, ClientType, ClientVersion\r\n) on UserName, ClientType, ClientVersion\r\n| project UserName=coalesce(UserName, UserName1), ClientType=coalesce(ClientType, ClientType1), ClientVersion=coalesce(ClientVersion, ClientVersion1), LastSeen=max_of(LastSeen1, LastSeen), Connections=coalesce(ConnectionCount, 0), Refreshes=coalesce(RefreshCount, 0)\r\n| project-away *1\r\n| as UserData\r\n| join kind=leftouter\r\n(\r\n    UserData\r\n    | extend ExtendedVersion=strcat(ClientVersion, '.0.0.0.0')\r\n    | extend FirstFourSegments=indexof(ExtendedVersion, \".\", indexof(ExtendedVersion, \".\", indexof(ExtendedVersion, \".\", indexof(ExtendedVersion, \".\") + 1) + 1) + 1)\r\n    | extend NormalizedVersion=substring(ExtendedVersion, 0, FirstFourSegments)\r\n    | distinct ClientType, ClientVersion, NormalizedVersion\r\n    | as VersionCatalog\r\n    | join kind=inner\r\n    (\r\n        VersionCatalog\r\n        | distinct ClientType, NormalizedVersion\r\n        | extend SplitVersion=split(NormalizedVersion, '.')\r\n        | order by ClientType, toint(SplitVersion[0]) desc, toint(SplitVersion[1]) desc, toint(SplitVersion[2]) desc, toint(SplitVersion[3]) desc\r\n        | extend VersionSortIndex=row_number(1, prev(ClientType) != ClientType)\r\n        | project ClientType, NormalizedVersion, VersionSortIndex\r\n    ) on ClientType, NormalizedVersion\r\n    | project ClientType, ClientVersion, VersionSortIndex\r\n) on ClientType, ClientVersion\r\n| project-away *1\r\n| summarize arg_min(VersionSortIndex, *) by UserName, ClientType\r\n| where VersionSortIndex > 1\r\n| extend VersionsBehind=VersionSortIndex-1\r\n| join kind=inner  \r\n(\r\n    LatestClientsReleaseTimes\r\n    | where VersionSortIndex == 1\r\n) on ClientType\r\n| extend TimeDelta=LastSeen-FirstSeen\r\n| where TimeDelta > 1d\r\n| project UserName, ClientType, ClientTypeShort=replace(\"com.microsoft.rdc.\", \"\", ClientType), ClientVersion, LastSeen, Connections, Refreshes, LatestVersion=ClientVersion1, FirstSeen, TimeDelta=TimeDelta/1d\r\n| extend RowLabel=strcat(ClientTypeShort, \" - Newest: \", LatestVersion)\r\n| sort by TimeDelta desc",
                          "size": 0,
                          "title": "Users with potentially outdated clients (all activity types)",
                          "noDataMessage": "There are no users who have continued to use an outdated client for more than 1 day after the release of a newer version",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{poolla}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "$gen_group",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "42ch"
                                }
                              },
                              {
                                "columnMatch": "UserName",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "ClientType",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "ClientTypeShort",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "ClientVersion",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "13.1429ch"
                                }
                              },
                              {
                                "columnMatch": "LastSeen",
                                "formatter": 0,
                                "formatOptions": {
                                  "aggregation": "Max",
                                  "customColumnWidthSetting": "22.8571ch"
                                }
                              },
                              {
                                "columnMatch": "Connections",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue",
                                  "aggregation": "Sum",
                                  "customColumnWidthSetting": "118px"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true
                                  }
                                }
                              },
                              {
                                "columnMatch": "Refreshes",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "gray",
                                  "aggregation": "Sum",
                                  "customColumnWidthSetting": "134px"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true
                                  }
                                }
                              },
                              {
                                "columnMatch": "LatestVersion",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "FirstSeen",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "TimeDelta",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 7,
                                  "palette": "greenRed",
                                  "aggregation": "Average",
                                  "customColumnWidthSetting": "197px"
                                },
                                "numberFormat": {
                                  "unit": 27,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "maximumSignificantDigits": 2
                                  }
                                }
                              },
                              {
                                "columnMatch": "RowLabel",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "$gen_group",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "42ch"
                                }
                              }
                            ],
                            "rowLimit": 1000,
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "RowLabel"
                              ],
                              "expandTopLevel": false,
                              "finalBy": "UserName"
                            },
                            "labelSettings": [
                              {
                                "columnId": "ClientType",
                                "label": "Client versions",
                                "comment": ""
                              },
                              {
                                "columnId": "ClientTypeShort",
                                "label": "Client",
                                "comment": "The client type identification string"
                              },
                              {
                                "columnId": "ClientVersion",
                                "label": "Version"
                              },
                              {
                                "columnId": "LastSeen",
                                "label": "Last seen"
                              },
                              {
                                "columnId": "Refreshes",
                                "label": "Feed refreshes"
                              },
                              {
                                "columnId": "LatestVersion",
                                "label": "Latest version"
                              },
                              {
                                "columnId": "FirstSeen",
                                "label": "First active"
                              },
                              {
                                "columnId": "TimeDelta",
                                "label": "Time behind latest version",
                                "comment": "Length of time during which this client has remained active, despite a newer version being available"
                              },
                              {
                                "columnId": "RowLabel",
                                "label": "Users with outdated clients"
                              }
                            ]
                          },
                          "sortBy": []
                        },
                        "customWidth": "70",
                        "name": "Users with potentially outdated clients (all activity types)",
                        "styleSettings": {
                          "margin": "10px",
                          "padding": "10px",
                          "showBorder": true
                        }
                      }
                    ]
                  },
                  "name": "ClientReportPage"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "ClientReport"
            },
            "name": "clientreport"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "parameters": [
                      {
                        "id": "280b8061-881a-4dc7-80db-a31161bce7a9",
                        "version": "KqlParameterItem/1.0",
                        "name": "Computer",
                        "label": "Host",
                        "type": 2,
                        "isRequired": true,
                        "query": "Heartbeat\r\n| distinct Computer\r\n",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "value": null,
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters_hostbrowser"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "parameters": [
                            {
                              "id": "25e43a1a-f3d1-4684-8dca-c36a7a766bfd",
                              "version": "KqlParameterItem/1.0",
                              "name": "Object",
                              "type": 2,
                              "query": "Perf\r\n| where TimeGenerated {TimeRange:query}\r\n| where Computer == \"{Computer:value}\"\r\n| distinct ObjectName\r\n| sort by ObjectName\r\n",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "value": null,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            },
                            {
                              "id": "e2155896-4bea-43a8-9688-779c96c9b67f",
                              "version": "KqlParameterItem/1.0",
                              "name": "CounterName",
                              "label": "Counter Name",
                              "type": 2,
                              "isRequired": true,
                              "query": "Perf\r\n| where TimeGenerated {TimeRange:query}\r\n| where Computer == \"{Computer:value}\" and ObjectName == \"{Object}\"\r\n| distinct CounterName\r\n",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::1"
                                ],
                                "showDefault": false
                              },
                              "defaultValue": "value::1",
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces",
                              "value": null
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters1"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let Trend=Perf\r\n| where TimeGenerated {TimeRange:query} and Computer == \"{Computer:name}\" and ObjectName == \"{Object}\" and CounterName == \"{CounterName}\"\r\n| project _ResourceId, CounterName, InstanceName, TimeGenerated, CounterValue\r\n| make-series Trend =round(avg(CounterValue), 2) default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by CounterName, InstanceName\r\n| project Trend, InstanceName;\r\nPerf\r\n| where TimeGenerated {TimeRange:query} and Computer == \"{Computer:name}\"  and ObjectName == \"{Object}\" and CounterName == \"{CounterName}\"\r\n| project _ResourceId, CounterName, InstanceName, TimeGenerated,CounterValue\r\n| summarize Average = avg(CounterValue), P95th = percentiles(CounterValue, 95), P5th= percentiles(CounterValue, 5), TimeGenerated= min(TimeGenerated) by CounterName, InstanceName\r\n| join Trend on InstanceName\r\n| project InstanceName, Average, P5th, P95th, TimeGenerated, Trend\r\n| order by Average desc",
                          "size": 2,
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Average",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "P5th",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "P95th",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "Trend",
                                "formatter": 9,
                                "formatOptions": {
                                  "palette": "blue",
                                  "customColumnWidthSetting": "210px"
                                }
                              }
                            ],
                            "rowLimit": 1000,
                            "labelSettings": [
                              {
                                "columnId": "InstanceName",
                                "label": "Instance name"
                              },
                              {
                                "columnId": "P5th",
                                "label": "p5"
                              },
                              {
                                "columnId": "P95th",
                                "label": "p95"
                              },
                              {
                                "columnId": "TimeGenerated",
                                "label": "Time generated"
                              }
                            ]
                          }
                        },
                        "name": "PerfSelectedObject"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "WVDConnections\r\n| where SessionHostSessionId != \"<>\"\r\n| summarize by ComputerName=SessionHostName, UserName, InstanceName=SessionHostSessionId\r\n| sort by InstanceName\r\n//| join kind=leftouter (\r\n//erf\r\n//| where ObjectName == \"User Input Delay per Process\"\r\n//| project _ResourceId, CounterName, InstanceName, TimeGenerated, CounterValue) on InstanceName\r\n//| summarize Average = avg(CounterValue), P95th = percentiles(CounterValue, 95), P5th= percentiles(CounterValue, 5), TimeGenerated= min(TimeGenerated) by CounterName, ComputerName, InstanceName\r\n\r\n",
                          "size": 1,
                          "timeContext": {
                            "durationMs": 14400000
                          },
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "sortBy": []
                        },
                        "name": "query - 3 - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Perf\r\n| where ObjectName == \"User Input Delay per Process\"\r\n| where Computer == \"{Computer:name}\"\r\n| extend SplitAll=split(InstanceName, ':')\r\n| extend InstanceNameID=SplitAll[0]\r\n| extend ProcessID=SplitAll[1]\r\n| summarize Average = avg(CounterValue), P95th = percentiles(CounterValue, 95), P5th= percentiles(CounterValue, 5), TimeGenerated= min(TimeGenerated) by CounterName, Computer, InstanceName\r\n| sort by Average\r\n",
                          "size": 0,
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{LogAnalytics}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "SplitAll",
                                "formatter": 7
                              }
                            ],
                            "rowLimit": 500
                          }
                        },
                        "name": "query - 5"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "https://docs.microsoft.com/en-us/windows-server/remote/remote-desktop-services/rds-rdsh-performance-counters\r\n\r\nThe User Input Delay counter can help you quickly identify the root cause for bad end user RDP experiences. This counter measures how long any user input (such as mouse or keyboard usage) stays in the queue before it is picked up by a process, and the counter works in both local and remote sessions.\r\n\r\n\r\nOne important detail of this counter is that it reports the maximum user input delay within a configurable interval. This is the longest time it takes for an input to reach the application, which can impact the speed of important and visible actions like typing."
                        },
                        "name": "text - 2"
                      }
                    ]
                  },
                  "name": "Perf by object",
                  "styleSettings": {
                    "margin": "3px",
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "44ebe45b-1f47-4b62-bcfb-4a43ea59dca3",
                              "version": "KqlParameterItem/1.0",
                              "name": "MinLevel",
                              "label": " Minimum Level",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n{\"value\":\"0\", \"label\":\"Critical\"},\r\n{\"value\":\"1\", \"label\":\"Error\", \"selected\":true},\r\n{\"value\":\"2\", \"label\":\"Warning\"},\r\n{\"value\":\"4\", \"label\":\"Information\"}\r\n]",
                              "value": "2"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters_eventlog"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Event\r\n| where TimeGenerated {TimeRange:query} and Computer == \"{Computer:name}\" and EventLevel <= {MinLevel}\r\n| summarize Total=count(), DistinctSources=dcount(Source), Success=countif(EventLevel==0), Error=countif(EventLevel==1) by EventLog",
                          "size": 1,
                          "exportFieldName": "EventLog",
                          "exportParameterName": "SelectedEventLog",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Total",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "gray"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true
                                  }
                                }
                              },
                              {
                                "columnMatch": "DistinctSources",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true
                                  }
                                }
                              },
                              {
                                "columnMatch": "Success",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "green"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true
                                  }
                                }
                              },
                              {
                                "columnMatch": "Error",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "redBright"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true
                                  }
                                }
                              }
                            ],
                            "sortBy": [
                              {
                                "itemKey": "EventLog",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "EventLog",
                                "label": "Event log"
                              },
                              {
                                "columnId": "DistinctSources",
                                "label": "Distinct sources"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "EventLog",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "name": "EventLogsSummary"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "Select an Event Log above for further details",
                          "style": "info"
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "SelectedEventLog",
                          "comparison": "isEqualTo"
                        },
                        "name": "SelectedEventLog_NotSelected"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Event\r\n| where TimeGenerated {TimeRange:query} and Computer == \"{Computer:name}\" and EventLog == \"{SelectedEventLog}\" and EventLevel <= {MinLevel}\r\n| summarize Count=count() by Source, EventLevel,EventLevelName\r\n",
                          "size": 0,
                          "exportFieldName": "Source",
                          "exportParameterName": "SelectedSource",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "EventLevel",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "EventLevelName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Information",
                                      "representation": "1",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Warning",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Error",
                                      "representation": "error",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Success",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "thresholdValue": "Critical",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              }
                            ],
                            "sortBy": [
                              {
                                "itemKey": "Source",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "EventLevelName",
                                "label": "Level"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "Source",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "SelectedEventLog",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "SelectedEventLogTable",
                        "styleSettings": {
                          "margin": "3px",
                          "showBorder": true
                        }
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "Select a source for further details",
                          "style": "info"
                        },
                        "customWidth": "50",
                        "conditionalVisibilities": [
                          {
                            "parameterName": "SelectedSource",
                            "comparison": "isEqualTo"
                          },
                          {
                            "parameterName": "SelectedEventLog",
                            "comparison": "isNotEqualTo"
                          }
                        ],
                        "name": "SelectedSource_NotSelected"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Event\r\n| where TimeGenerated {TimeRange:query} and Computer == \"{Computer:name}\" and EventLog == \"{SelectedEventLog}\" and EventLevel <= {MinLevel} and Source == \"{SelectedSource}\"\r\n| project TimeGenerated, EventLevel, EventLevelName, EventID, RenderedDescription\r\n| top 2000 by TimeGenerated desc",
                          "size": 0,
                          "exportFieldName": "TimeGenerated",
                          "exportParameterName": "TimeGenerated",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "EventLevel",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "EventLevelName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Information",
                                      "representation": "1",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Warning",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Error",
                                      "representation": "3",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Critical",
                                      "representation": "critical",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "thresholdValue": "Success",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "EventID",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "8ch"
                                }
                              },
                              {
                                "columnMatch": "RenderedDescription",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "CellDetails",
                                  "linkIsContextBlade": true,
                                  "customColumnWidthSetting": "69.5714ch"
                                }
                              }
                            ],
                            "rowLimit": 2000,
                            "sortBy": [
                              {
                                "itemKey": "EventID",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "EventLevelName",
                                "label": "Level"
                              },
                              {
                                "columnId": "EventID",
                                "label": "Id"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "EventID",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "SelectedSource",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "SelectedSourceTable",
                        "styleSettings": {
                          "margin": "3px",
                          "showBorder": true
                        }
                      }
                    ]
                  },
                  "name": "EventsBrowser",
                  "styleSettings": {
                    "margin": "3px",
                    "showBorder": true
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "HostDiagnostics"
            },
            "name": "Host Diagnostics and Events"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{LogAnalytics_Admin}"
                    ],
                    "parameters": [
                      {
                        "id": "cadc5727-6273-4ebb-874a-7d8891687678",
                        "version": "KqlParameterItem/1.0",
                        "name": "LogAnalytics_Admin",
                        "type": 5,
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "where type =~ 'Microsoft.OperationalInsights/workspaces'\r\n| where name contains \"PlatformLogs\" or name contains 'VDMS-ADMIN'\r\n| project id",
                        "crossComponentResources": [
                          "value::all"
                        ],
                        "isHiddenWhenLocked": true,
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ]
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "defaultValue": "value::all",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "554a8a64-343c-4c53-8086-292684eabcdc",
                        "version": "KqlParameterItem/1.0",
                        "name": "SessionHost",
                        "type": 7,
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "SessionHostStatus_CL\r\n| where SubscriptionId == \"{Subscription:id}\"\r\n| summarize by HostName_s",
                        "crossComponentResources": [
                          "{LogAnalytics_Admin}"
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "554a8a64-343c-4c53-8086-292684eabcdc",
                        "version": "KqlParameterItem/1.0",
                        "name": "HealthCheckResult",
                        "type": 7,
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "SessionHostStatus_CL\r\n| where SubscriptionId == \"{Subscription:id}\"\r\n| extend HealthCheckResult = todynamic(HealthCheckResult_s)\r\n| mvexpand HealthCheckExpand = HealthCheckResult\r\n| extend HealthCheckName = HealthCheckExpand.HealthCheckName\r\n| extend HealthCheckResult = tostring(HealthCheckExpand.HealthCheckResult)\r\n| distinct HealthCheckResult",
                        "crossComponentResources": [
                          "{LogAnalytics_Admin}"
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "defaultValue": "value::all",
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters - 0"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SessionHostStatus_CL\r\n| where SubscriptionId == \"{Subscription:id}\"\r\n| where HostName_s in ({SessionHost}) or '*' in ({SessionHost})\r\n| extend HealthCheckResult = todynamic(HealthCheckResult_s)\r\n//| extend HealthCheckExpand = extract_json(\"$.\", HealthCheckResult, typeof(str))\r\n| mvexpand HealthCheckExpand = HealthCheckResult\r\n| extend HealthCheckName = HealthCheckExpand.HealthCheckName\r\n| extend HealthCheckResult = HealthCheckExpand.HealthCheckResult\r\n| where HealthCheckResult in ({HealthCheckResult}) or '*' in ({HealthCheckResult})\r\n| where HealthCheckResult != \"HealthCheckSucceeded\" or AllowNewSession_b != \"true\" or VMPowerState_s != \"VM running\"\r\n| extend HealthDetailMessage = HealthCheckExpand.AdditionalFailureDetailMessage\r\n| project TimeGenerated, SubscriptionId, AllowNewSession_b, HostName_s, VMPowerState_s, HealthCheckName, HealthCheckResult, HealthDetailMessage, PoolName_s, CurrentSessions_d, StatusTimestamp_t, SxSStackVersion_s, AgentVersion_s\r\n\r\n//| project TimeGenerated, SubscriptionId, VMPowerState_s, AllowNewSession_b, HostName_s, PoolName_s, CurrentSessions_d, StatusTimestamp_t, SxSStackVersion_s, HealthCheckResult_s, AgentVersion_s\r\n",
                    "size": 2,
                    "title": "Unhealthy Status - Not running, Not Allowing Sessions, or Unhealth agent status",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalytics_Admin}"
                    ],
                    "gridSettings": {
                      "rowLimit": 1000,
                      "sortBy": [
                        {
                          "itemKey": "AllowNewSession_b",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "AllowNewSession_b",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "name": "query - 1"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SessionHostStatus_CL\r\n| where SubscriptionId == \"{Subscription:id}\"\r\n| where HostName_s in ({SessionHost}) or '*' in ({SessionHost})\r\n| extend HealthCheckResult = todynamic(HealthCheckResult_s)\r\n//| extend HealthCheckExpand = extract_json(\"$.\", HealthCheckResult, typeof(str))\r\n| mvexpand HealthCheckExpand = HealthCheckResult \r\n| extend HealthCheckName = HealthCheckExpand.HealthCheckName\r\n| extend HealthCheckResult = HealthCheckExpand.HealthCheckResult\r\n| where HealthCheckResult in ({HealthCheckResult}) or '*' in ({HealthCheckResult})\r\n| extend HealthDetailMessage = HealthCheckExpand.AdditionalFailureDetailMessage\r\n| project TimeGenerated, SubscriptionId, AllowNewSession_b, HostName_s, VMPowerState_s, HealthCheckName, HealthCheckResult, HealthDetailMessage, PoolName_s, CurrentSessions_d, StatusTimestamp_t, SxSStackVersion_s, AgentVersion_s\r\n\r\n//| project TimeGenerated, SubscriptionId, VMPowerState_s, AllowNewSession_b, HostName_s, PoolName_s, CurrentSessions_d, StatusTimestamp_t, SxSStackVersion_s, HealthCheckResult_s, AgentVersion_s\r\n",
                    "size": 0,
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalytics_Admin}"
                    ],
                    "gridSettings": {
                      "rowLimit": 1000,
                      "sortBy": [
                        {
                          "itemKey": "TimeGenerated",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "TimeGenerated",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "name": "query - 1 - Copy"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "HostAvailability"
            },
            "name": "group - HostAvailability"
          }
        ]
      },
      "name": "group - Main Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Search graphics data for a specific session host",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "### The graphics data table generates information whenever end-to-end delay and dropped frames percentages fall below a healthy threshold for Azure Virtual Desktop. This table helps administrators understand factors across the server, client, and network that could be contributing to slow or choppy experiences for a user.  "
            },
            "name": "text - 2"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "WVDConnectionGraphicsDataPreview \r\n| join kind = leftouter\r\n(\r\n    WVDConnections\r\n    | extend Protocol = iff(UdpUse in (\"<>\", \"0\"), \"TCP\", \"UDP\")\r\n    | extend GatewayRegion = iff(GatewayRegion in (\"<>\", \"\"), \"Unknown\", GatewayRegion)\r\n    | summarize GatewayRegion = take_anyif(GatewayRegion, GatewayRegion != \"Unknown\") by CorrelationId, UserName, SessionHostName, Protocol\r\n) on CorrelationId\r\n| project-away CorrelationId1, TenantId\r\n| project-reorder TimeGenerated, UserName, Protocol, GatewayRegion, SessionHostName",
              "size": 0,
              "title": "Query all graphics data and correlate with username, protocol, gateway region, and session host name",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{LogAnalytics}"
              ]
            },
            "name": "query - 0"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "WVDConnectionGraphicsDataPreview\r\n| join kind = leftouter\r\n(\r\n    WVDConnections\r\n    | extend Protocol = iff(UdpUse in (\"<>\", \"0\"), \"TCP\", \"UDP\")\r\n    | extend GatewayRegion = iff(GatewayRegion in (\"<>\", \"\"), \"Unknown\", GatewayRegion)\r\n    | summarize GatewayRegion = take_anyif(GatewayRegion, GatewayRegion != \"Unknown\") by CorrelationId, UserName, SessionHostName, Protocol\r\n) on CorrelationId\r\n//| where extract(\"/subscriptions/.*/resourcegroups/.*/providers/.*/hostpools/(.*)\", 1, _ResourceId) == \"{HostPool}\"\r\n| project-away CorrelationId1\r\n| project-reorder TimeGenerated, UserName, Protocol, GatewayRegion, SessionHostName",
              "size": 0,
              "title": "Search graphics data for a specific host pool",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{LogAnalytics}"
              ]
            },
            "name": "query - 0 - Copy"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "GraphicalData"
      },
      "name": "group - Graphical Data"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Troubleshooting Resources",
        "items": [
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Overview Documentation Group",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "##Confluence Documentation"
                  },
                  "name": "text - 0"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Overview"
            },
            "name": "Docuementation Overview Group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "User Tab Documentation",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "### Confluence Documentation"
                  },
                  "name": "text - 2"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "UserReport"
            },
            "name": "Documentation User Tab"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Client Tab Documentation",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "## Confluence Documentation"
                  },
                  "name": "text - 0"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "ClientReport"
            },
            "name": "Client Tab Documentation"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Connection Diagnostics Documentation",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "##Confluence Documentation"
                  },
                  "name": "text - 0"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "ConnectionDiagnostics"
            },
            "name": "Connection Diagnostics Documentation - Copy"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Utilization Report Documentation",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "## Confluence Documentation"
                  },
                  "name": "text - 0"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "UtilizationReport"
            },
            "name": "Utilization Report"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "AVD Errors and Connections Documentation",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "## Confluence Documentation"
                  },
                  "name": "text - 0"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Logins"
            },
            "name": "AVD Errors and Connections Documentation"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Session Bandwidths & Latency Documentation",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "## Confluence Documentation"
                  },
                  "name": "text - 0"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Latencies"
            },
            "name": "Session Bandwidths & Latency Documentation - Copy"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Logon Timing  Documentation",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "## Confluence Documentation"
                  },
                  "name": "text - 0"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "LogonTiming"
            },
            "name": "Logon Timing  Documentation"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Host Diagnostics Documentation",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "## Confluence Documentation"
                  },
                  "name": "text - 0"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "HostDiagnostics"
            },
            "name": "Host Diagnostics Documentation"
          }
        ]
      },
      "name": "Troubleshooting Resources Group"
    },
    {
      "type": 1,
      "content": {
        "json": "Original Source - AVD Insights Workbook and other sources\r\n<br/>\r\nWorkbook Manager - Blair Sonnnek - blair.sonnek@netapp.com",
        "style": "info"
      },
      "name": "text - 107"
    }
  ],
  "fallbackResourceIds": [
    "Azure Monitor"
  ],
  "fromTemplateId": "community-Workbooks/Windows Virtual Desktop/WVD Insights",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
